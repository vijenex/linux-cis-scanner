{
  "milestone": "1.2",
  "version": "1.0.0",
  "description": "RHEL 8 CIS Benchmark v4.0.0 - Section 1.2",
  "controls": [
    {
      "id": "1.2.1.1",
      "title": "Ensure GPG keys are configured",
      "section": "1.2.1 Configure Package Repositories",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "severity": "high",
      "cis_reference": "CIS RHEL 8 v4.0.0 - 1.2.1.1 | Level 1 - Server | Level 1 - Workstation",
      "description": "The RPM Package Manager implements GPG key signing to verify package integrity during and after installation.",
      "rationale": "It is important to ensure that updates are obtained from a valid source to protect against spoofing that could lead to the inadvertent installation of malware on the system. To this end, verify that GPG keys are configured correctly for your system.",
      "remediation": "Update your package manager GPG keys in accordance with site policy.",
      "impact": "Manual verification required to ensure GPG keys match official repository keys.",
      "references": "NIST SP 800-53 Rev. 5: SI-2 | Fedora public keys: https://getfedora.org/security/ | CIS Controls v8 7.3: Perform Automated Operating System Patch Management | CIS Controls v8 7.4: Perform Automated Application Patch Management | CIS Controls v7 3.4: Deploy Automated Operating System Patch Management Tools | CIS Controls v7 3.5: Deploy Automated Software Patch Management Tools",
      "audit_command": "grep -r gpgkey /etc/yum.repos.d/* /etc/dnf/dnf.conf; for RPM_PACKAGE in $(rpm -q gpg-pubkey); do echo RPM: ${RPM_PACKAGE}; rpm -q --queryformat '%{SUMMARY}' ${RPM_PACKAGE}; done"
    },
    {
      "id": "1.2.1.2",
      "title": "Ensure gpgcheck is configured",
      "section": "1.2.1 Configure Package Repositories",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "file_path": "/etc/dnf/dnf.conf",
      "pattern": "^\\h*gpgcheck\\h*=\\h*(1|true|yes)\\b",
      "expected_result": "found",
      "severity": "critical",
      "cis_reference": "CIS RHEL 8 v4.0.0 - 1.2.1.2 | Level 1 - Server | Level 1 - Workstation",
      "description": "The gpgcheck option controls verifying package signatures after download. This option is configurable as a global option in the main section of /etc/dnf/dnf.conf and a per repository option in individual files in the /etc/yum.repos.d/* directory.",
      "rationale": "It is important to ensure that an RPM's package signature is always checked prior to installation to ensure that the software is obtained from a trusted source.",
      "remediation": "Edit /etc/dnf/dnf.conf and set gpgcheck=1 in the [main] section. Edit any failing files in /etc/yum.repos.d/* and set all instances starting with gpgcheck to 1. Example: # find /etc/yum.repos.d/ -name '*.repo' -exec sed -i 's/^gpgcheck\\s*=\\s*.*/gpgcheck=1/' {} \\;",
      "impact": "None - this is a security best practice.",
      "references": "NIST SP 800-53 Revision 5 :: CM-14 | STIG ID: RHEL-08-010370 | RULE ID: SV-230264r1017377 | CAT I | STIG ID: RHEL-09-214015 | RULE ID: SV-257820r1044878 | CAT I | STIG ID: RHEL-09-214025 | RULE ID: SV-257822r1044880 | CAT I | CIS Controls v8 7.3: Perform Automated Operating System Patch Management | CIS Controls v7 3.4: Deploy Automated Operating System Patch Management Tools",
      "audit_command": "grep -Pi -- '^\\h*gpgcheck\\h*=\\h*(1|true|yes)\\b' /etc/dnf/dnf.conf; grep -Pris -- '^\\h*gpgcheck\\h*=\\h*(0|[2-9]|[1-9][0-9]+|false|no)\\b' /etc/yum.repos.d/"
    },
    {
      "id": "1.2.1.3",
      "title": "Ensure repo_gpgcheck is globally activated",
      "section": "1.2.1 Configure Package Repositories",
      "profile": "Level2",
      "automated": false,
      "type": "Manual",
      "severity": "medium",
      "cis_reference": "CIS RHEL 8 v4.0.0 - 1.2.1.3 | Level 2 - Server | Level 2 - Workstation",
      "description": "The repo_gpgcheck option, found in the main section of the /etc/dnf/dnf.conf and individual /etc/yum.repos.d/* files, will perform a GPG signature check on the repodata.",
      "rationale": "It is important to ensure that the repository data signature is always checked prior to installation to ensure that the software is not tampered with in any way.",
      "remediation": "Global configuration: Edit /etc/dnf/dnf.conf and set repo_gpgcheck=1 in the [main] section. Per repository configuration: First check that the particular repository support GPG checking on the repodata. Edit any failing files in /etc/yum.repos.d/* and set all instances starting with repo_gpgcheck to 1.",
      "impact": "\u26a0\ufe0f LEVEL 2: Not all repositories, notably RedHat, support repo_gpgcheck. Take care to set this value to false (default) for particular repositories that do not support it. If enabled on repositories that do not support repo_gpgcheck installation of packages will fail. Research is required by the user to determine which repositories are configured on the local system and which support repo_gpgcheck.",
      "references": "NIST SP 800-53 Rev. 5: SI-2 | CIS Controls v8 7.3: Perform Automated Operating System Patch Management | CIS Controls v7 3.4: Deploy Automated Operating System Patch Management Tools",
      "audit_command": "grep ^repo_gpgcheck /etc/dnf/dnf.conf; grep -l 'repo_gpgcheck=0' /etc/yum.repos.d/*"
    },
    {
      "id": "1.2.1.4",
      "title": "Ensure package manager repositories are configured",
      "section": "1.2.1 Configure Package Repositories",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "severity": "high",
      "cis_reference": "CIS RHEL 8 v4.0.0 - 1.2.1.4 | Level 1 - Server | Level 1 - Workstation",
      "description": "Systems need to have the respective package manager repositories configured to ensure that the system is able to receive the latest patches and updates.",
      "rationale": "If a system's package repositories are misconfigured, important patches may not be identified or a rogue repository could introduce compromised software.",
      "remediation": "Configure your package manager repositories according to site policy.",
      "impact": "Manual review required to verify repositories match organizational policy.",
      "references": "NIST SP 800-53 Rev. 5: SI-2 | Fedora repositories: https://docs.fedoraproject.org/en-US/quick-docs/repositories/ | CIS Controls v8 7.3: Perform Automated Operating System Patch Management | CIS Controls v8 7.4: Perform Automated Application Patch Management | CIS Controls v7 3.4: Deploy Automated Operating System Patch Management Tools | CIS Controls v7 3.5: Deploy Automated Software Patch Management Tools",
      "audit_command": "dnf repolist; cat /etc/yum.repos.d/*.repo"
    },
    {
      "id": "1.2.1.5",
      "title": "Ensure weak dependencies are configured",
      "section": "1.2.1 Configure Package Repositories",
      "profile": "Level2",
      "automated": true,
      "type": "FileContent",
      "file_path": "/etc/dnf/dnf.conf",
      "pattern": "^\\h*install_weak_deps\\h*=\\h*(0|false|no)\\b",
      "expected_result": "found",
      "severity": "low",
      "cis_reference": "CIS RHEL 8 v4.0.0 - 1.2.1.5 | Level 2 - Server | Level 2 - Workstation",
      "description": "The RPM packaging specification allows for 3 levels of dependencies to be declared: hard dependencies (Requires/Provides), weak dependencies (Recommends/Supplements), and hints (Suggests/Enhances).",
      "rationale": "Unless a system specifically requires the additional capabilities provides by the weak dependencies, it is recommended that the packages are not installed to reduce the potential attack surface.",
      "remediation": "Edit /etc/dnf/dnf.conf and set install_weak_deps=0 in the [main] section. Example: [main]\ninstall_weak_deps=0",
      "impact": "\u26a0\ufe0f LEVEL 2: Disabling weak dependencies may prevent installation of packages that provide additional features. Evaluate system requirements before implementing.",
      "references": "NIST SP 800-53 Rev. 5: CM-7 | CIS Controls v8 7.3: Perform Automated Operating System Patch Management | CIS Controls v7 3.4: Deploy Automated Operating System Patch Management Tools",
      "audit_command": "grep -Pi -- '^\\h*install_weak_deps\\h*=\\h*(0|false|no)\\b' /etc/dnf/dnf.conf"
    }
  ]
}