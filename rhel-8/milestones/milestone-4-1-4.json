{
  "milestone": "4.1.4",
  "title": "Configure auditd File Access",
  "controls": [
    {
      "title": "Ensure unsuccessful file access attempts are collected",
      "level": 2,
      "scored": true,
      "profile_applicability": "Level 2 - Server, Level 2 - Workstation",
      "description": "Monitor for unsuccessful attempts to access files. The parameters below are associated with system calls that control creation (creat), opening (open, openat) and truncation (truncate, ftruncate) of files. An audit log record will only be written if the user is a non-privileged user (auid >= 1000), is not a Daemon event (auid=4294967295) and if the system call returned EACCES (permission denied to the file) or EPERM (some other permanent error associated with the specific system call). All audit records will be tagged with the identifier \"access.\"",
      "rationale": "Failed attempts to open, create or truncate files could be an indication that an individual or process is trying to gain unauthorized access to the system.",
      "audit": "Run the following command and verify output matches:\n# auditctl -l | grep access\n-a always,exit -F arch=b64 -S creat,open,openat,truncate,ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access\n-a always,exit -F arch=b32 -S creat,open,openat,truncate,ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access\n-a always,exit -F arch=b64 -S creat,open,openat,truncate,ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access\n-a always,exit -F arch=b32 -S creat,open,openat,truncate,ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access",
      "remediation": "Edit or create a file in the /etc/audit/rules.d/ directory ending in .rules\nExample: vi /etc/audit/rules.d/access.rules\nAdd the following lines:\n-a always,exit -F arch=b64 -S creat,open,openat,truncate,ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access\n-a always,exit -F arch=b32 -S creat,open,openat,truncate,ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=unset -k access\n-a always,exit -F arch=b64 -S creat,open,openat,truncate,ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access\n-a always,exit -F arch=b32 -S creat,open,openat,truncate,ftruncate -F exit=-EPERM -F auid>=1000 -F auid!=unset -k access",
      "impact": "None",
      "default_value": "N/A",
      "references": "1. See the auditctl(8) and auditd(8) man pages for more information.",
      "cis_controls": "v8: 8.5 Collect Detailed Audit Logs\nv7: 14.9 Enforce Detail Logging for Access or Changes to Sensitive Data",
      "check_type": "Manual",
      "check_value": "",
      "id": "4.1.3.9"
    },
    {
      "title": "Ensure successful file system mounts are collected",
      "level": 2,
      "scored": true,
      "profile_applicability": "Level 2 - Server, Level 2 - Workstation",
      "description": "Monitor the use of the mount system call. The mount (and umount) system call controls the mounting and unmounting of file systems. The parameters below configure the system to create an audit record when the mount system call is used by a non-privileged user.",
      "rationale": "It is highly unusual for a non privileged user to mount file systems to the system. While tracking mount commands gives the system administrator evidence that external media may have been mounted (based on a review of the source of the mount and confirming it's an external media type), it does not conclusively indicate that data was exported to the media. System administrators who wish to determine if data were exported, would also have to track successful open, creat and truncate system calls requiring write access to a file under the mount point of the external media file system. This could give a fair indication that a write occurred. The only way to truly prove it, would be to track successful writes to the external media. Tracking write system calls could quickly fill up the audit log and is not recommended. Recommendations on configuration options to track data export to media is beyond the scope of this document.",
      "audit": "Run the following command and verify output matches:\n# auditctl -l | grep mounts\n-a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=unset -k mounts\n-a always,exit -F arch=b32 -S mount -F auid>=1000 -F auid!=unset -k mounts",
      "remediation": "Edit or create a file in the /etc/audit/rules.d/ directory ending in .rules\nExample: vi /etc/audit/rules.d/mounts.rules\nAdd the following lines:\n-a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=unset -k mounts\n-a always,exit -F arch=b32 -S mount -F auid>=1000 -F auid!=unset -k mounts",
      "impact": "None",
      "default_value": "N/A",
      "references": "1. See the auditctl(8) and auditd(8) man pages for more information.",
      "cis_controls": "v8: 8.5 Collect Detailed Audit Logs\nv7: 5.5 Implement Automated Configuration Monitoring Systems",
      "check_type": "Manual",
      "check_value": "",
      "id": "4.1.3.10"
    },
    {
      "title": "Ensure file deletion events by users are collected",
      "level": 2,
      "scored": true,
      "profile_applicability": "Level 2 - Server, Level 2 - Workstation",
      "description": "Monitor the use of system calls associated with the deletion or renaming of files and file attributes. This configuration statement sets up monitoring for the unlink (remove a file), unlinkat (remove a file attribute), rename (rename a file) and renameat (rename a file attribute) system calls and tags them with the identifier \"delete\".",
      "rationale": "Monitoring these calls from non-privileged users could provide a system administrator with evidence that inappropriate removal of files and file attributes associated with protected files is occurring. While this audit option will look at all events, system administrators will want to look for specific privileged files that are being deleted or altered.",
      "audit": "Run the following command and verify output matches:\n# auditctl -l | grep delete\n-a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F auid>=1000 -F auid!=unset -k delete\n-a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F auid>=1000 -F auid!=unset -k delete",
      "remediation": "Edit or create a file in the /etc/audit/rules.d/ directory ending in .rules\nExample: vi /etc/audit/rules.d/delete.rules\nAdd the following lines:\n-a always,exit -F arch=b64 -S unlink,unlinkat,rename,renameat -F auid>=1000 -F auid!=unset -k delete\n-a always,exit -F arch=b32 -S unlink,unlinkat,rename,renameat -F auid>=1000 -F auid!=unset -k delete",
      "impact": "None",
      "default_value": "N/A",
      "references": "1. See the auditctl(8) and auditd(8) man pages for more information.",
      "cis_controls": "v8: 8.5 Collect Detailed Audit Logs\nv7: 14.9 Enforce Detail Logging for Access or Changes to Sensitive Data",
      "check_type": "Manual",
      "check_value": "",
      "id": "4.1.3.11"
    },
    {
      "title": "Ensure changes to system administration scope (sudoers) is collected",
      "level": 2,
      "scored": true,
      "profile_applicability": "Level 2 - Server, Level 2 - Workstation",
      "description": "Monitor scope changes for system administrations. If the system has been properly configured to force system administrators to log in as themselves first and then use the sudo command to execute privileged commands, it is possible to monitor changes in scope. The file /etc/sudoers will be written to when the file or its attributes have changed. The audit records will be tagged with the identifier \"scope.\"",
      "rationale": "Changes in the /etc/sudoers file can indicate that an unauthorized change has been made to scope of system administrator activity.",
      "audit": "Run the following command and verify output matches:\n# auditctl -l | grep scope\n-w /etc/sudoers -p wa -k scope\n-w /etc/sudoers.d/ -p wa -k scope",
      "remediation": "Edit or create a file in the /etc/audit/rules.d/ directory ending in .rules\nExample: vi /etc/audit/rules.d/scope.rules\nAdd the following lines:\n-w /etc/sudoers -p wa -k scope\n-w /etc/sudoers.d/ -p wa -k scope",
      "impact": "None",
      "default_value": "N/A",
      "references": "1. See the auditctl(8) and auditd(8) man pages for more information.",
      "cis_controls": "v8: 8.5 Collect Detailed Audit Logs\nv7: 4.8 Log and Alert on Changes to Administrative Group Membership",
      "check_type": "Manual",
      "check_value": "",
      "id": "4.1.3.12"
    },
    {
      "title": "Ensure system administrator command executions (sudo) are collected",
      "level": 2,
      "scored": true,
      "profile_applicability": "Level 2 - Server, Level 2 - Workstation",
      "description": "Monitor sudo commands. The parameters below monitor any command execution via sudo. The file /var/log/sudo.log will be written to when a command is executed via sudo.",
      "rationale": "Creating an audit log of administrators with temporary elevated privileges and the operation(s) they performed is essential to reporting. Administrators will want to correlate the events written to the audit trail with the records written to sudo's logfile to verify if unauthorized commands have been executed.",
      "audit": "Run the following command and verify output matches:\n# auditctl -l | grep sudo.log\n-w /var/log/sudo.log -p wa -k actions",
      "remediation": "Edit or create a file in the /etc/audit/rules.d/ directory ending in .rules\nExample: vi /etc/audit/rules.d/actions.rules\nAdd the following line:\n-w /var/log/sudo.log -p wa -k actions",
      "impact": "None",
      "default_value": "N/A",
      "references": "1. See the auditctl(8) and auditd(8) man pages for more information.",
      "cis_controls": "v8: 8.5 Collect Detailed Audit Logs\nv7: 4.9 Log and Alert on Unsuccessful Administrative Account Login",
      "check_type": "Manual",
      "check_value": "",
      "id": "4.1.3.13"
    },
    {
      "title": "Ensure kernel module loading and unloading is collected",
      "level": 2,
      "scored": true,
      "profile_applicability": "Level 2 - Server, Level 2 - Workstation",
      "description": "Monitor the loading and unloading of kernel modules. The programs insmod (install a kernel module), rmmod (remove a kernel module), and modprobe (a more sophisticated program to load and unload modules, as well as some other features) control loading and unloading of modules. The init_module (load a module) and delete_module (delete a module) system calls control loading and unloading of modules. Any execution of the loading and unloading module programs and system calls will trigger an audit record with an identifier of \"modules\".",
      "rationale": "Monitoring the use of insmod, rmmod and modprobe could provide system administrators with evidence that an unauthorized user loaded or unloaded a kernel module, possibly compromising the security of the system. Monitoring of the init_module and delete_module system calls would reflect an unauthorized user attempting to use a different program to load and unload modules.",
      "audit": "Run the following command and verify output matches:\n# auditctl -l | grep modules\n-w /sbin/insmod -p x -k modules\n-w /sbin/rmmod -p x -k modules\n-w /sbin/modprobe -p x -k modules\n-a always,exit -F arch=b64 -S init_module,delete_module -k modules",
      "remediation": "Edit or create a file in the /etc/audit/rules.d/ directory ending in .rules\nExample: vi /etc/audit/rules.d/modules.rules\nAdd the following lines:\n-w /sbin/insmod -p x -k modules\n-w /sbin/rmmod -p x -k modules\n-w /sbin/modprobe -p x -k modules\n-a always,exit -F arch=b64 -S init_module,delete_module -k modules",
      "impact": "None",
      "default_value": "N/A",
      "references": "1. See the auditctl(8) and auditd(8) man pages for more information.",
      "cis_controls": "v8: 8.5 Collect Detailed Audit Logs\nv7: 5.5 Implement Automated Configuration Monitoring Systems",
      "check_type": "Manual",
      "check_value": "",
      "id": "4.1.3.14"
    },
    {
      "title": "Ensure the audit configuration is immutable",
      "level": 2,
      "scored": true,
      "profile_applicability": "Level 2 - Server, Level 2 - Workstation",
      "description": "Set system audit so that audit rules cannot be modified with auditctl. Setting the flag \"-e 2\" forces audit to be put in immutable mode. Audit changes can only be made on system reboot.",
      "rationale": "In immutable mode, unauthorized users cannot execute changes to the audit system to potentially hide malicious activity and then put the audit rules back. Users would most likely notice a system reboot and that could alert administrators of an attempt to make unauthorized audit changes.",
      "audit": "Run the following command and verify output matches:\n# grep \"^\\s*[^#]\" /etc/audit/rules.d/*.rules | tail -1\n-e 2",
      "remediation": "Edit or create the file /etc/audit/rules.d/99-finalize.rules and add the following line at the end of the file:\n-e 2",
      "impact": "Once set, the audit configuration becomes immutable and cannot be changed until the next reboot.",
      "default_value": "N/A",
      "references": "1. See the auditctl(8) and auditd(8) man pages for more information.",
      "cis_controls": "v8: 8.5 Collect Detailed Audit Logs\nv7: 6.2 Activate audit logging",
      "check_type": "Manual",
      "check_value": "",
      "id": "4.1.3.15"
    },
    {
      "id": "4.1.4",
      "title": "Ensure firewalld active zone target is configured\\",
      "automated": true,
      "profile": "Level1",
      "section": "4.1",
      "description": "\\\n\n\\f2\\b0 FirewallD zones are a network or firewall zone that defines the trust level of the\\\ninterface used for a connection. There are several pre-defined zones provided by\\\nfirewalld.\\\nA zone target may be set to \n\\f0 \\cf4 ACCEPT\n\\f2 \\cf2 , \n\\f0 \\cf4 %%REJECT%%\n\\f2 \\cf2 , or \n\\f0 \\cf4 DROP\n\\f2 \\cf2 . This can be used to accept,\\\nreject, or drop every packet that doesn't match any rule (port, service, etc). The \n\\f0 \\cf4 ACCEPT\\\n\n\\f2 \\cf2 target is used in the \n\\f0 \\cf4 trusted\n\\f2 \\cf2  zone ",
      "rationale": "\\\n\n\\f2\\b0 With a default accept policy the firewall will accept any packet that is not configured to\\\nbe denied. It is easier to allow list acceptable usage than to deny list unacceptable\\\nusage.\n\\fs20\\fsmilli10080 Page 579\\\n\n\\f0 Internal Only - General\\\n\n\\f1\\b\\fs24",
      "impact": "None",
      "audit_command": "\\\n\n\\f2\\b0 Run the following command to verify the active zone \n\\f0 \\cf4 target\n\\f2 \\cf2  is not set to \n\\f0 \\cf4 ACCEPT\n\\f2 \\cf2 :\\\nRun the following script to verify:\\\n\n\\f0\\fs20\\fsmilli10080 \\'95\n\\f2  \n\\fs24 active zone \n\\f0 \\cf4 target\n\\f2 \\cf2  for interfaces that are not loopback or virtual is not set to\\\n\n\\f0 \\cf4 ACCEPT\n\\f2 \\cf2 .\\\n\n\\f0\\fs20\\fsmilli10080 \\'95\n\\f2  \n\\fs24 an active zone is configured.\\\n\n\\f0\\fs20\\fsmilli10080 \\'95\n\\f2  \n\\fs24 active zone target is written as a permanent fire",
      "remediation": "\\\n\n\\f2\\b0 Run the following command to update an active zone target and write a permanent\\\nfirewalld rule:\\\n\n\\f4\\fs20\\fsmilli10080 # firewall-cmd --zone=\\{ACTIVE_ZONE\\} --set-target=\\{TARGET\\} --permanent\\\n\n\\f3\\i\\fs24 Example:\\\n\n\\f4\\i0\\fs20\\fsmilli10080 # firewall-cmd --zone=public --set-target=DROP --permanent\\\n\n\\f1\\b\\fs24 Note:\n\\f2\\b0  \n\\f0 \\cf4 --set-target=",
      "references": "",
      "type": "FileContent",
      "pattern": "max_log_file_action",
      "expected_result": "found",
      "severity": "medium",
      "cis_reference": "CIS RHEL 8 v4.0.0 - 4.1.4 | Level1",
      "file_path": "/etc/audit/auditd.conf"
    }
  ]
}