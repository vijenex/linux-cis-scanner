{
  "milestone": "5.2.1",
  "title": "SSH Server Configuration - Part 1",
  "controls": [
    {
      "title": "Ensure permissions on /etc/ssh/sshd_config are configured",
      "level": 1,
      "scored": true,
      "profile_applicability": "Level 1 - Server, Level 1 - Workstation",
      "description": "The /etc/ssh/sshd_config file contains configuration specifications for sshd. The command below sets the owner and group of the file to root.",
      "rationale": "The /etc/ssh/sshd_config file needs to be protected from unauthorized changes by non-privileged users.",
      "audit": "Run the following command and verify Uid and Gid are both 0/root and Access is 600:\n# stat /etc/ssh/sshd_config\nAccess: (0600/-rw-------) Uid: ( 0/ root) Gid: ( 0/ root)",
      "remediation": "Run the following commands to set ownership and permissions on /etc/ssh/sshd_config:\n# chown root:root /etc/ssh/sshd_config\n# chmod og-rwx /etc/ssh/sshd_config",
      "impact": "None",
      "default_value": "0600 root root",
      "references": "1. See the sshd_config(5) man page for more information.",
      "cis_controls": "v8: 3.3 Configure Data Access Control Lists\nv7: 14.6 Protect Information through Access Control Lists",
      "check_type": "FilePermissions",
      "check_value": "/etc/ssh/sshd_config:0600:root:root",
      "id": "5.2.1"
    },
    {
      "title": "Ensure permissions on SSH private host key files are configured",
      "level": 1,
      "scored": true,
      "profile_applicability": "Level 1 - Server, Level 1 - Workstation",
      "description": "An SSH private key is one of two files used in SSH public key authentication. In this authentication method, the possession of the private key is proof of identity. Only a private key that corresponds to a public key will be able to authenticate successfully. The private keys need to be stored and handled carefully, and no copies of the private key should be distributed.",
      "rationale": "If an unauthorized user obtains the private SSH host key file, the host could be impersonated.",
      "audit": "Run the following command and verify Access is 0600, Uid is 0/root, and Gid is 0/root or ssh_keys:\n# find /etc/ssh -xdev -type f -name 'ssh_host_*_key' -exec stat {} \\;\nAccess: (0600/-rw-------) Uid: ( 0/ root) Gid: ( 0/ root)",
      "remediation": "Run the following commands to set ownership and permissions on the private SSH host key files:\n# find /etc/ssh -xdev -type f -name 'ssh_host_*_key' -exec chown root:root {} \\;\n# find /etc/ssh -xdev -type f -name 'ssh_host_*_key' -exec chmod 0600 {} \\;",
      "impact": "None",
      "default_value": "0600 root root",
      "references": "1. See the sshd_config(5) man page for more information.",
      "cis_controls": "v8: 3.3 Configure Data Access Control Lists\nv7: 14.6 Protect Information through Access Control Lists",
      "check_type": "Manual",
      "check_value": "",
      "id": "5.2.2"
    },
    {
      "title": "Ensure permissions on SSH public host key files are configured",
      "level": 1,
      "scored": true,
      "profile_applicability": "Level 1 - Server, Level 1 - Workstation",
      "description": "An SSH public key is one of two files used in SSH public key authentication. In this authentication method, a public key is a key that can be used for verifying digital signatures generated using a corresponding private key. Only a public key that corresponds to a private key will be able to authenticate successfully.",
      "rationale": "If a public host key file is modified by an unauthorized user, the SSH service may be compromised.",
      "audit": "Run the following command and verify Access is 0644, Uid is 0/root, and Gid is 0/root:\n# find /etc/ssh -xdev -type f -name 'ssh_host_*_key.pub' -exec stat {} \\;\nAccess: (0644/-rw-r--r--) Uid: ( 0/ root) Gid: ( 0/ root)",
      "remediation": "Run the following commands to set permissions and ownership on the SSH host public key files:\n# find /etc/ssh -xdev -type f -name 'ssh_host_*_key.pub' -exec chmod 0644 {} \\;\n# find /etc/ssh -xdev -type f -name 'ssh_host_*_key.pub' -exec chown root:root {} \\;",
      "impact": "None",
      "default_value": "0644 root root",
      "references": "1. See the sshd_config(5) man page for more information.",
      "cis_controls": "v8: 3.3 Configure Data Access Control Lists\nv7: 14.6 Protect Information through Access Control Lists",
      "check_type": "Manual",
      "check_value": "",
      "id": "5.2.3"
    },
    {
      "title": "Ensure SSH access is limited",
      "level": 1,
      "scored": true,
      "profile_applicability": "Level 1 - Server, Level 1 - Workstation",
      "description": "There are several options available to limit which users and group can access the system via SSH. It is recommended that at least one of the following options be leveraged: AllowUsers, AllowGroups, DenyUsers, DenyGroups.",
      "rationale": "Restricting which users can remotely access the system via SSH will help ensure that only authorized users access the system.",
      "audit": "Run the following command and verify that output matches at least one of AllowUsers, AllowGroups, DenyUsers, or DenyGroups:\n# sshd -T -C user=root -C host=\"$(hostname)\" -C addr=\"$(grep $(hostname) /etc/hosts | awk '{print $1}')\" | grep -Ei '^\\s*(allow|deny)(users|groups)\\s+\\S+'",
      "remediation": "Edit the /etc/ssh/sshd_config file to set one or more of the parameter as follows:\nAllowUsers <userlist>\nAllowGroups <grouplist>\nDenyUsers <userlist>\nDenyGroups <grouplist>",
      "impact": "None",
      "default_value": "N/A",
      "references": "1. See the sshd_config(5) man page for more information.",
      "cis_controls": "v8: 5.4 Restrict Administrator Privileges to Dedicated Administrator Accounts\nv7: 4.3 Ensure the Use of Dedicated Administrative Accounts",
      "check_type": "Manual",
      "check_value": "",
      "id": "5.2.4"
    },
    {
      "title": "Ensure SSH LogLevel is appropriate",
      "level": 1,
      "scored": true,
      "profile_applicability": "Level 1 - Server, Level 1 - Workstation",
      "description": "INFO level is the basic level that only records login activity of SSH users. In many situations, such as Incident Response, it is important to determine when a particular user was active on a system. The logout record can eliminate those users who disconnected, which helps narrow the field.",
      "rationale": "SSH provides several logging levels with varying amounts of verbosity. DEBUG is specifically not recommended other than strictly for debugging SSH communications since it provides so much data that it is difficult to identify important security information.",
      "audit": "Run the following command and verify that output matches:\n# sshd -T -C user=root -C host=\"$(hostname)\" -C addr=\"$(grep $(hostname) /etc/hosts | awk '{print $1}')\" | grep loglevel\nloglevel VERBOSE\nOR\nloglevel INFO",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the parameter as follows:\nLogLevel VERBOSE\nOR\nLogLevel INFO",
      "impact": "None",
      "default_value": "LogLevel INFO",
      "references": "1. See the sshd_config(5) man page for more information.",
      "cis_controls": "v8: 8.2 Collect Audit Logs\nv7: 6.2 Activate audit logging",
      "check_type": "Manual",
      "check_value": "",
      "id": "5.2.5"
    },
    {
      "title": "Ensure SSH X11 forwarding is disabled",
      "level": 2,
      "scored": true,
      "profile_applicability": "Level 2 - Server, Level 1 - Workstation",
      "description": "The X11Forwarding parameter provides the ability to tunnel X11 traffic through the connection to enable remote graphic connections.",
      "rationale": "Disable X11 forwarding unless there is an operational requirement to use X11 applications directly. There is a small risk that the remote X11 servers of users who are logged in via SSH with X11 forwarding could be compromised by other users on the X11 server. Note that even if X11 forwarding is disabled, users can always install their own forwarders.",
      "audit": "Run the following command and verify that output matches:\n# sshd -T -C user=root -C host=\"$(hostname)\" -C addr=\"$(grep $(hostname) /etc/hosts | awk '{print $1}')\" | grep x11forwarding\nx11forwarding no",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the parameter as follows:\nX11Forwarding no",
      "impact": "None",
      "default_value": "X11Forwarding yes",
      "references": "1. See the sshd_config(5) man page for more information.",
      "cis_controls": "v8: 4.8 Uninstall or Disable Unnecessary Services on Enterprise Assets and Software\nv7: 9.2 Ensure Only Approved Ports, Protocols and Services Are Running",
      "check_type": "Manual",
      "check_value": "",
      "id": "5.2.6"
    },
    {
      "title": "Ensure SSH MaxAuthTries is set to 4 or less",
      "level": 1,
      "scored": true,
      "profile_applicability": "Level 1 - Server, Level 1 - Workstation",
      "description": "The MaxAuthTries parameter specifies the maximum number of authentication attempts permitted per connection. When the login failure count reaches half the number, error messages will be written to the syslog file detailing the login failure.",
      "rationale": "Setting the MaxAuthTries parameter to a low number will minimize the risk of successful brute force attacks to the SSH server. While the recommended setting is 4, set the number based on site policy.",
      "audit": "Run the following command and verify that output MaxAuthTries is 4 or less:\n# sshd -T -C user=root -C host=\"$(hostname)\" -C addr=\"$(grep $(hostname) /etc/hosts | awk '{print $1}')\" | grep maxauthtries\nmaxauthtries 4",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the parameter as follows:\nMaxAuthTries 4",
      "impact": "None",
      "default_value": "MaxAuthTries 6",
      "references": "1. See the sshd_config(5) man page for more information.",
      "cis_controls": "v8: 4.1 Establish and Maintain a Secure Configuration Process\nv7: 16.13 Alert on Account Login Behavior Deviation",
      "check_type": "Manual",
      "check_value": "",
      "id": "5.2.7"
    },
    {
      "title": "Ensure SSH IgnoreRhosts is enabled",
      "level": 1,
      "scored": true,
      "profile_applicability": "Level 1 - Server, Level 1 - Workstation",
      "description": "The IgnoreRhosts parameter specifies that .rhosts and .shosts files will not be used in RhostsRSAAuthentication or HostbasedAuthentication.",
      "rationale": "Setting this parameter forces users to enter a password when authenticating with ssh.",
      "audit": "Run the following command and verify that output matches:\n# sshd -T -C user=root -C host=\"$(hostname)\" -C addr=\"$(grep $(hostname) /etc/hosts | awk '{print $1}')\" | grep ignorerhosts\nignorehosts yes",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the parameter as follows:\nIgnoreRhosts yes",
      "impact": "None",
      "default_value": "IgnoreRhosts yes",
      "references": "1. See the sshd_config(5) man page for more information.",
      "cis_controls": "v8: 4.1 Establish and Maintain a Secure Configuration Process\nv7: 9.2 Ensure Only Approved Ports, Protocols and Services Are Running",
      "check_type": "Manual",
      "check_value": "",
      "id": "5.2.8"
    }
  ]
}