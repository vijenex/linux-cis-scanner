{
  "milestone": "6.2 System Auditing",
  "version": "1.0.0",
  "description": "Ubuntu 22.04 LTS CIS Benchmark - Section 6.2 System Auditing",
  "controls": [
    {
      "id": "6.2.1.1",
      "title": "Ensure auditd packages are installed",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "MultiPackage",
      "package_names": [
        "auditd",
        "audispd-plugins"
      ],
      "should_be_installed": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.1.1",
      "description": "auditd is the userspace component to the Linux Auditing System. It's responsible for writing audit records to the disk",
      "remediation": "Run the following command to Install auditd and audispd-plugins\n# apt install auditd audispd -plugins"
    },
    {
      "id": "6.2.1.2",
      "title": "Ensure auditd service is enabled and active",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "Service",
      "service_name": "auditd",
      "expected_status": "enabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.1.2",
      "description": "Turn on the auditd daemon to record system events.",
      "remediation": "Run the following commands to unmask, enable and start auditd :\n# systemctl unmask auditd\n# systemctl enable auditd\n# systemctl start auditd"
    },
    {
      "id": "6.2.1.3",
      "title": "Ensure auditing for processes that start prior to auditd is enabled",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "BootParameter",
      "parameters": [
        "audit=1"
      ],
      "config_file": "/etc/default/grub",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.1.3",
      "description": "Configure grub2 so that processes that are capable of being audited can be audited even if they start up prior to auditd startup.",
      "remediation": "Edit /etc/default/grub and add audit=1 to GRUB_CMDLINE_LINUX :\nExample:\nGRUB_CMDLINE_LINUX=\"audit=1\"\nRun the following command to update the grub2 configuration:\n# update -grub"
    },
    {
      "id": "6.2.1.4",
      "title": "Ensure audit_backlog_limit is configured",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "BootParameter",
      "parameters": [
        "audit_backlog_limit=8192"
      ],
      "config_file": "/etc/default/grub",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.1.4",
      "description": "In the kernel -level audit subsystem, a socket buffer queue is used to hold audit events.\nWhenever a new audit event is received, it is logged and prepared to be added to this queue.\nThe kernel boot parameter audit_backlog_limit=N , with N representing the amount of messages, will ensure that a queue cannot grow beyond a certain size. If an audit event is logged which would grow the queue beyond this limit, then a failure occurs and is handled according to the system configuration",
      "remediation": "Edit /etc/default/grub and add audit_backlog_limit=N to GRUB_CMDLINE_LINUX. The recommended size for N is 8192 or larger.\nExample:\nGRUB_CMDLINE_LINUX=\"audit_backlog_limit=8192\"\nRun the following command to update the grub2 configuration:\n# update -grub"
    },
    {
      "id": "6.2.2.1",
      "title": "Ensure audit log storage size is configured",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "AuditdConfig",
      "config_file": "/etc/audit/auditd.conf",
      "parameter": "max_log_file",
      "expected_value": "",
      "check_configured": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.2.1",
      "description": "Configure the maximum size of the audit log file. Once the log reaches the maximum size, it will be rotated and a new log file will be started.",
      "remediation": "Set the following parameter in /etc/audit/auditd.conf in accordance with site policy:\nmax_log_file = <MB>"
    },
    {
      "id": "6.2.2.2",
      "title": "Ensure audit logs are not automatically deleted",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "AuditdConfig",
      "config_file": "/etc/audit/auditd.conf",
      "parameter": "max_log_file_action",
      "expected_value": "keep_logs",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.2.2",
      "description": "The max_log_file_action setting determines how to handle the audit log file reaching the max file size. A value of keep_logs will rotate the logs but never delete old logs.",
      "remediation": "Set the following parameter in /etc/audit/auditd.conf:\nmax_log_file_action = keep_logs"
    },
    {
      "id": "6.2.2.3",
      "title": "Ensure system is disabled when audit logs are full",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "AuditdConfig",
      "config_file": "/etc/audit/auditd.conf",
      "parameter": "admin_space_left_action",
      "expected_value": "halt",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.2.3",
      "description": "The auditd daemon can be configured to halt the system or put the system in single user mode, if no free space is available or an error is detected on the partition that holds the audit log files.\nThe disk_full_action parameter tells the system what action to take when no free space is available on the partition that holds the audit log files. Valid values are ignore , syslog , rotate , exec , suspend , single , and halt .\n• ignore , the audit daemon will issue a syslog message but no other action is taken • syslog , the audit daemon will issue a warning to syslog • rotate , the audit daemon will rotate logs, losing the oldest to free up space • exec , /path -to-script will execute the script. You cannot pass parameters to the script. The script is also responsible for telling the auditd daemon to resume logging once its completed its action • suspend , the audit daemon will stop writing records to the disk • single , the audit daemon will put the computer system in single user mode • halt , the audit daemon will shut down the system The disk_error_action parameter tells the system what action to take when an error is detected on the partition that holds the audit log files. Valid values are ignore , syslog , exec , suspend , single , and halt .\n• ignore , the audit daemon will not take any action • syslog , the audit daemon will issue no more than 5 consecutive warnings to syslog • exec , /path -to-script will execute the script. You cannot pass parameters to the script • suspend , the audit daemon will stop writing records to the disk • single , the audit daemon will put the computer system in single user mode • halt , the audit daemon will shut down the system",
      "remediation": "Set one of the following parameters in /etc/audit/auditd.conf depending on your local security policies.\ndisk_full_action = <halt|single> disk_error_action = <syslog|single|halt> Example:\ndisk_full_action = halt disk_error_action = halt Internal Only - General"
    },
    {
      "id": "6.2.2.4",
      "title": "Ensure system warns when audit logs are low on space",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "AuditdConfig",
      "config_file": "/etc/audit/auditd.conf",
      "parameter": "space_left_action",
      "expected_value": "email",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.2.4",
      "description": "The auditd daemon can be configured to halt the system, put the system in single user mode or send a warning message, if the partition that holds the audit log files is low on space.\nThe space_left_action parameter tells the system what action to take when the system has detected that it is starting to get low on disk space. Valid values are ignore , syslog , rotate , email , exec , suspend , single , and halt .\n• ignore , the audit daemon does nothing • syslog , the audit daemon will issue a warning to syslog • rotate , the audit daemon will rotate logs, losing the oldest to free up space • email , the audit daemon will send a warning to the email account specified in action_mail_acct as well as sending the message to syslog • exec , /path -to-script will execute the script. You cannot pass parameters to the script. The script is also responsible for telling the auditd daemon to resume logging once its completed its action • suspend , the audit daemon will stop writing records to the disk • single , the audit daemon will put the computer system in single user mode • halt , the audit daemon will shut down the system The admin_space_left_action parameter tells the system what action to take when the system has detected that it is low on disk space. Valid values are ignore , syslog , rotate , email , exec , suspend , single , and halt .\n• ignore , the audit daemon does nothing • syslog , the audit daemon will issue a warning to syslog • rotate , the audit daemon will rotate logs, losing the oldest to free up space • email , the audit daemon will send a warning to the email account specified in action_mail_acct as well as sending the message to syslog • exec , /path -to-script will execute the script. You cannot pass parameters to the script. The script is also responsible for telling the auditd daemon to resume logging once its completed its action • suspend , the audit daemon will stop writing records to the disk • single , the audit daemon will put the computer system in single user mode • halt , the audit daemon will shut down the system  Internal Only - General",
      "remediation": "Set the space_left_action parameter in /etc/audit/auditd.conf to email , exec , single , or halt :\nExample:\nspace_left_action = email\nSet the admin_space_left_action parameter in /etc/audit/auditd.conf to single or halt :\nExample:\nadmin_space_left_action = single Note: A Mail Transfer Agent (MTA) must be installed and configured properly to set space_left_action = email Internal Only - General"
    },
    {
      "id": "6.2.3.1",
      "title": "Ensure changes to system administration scope (sudoers) is collected",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "AuditRule",
      "rule_file": "/etc/audit/rules.d/50-scope.rules",
      "expected_rules": [
        "-w /etc/sudoers -p wa -k scope",
        "-w /etc/sudoers.d -p wa -k scope"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.3.1",
      "description": "Monitor scope changes for system administrators. If the system has been properly configured to force system administrators to log in as themselves first and then use the sudo command to execute privileged commands, it is possible to monitor changes in scope. The file /etc/sudoers , or files in /etc/sudoers.d , will be written to when the file(s) or related attributes have changed. The audit records will be tagged with the identifier \"scope\".",
      "remediation": "Edit or create a file in the /etc/audit/rules.d/ directory, ending in .rules extension, with the relevant rules to monitor scope changes for system administrators.\nExample:\n# printf \" -w /etc/sudoers -p wa -k scope -w /etc/sudoers.d -p wa -k scope \" >> /etc/audit/rules.d/50 -scope.rules Merge and load the rules into active configuration:\n# augenrules --load Check if reboot is required.\n# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules \"; fi"
    },
    {
      "id": "6.2.4.1",
      "title": "Ensure audit log files mode is configured",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "AuditLogPermissions",
      "log_directory": "/var/log/audit",
      "expected_file_mode": "640",
      "expected_owner": "root",
      "expected_group": "adm",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.4.1",
      "description": "Audit log files contain information about the system and system activity.",
      "remediation": "Run the following command to remove more permissive mode than 0640 from audit log files:\n# [ -f /etc/audit/auditd.conf ] && find \"$(dirname $(awk -F \"=\" '/^*log_file/ print $2' /etc/audit/auditd.conf | xargs))\" -type f -perm /0137 -exec chmod u -x,g-wx,o-rwx +"
    },
    {
      "id": "6.2.4.5",
      "title": "Ensure audit configuration files mode is configured",
      "section": "System Auditing",
      "profile": "Level2",
      "type": "FilePermission",
      "file_path": "/etc/audit/auditd.conf",
      "expected_mode": "640",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.4.5",
      "description": "Audit configuration files control auditd and what events are audited.",
      "remediation": "Run the following command to remove more permissive mode than 0640 from the audit configuration files:\n# find /etc/audit/ -type f \\( -name '*.conf' -o -name '*.rules' \\) -exec chmod u-x,g-wx,o-rwx +"
    }
  ]
}