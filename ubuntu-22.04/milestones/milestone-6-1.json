{
  "milestone": "6.1 System Logging",
  "version": "1.0.0",
  "description": "Ubuntu 22.04 LTS CIS Benchmark - Section 6.1 System Logging",
  "controls": [
    {
      "id": "6.1.1.1.1",
      "title": "Ensure journald service is active",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Service",
      "service_name": "systemd-journald",
      "expected_status": "enabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.1.1",
      "description": "Ensure that the systemd-journald service is enabled to allow capturing of logging events.",
      "remediation": "Run the following commands to unmask, enable, and start systemd- journald.service\n# systemctl unmask systemd -journald.service\n# systemctl --now enable systemd -journald.service",
      "automated": true
    },
    {
      "id": "6.1.1.1.2",
      "title": "Ensure journald log file access is configured",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.1.2",
      "description": "Journald will create logfiles that do not already exist on the system. This setting controls what permissions will be applied to these newly created files.",
      "remediation": "If the default configuration is not appropriate for the site specific requirements, copy /usr/lib/tmpfiles.d/systemd.conf to /etc/tmpfiles.d/systemd.conf and\nmodify as required. Requirements is either 0640 or site policy if that is less restrictive.",
      "automated": false
    },
    {
      "id": "6.1.1.1.3",
      "title": "Ensure journald log file rotation is configured",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.1.3",
      "description": "Journald includes the capability of rotating log files regularly to avoid filling up the system with logs or making the logs unmanageably large. The file /etc/systemd/journald.conf is the configuration file used to specify how logs generated by Journald should be rotated.",
      "remediation": "Edit /etc/systemd/journald.conf or a file ending in .conf the /etc/systemd/journald.conf.d/ directory. Set the following parameters in the [Journal] section to ensure logs are rotated according to site policy. The settings should be carefully understood as there are specific edge cases and prioritization of parameters.\nExample Configuration [Journal] SystemMaxUse=1G SystemKeepFree=500M\nRuntimeMaxUse=200M\nRuntimeKeepFree=50M MaxFileSec=1month Note: If these settings appear in a canonically later file, or later in the same file, the\nsetting will be overwritten",
      "automated": false
    },
    {
      "id": "6.1.1.1.4",
      "title": "Ensure journald ForwardToSyslog is disabled",
      "section": "System Logging",
      "profile": "Level1",
      "type": "JournaldConfig",
      "config_file": "/etc/systemd/journald.conf",
      "parameter": "ForwardToSyslog",
      "expected_value": "no",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.1.4",
      "description": "Data from journald should be kept in the confines of the service and not forwarded to other services.",
      "remediation": "- IF - rsyslog is the preferred method for capturing logs, this section and Recommendation should be skipped and the \"Configure rsyslog\" section followed.\n- IF - journald is the preferred method for capturing logs:\nSet the following parameter in the [Journal] section in /etc/systemd/journald.conf or a file in /etc/systemd/journald.conf.d/ ending in .conf :\nForwardToSyslog=no Example:\n#!/usr/bin/env bash [ ! -d /etc/systemd/journald.conf.d/ ] && mkdir -p /etc/systemd/journald.conf.d/ if grep -Psq -- '^*\\[Journal \\]' /etc/systemd/journald.conf.d/60 - journald.conf; then printf '%s ' \"\" \"ForwardToSyslog=no\" >> /etc/systemd/journald.conf.d/60 -journald.conf else printf '%s ' \"\" \"[Journal]\" \"ForwardToSyslog=no\" >> /etc/systemd/journald.conf.d/60 -journald.conf fi Note: Drop -in configuration files have higher precedence and override the main configuration file. Files in the *.conf.d/ configuration subdirectories are sorted by their filename in lexicographic order, regardless of in which of the subdirectories they reside.\nWhen multiple files specify the same option, for options which accept just a single value, the entry in the file so rted last takes precedence, and for options which accept a list of values, entries are collected as they occur in the sorted files.\nRun to following command to update the parameters in the service:\n# systemctl reload -or-restart systemd -journald",
      "automated": true
    },
    {
      "id": "6.1.1.1.5",
      "title": "Ensure journald Storage is configured",
      "section": "System Logging",
      "profile": "Level1",
      "type": "JournaldConfig",
      "config_file": "/etc/systemd/journald.conf",
      "parameter": "Storage",
      "expected_value": "persistent",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.1.5",
      "description": "Data from journald may be stored in volatile memory or persisted locally on the server.\nLogs in memory will be lost upon a system reboot. By persisting logs to local disk on the server they are protected from loss due to a reboot.",
      "remediation": "Set the following parameter in the [Journal] section in /etc/systemd/journald.conf or a file in /etc/systemd/journald.conf.d/ ending in .conf :\nStorage=persistent Example:\n#!/usr/bin/env bash [ ! -d /etc/systemd/journald.conf.d/ ] && mkdir -p /etc/systemd/journald.conf.d/ if grep -Psq -- '^*\\[Journal \\]' /etc/systemd/journald.conf.d/60 - journald.conf; then printf '%s ' \"Storage=persistent\" >> /etc/systemd/journald.conf.d/60 - journald.conf else printf '%s ' \"\" \"[Journal]\" \"Storage=persistent\" >> /etc/systemd/journald.conf.d/60 -journald.conf fi Note: Drop -in configuration files have higher precedence and override the main configuration file. Files in the *.conf.d/ configuration subdirectories are sorted by their filename in lexicographic order, regardless of in which of the subdirectories they reside.\nWhen multiple files specify the same option, for options which accept just a single value, the entry in the file so rted last takes precedence, and for options which accept a list of values, entries are collected as they occur in the sorted files.\nRun to following command to update the parameters in the service:\n# systemctl reload -or-restart systemd -journald",
      "automated": true
    },
    {
      "id": "6.1.1.1.6",
      "title": "Ensure journald Compress is configured",
      "section": "System Logging",
      "profile": "Level1",
      "type": "JournaldConfig",
      "config_file": "/etc/systemd/journald.conf",
      "parameter": "Compress",
      "expected_value": "yes",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.1.6",
      "description": "The journald system includes the capability of compressing overly large files to avoid filling up the system with logs or making the logs unmanageably large.",
      "remediation": "Set the following parameter in the [Journal] section in /etc/systemd/journald.conf or a file in /etc/systemd/journald.conf.d/ ending in .conf :\nCompress=yes Example:\n#!/usr/bin/env bash [ ! -d /etc/systemd/journald.conf.d/ ] && mkdir -p /etc/systemd/journald.conf.d/ if grep -Psq -- '^*\\[Journal \\]' /etc/systemd/journald.conf.d/60 - journald.conf; then printf '%s ' \"\" \"Compress=yes\" >> /etc/systemd/journald.conf.d/60 - journald.conf else printf '%s ' \"\" \"[Journal]\" \"Compress=yes\" >> /etc/systemd/journald.conf.d/60 -journald.conf fi Note: Drop -in configuration files have higher precedence and override the main configuration file. Files in the *.conf.d/ configuration subdirectories are sorted by their filename in lexicographic order, regardless of in which of the subdirectories they reside.\nWhen multiple files specify the same option, for options which accept just a single value, the entry in the file so rted last takes precedence, and for options which accept a list of values, entries are collected as they occur in the sorted files.\nRun to following command to update the parameters in the service:\n# systemctl reload -or-restart systemd -journald",
      "automated": true
    },
    {
      "id": "6.1.1.2.1",
      "title": "Ensure systemd-journal-remote is installed",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Package",
      "package_name": "systemd-journal-remote",
      "should_be_installed": false,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.2.1",
      "description": "Journald systemd-journal-remote supports the ability to send log events it gathers to a remote log host or to receive messages from remote hosts, thus enabling centralized log management.",
      "remediation": "Run the following command to install systemd-journal-remote :\n# apt install systemd -journal-remote",
      "automated": true
    },
    {
      "id": "6.1.1.2.4",
      "title": "Ensure systemd-journal-remote service is not in use",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Service",
      "service_name": "systemd-journal-remote",
      "expected_status": "disabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.2.4",
      "description": "Journald systemd-journal-remote supports the ability to receive messages from remote hosts, thus acting as a log server. Clients should not receive data from other hosts.\nNote:\n\u2022 The same package, systemd-journal-remote , is used for both sending logs to remote hosts and receiving incoming logs.\n\u2022 With regards to receiving logs, there are two services; systemd-journal- remote.socket and systemd-journal-remote.service .",
      "remediation": "Run the following commands to stop and mask systemd-journal-remote.socket and systemd -journal -remote.service:\n# systemctl stop systemd -journal-remote.socket systemd -journal-remote.service\n# systemctl mask systemd -journal-remote.socket systemd -journal-remote.service",
      "automated": true
    },
    {
      "id": "6.1.2.1",
      "title": "Ensure rsyslog is installed",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Package",
      "package_name": "rsyslog",
      "should_be_installed": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.2.1",
      "description": "The rsyslog software is recommended in environments where journald does not meet operation requirements.",
      "remediation": "Run the following command to install rsyslog :\n# apt install rsyslog",
      "automated": true
    },
    {
      "id": "6.1.2.2",
      "title": "Ensure rsyslog service is enabled and active",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Service",
      "service_name": "rsyslog",
      "expected_status": "enabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.2.2",
      "description": "Once the rsyslog package is installed, ensure that the service is enabled.",
      "remediation": "- IF - rsyslog is being used for logging on the system:\nRun the following commands to unmask, enable, and start rsyslog.service :\n# systemctl unmask rsyslog.service\n# systemctl enable rsyslog.service\n# systemctl start rsyslog.service",
      "automated": true
    },
    {
      "id": "6.1.2.3",
      "title": "Ensure journald is configured to send logs to rsyslog",
      "section": "System Logging",
      "profile": "Level1",
      "type": "JournaldConfig",
      "config_file": "/etc/systemd/journald.conf",
      "parameter": "ForwardToSyslog",
      "expected_value": "yes",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.2.3",
      "description": "Data from systemd-journald may be stored in volatile memory or persisted locally on the server. Utilities exist to accept remote export of systemd-journald logs, however, use of the rsyslog service provides a consistent means of log collection and export.",
      "remediation": "- IF - Journald is the preferred method for capturing logs, this section and Recommendation should be skipped and the \"Configure Journald\" section followed.\n- IF - rsyslog is the preferred method for capturing logs:\nSet the following parameter in the [Journal] section in /etc/systemd/journald.conf or a file in /etc/systemd/journald.conf.d/ ending in .conf :\nForwardToSyslog=yes Example:\n#!/usr/bin/env bash [ ! -d /etc/systemd/journald.conf.d/ ] && mkdir /etc/systemd/journald.conf.d/ if grep -Psq -- '^*\\[Journal \\] /etc/systemd/journald.conf.d/60 - journald.conf; then printf '%s ' \"ForwardToSyslog=yes\" >> /etc/systemd/journald.conf.d/60 - journald.conf else printf '%s ' \"[Journal]\" \"ForwardToSyslog=yes\" >> /etc/systemd/journald.conf.d/60 -journald.conf fi Note: Drop -in configuration files have higher precedence and override the main configuration file. Files in the *.conf.d/ configuration subdirectories are sorted by their filename in lexicographic order, regardless of in which of the subdirectories they reside.\nWhen multiple files specify the same option, for options which accept just a single value, the entry in the file sorted last takes precedence, and for options which accept a list of values, entries are collected as they occur in the sorted files.\nRun to following command to update the parameters in the service:\nRestart systemd-journald.service :\n# systemctl reload -or-restart systemd -journald.service",
      "automated": true
    },
    {
      "id": "6.1.2.4",
      "title": "Ensure rsyslog log file creation mode is configured",
      "section": "System Logging",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/rsyslog.conf",
      "pattern": "\\$FileCreateMode\\s+0640",
      "expected_match": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.2.4",
      "description": "rsyslog will create logfiles that do not already exist on the system.\nThe global() configuration object umask , available in rsyslog 8.26.0+, sets the rsyslogd process\u2019 umask. If not specified, the system -provided default is used. The value given must always be a 4 -digit octal number, with the initial digit being zero.\nThe legacy $umask parameter sets the rsyslogd process' umask. If not specified, the system -provided default is used. The value given must always be a 4 -digit octal number, with the initial digit being zero.\nThe legacy $FileCreateMode parameter allows the setting of the mode with which rsyslogd creates new files. If not specified, the value 0644 is used. The value given must always be a 4 -digit octal number, with the initial digit being zero. Please note that the actual permission depend on rsyslogd process umask . If in doubt, use $umask 0000 right at the beginning of the configuration file to remove any restrictions.\nThe legacy $FileCreateMode may be specified multiple times. If so, it specifies the creation mode for all selector lines that follow until the next $FileCreateMode parameter. Order of lines is vitally important.",
      "remediation": "Edit either /etc/rsyslog.conf or a dedicated .conf file in /etc/rsyslog.d/ and set\n$FileCreateMode to 0640 or more restrictive:\n$FileCreateMode 0640 Restart the service:\n# systemctl restart rsyslog",
      "automated": true
    },
    {
      "id": "6.1.2.7",
      "title": "Ensure rsyslog is not configured to receive logs from a remote client",
      "section": "System Logging",
      "profile": "Level1",
      "type": "RsyslogConfig",
      "config_files": [
        "/etc/rsyslog.conf",
        "/etc/rsyslog.d/*.conf"
      ],
      "prohibited_directives": [
        "$ModLoad imtcp",
        "$InputTCPServerRun",
        "$ModLoad imudp",
        "$UDPServerRun"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.2.7",
      "description": "rsyslog supports the ability to receive messages from remote hosts, thus acting as a log server. Clients should not receive data from other hosts.",
      "remediation": "Should there be any active log server configuration found in the auditing section, modify those files and remove the specific lines highlighted by the audit. Verify none of the following entries are present in any of /etc/rsyslog.conf or /etc/rsyslog.d/*.conf .\nadvanced format module(load=\"imtcp\") input(type=\"imtcp\" port=\"514\") deprecated legacy format\n$ModLoad imtcp\n$InputTCPServerRun Restart the service:\n# systemctl restart rsyslog",
      "automated": true
    },
    {
      "id": "6.1.1.4",
      "title": "Ensure only one logging system is in use",
      "section": "System Logging",
      "profile": "Level1",
      "type": "SingleLoggingSystem",
      "logging_services": [
        "systemd-journald",
        "rsyslog",
        "syslog-ng"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.1.4",
      "reference_note": "For detailed description, rationale, impact assessment, and remediation steps, please refer to the official CIS Ubuntu Linux 22.04 Benchmark document at the above URL.",
      "automated": true
    },
    {
      "id": "6.1.2.2",
      "title": "Ensure journald ForwardToSyslog is disabled",
      "section": "System Logging",
      "profile": "Level1",
      "type": "JournaldConfig",
      "config_file": "/etc/systemd/journald.conf",
      "parameter": "ForwardToSyslog",
      "expected_value": "no",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.2.2",
      "description": "Once the rsyslog package is installed, ensure that the service is enabled.",
      "remediation": "- IF - rsyslog is being used for logging on the system:\nRun the following commands to unmask, enable, and start rsyslog.service :\n# systemctl unmask rsyslog.service\n# systemctl enable rsyslog.service\n# systemctl start rsyslog.service",
      "automated": true
    },
    {
      "id": "6.1.2.3",
      "title": "Ensure journald Compress is configured",
      "section": "System Logging",
      "profile": "Level1",
      "type": "JournaldConfig",
      "config_file": "/etc/systemd/journald.conf",
      "parameter": "Compress",
      "expected_value": "yes",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.2.3",
      "description": "Data from systemd-journald may be stored in volatile memory or persisted locally on the server. Utilities exist to accept remote export of systemd-journald logs, however, use of the rsyslog service provides a consistent means of log collection and export.",
      "remediation": "- IF - Journald is the preferred method for capturing logs, this section and Recommendation should be skipped and the \"Configure Journald\" section followed.\n- IF - rsyslog is the preferred method for capturing logs:\nSet the following parameter in the [Journal] section in /etc/systemd/journald.conf or a file in /etc/systemd/journald.conf.d/ ending in .conf :\nForwardToSyslog=yes Example:\n#!/usr/bin/env bash [ ! -d /etc/systemd/journald.conf.d/ ] && mkdir /etc/systemd/journald.conf.d/ if grep -Psq -- '^*\\[Journal \\] /etc/systemd/journald.conf.d/60 - journald.conf; then printf '%s ' \"ForwardToSyslog=yes\" >> /etc/systemd/journald.conf.d/60 - journald.conf else printf '%s ' \"[Journal]\" \"ForwardToSyslog=yes\" >> /etc/systemd/journald.conf.d/60 -journald.conf fi Note: Drop -in configuration files have higher precedence and override the main configuration file. Files in the *.conf.d/ configuration subdirectories are sorted by their filename in lexicographic order, regardless of in which of the subdirectories they reside.\nWhen multiple files specify the same option, for options which accept just a single value, the entry in the file sorted last takes precedence, and for options which accept a list of values, entries are collected as they occur in the sorted files.\nRun to following command to update the parameters in the service:\nRestart systemd-journald.service :\n# systemctl reload -or-restart systemd -journald.service",
      "automated": true
    },
    {
      "id": "6.1.2.4",
      "title": "Ensure journald Storage is configured",
      "section": "System Logging",
      "profile": "Level1",
      "type": "JournaldConfig",
      "config_file": "/etc/systemd/journald.conf",
      "parameter": "Storage",
      "expected_value": "persistent",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.2.4",
      "description": "rsyslog will create logfiles that do not already exist on the system.\nThe global() configuration object umask , available in rsyslog 8.26.0+, sets the rsyslogd process\u2019 umask. If not specified, the system -provided default is used. The value given must always be a 4 -digit octal number, with the initial digit being zero.\nThe legacy $umask parameter sets the rsyslogd process' umask. If not specified, the system -provided default is used. The value given must always be a 4 -digit octal number, with the initial digit being zero.\nThe legacy $FileCreateMode parameter allows the setting of the mode with which rsyslogd creates new files. If not specified, the value 0644 is used. The value given must always be a 4 -digit octal number, with the initial digit being zero. Please note that the actual permission depend on rsyslogd process umask . If in doubt, use $umask 0000 right at the beginning of the configuration file to remove any restrictions.\nThe legacy $FileCreateMode may be specified multiple times. If so, it specifies the creation mode for all selector lines that follow until the next $FileCreateMode parameter. Order of lines is vitally important.",
      "remediation": "Edit either /etc/rsyslog.conf or a dedicated .conf file in /etc/rsyslog.d/ and set\n$FileCreateMode to 0640 or more restrictive:\n$FileCreateMode 0640 Restart the service:\n# systemctl restart rsyslog",
      "automated": true
    },
    {
      "id": "6.1.3.1",
      "title": "Ensure rsyslog is installed",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Package",
      "package_name": "rsyslog",
      "should_be_installed": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.3.1",
      "description": "Log files contain information from many services on the the local system, or in the event of a centralized log server, others systems logs as well.\nIn general log files are found in /var/log/ , although application can be configured to store logs elsewhere. Should your application store logs in another, ensure to run the same test on that location.",
      "remediation": "Run the following script to update permissions and ownership on files in /var/log .\nAlthough the script is not destructive, ensure that the output is captured in the event that the remediation causes issues.\nInternal Only - General #!/usr/bin/env bash a_output2=() f_file_test_fix() a_out2=() maxperm=\"$( printf '%o' $(( 0777 & ~$perm_mask)) )\" if [ $(( $l_mode & $perm_mask )) -gt 0 ]; then a_out2+=(\" o Mode: \\\"$l_mode \\\" should be \\\"$maxperm \\\" or more restrictive\" \" x Removing excess permissions\") chmod \"$l_rperms\" \"$l_fname\" fi if [[ ! \"$l_user\" =~ $l_auser ]]; then a_out2+=(\" o Owned by: \\\"$l_user \\\" and should be owned by \\\"$l_auser//|/ or \\\"\" \" x Changing ownership to: \\\"$l_fix_account \\\"\") chown \"$l_fix_account\" \"$l_fname\" fi if [[ ! \"$l_group\" =~ $l_agroup ]]; then a_out2+=(\" o Group owned by: \\\"$l_group \\\" and should be group owned by \\\"$l_agroup//|/ or \\\"\" \" x Changing group ownership to: \\\"$l_fix_account \\\"\") chgrp \"$l_fix_account\" \"$l_fname\" fi [ \"$#a_out2[@]\" -gt 0 ] && a_output2+=(\" - File: \\\"$l_fname \\\" is:\" \"$a_out2[@]\") l_fix_account='root' while IFS= read -r -d $'\\0' l_file; do while IFS=: read -r l_fname l_mode l_user l_group; do if grep -Pq -- '\\/(apt)*$' <<< \"$(dirname \"$l_fname\")\"; then perm_mask='0133' l_rperms=\"u -x,go-wx\" l_auser=\"root\" l_agroup=\"(root|adm)\"; f_file_test_fix else case \"$(basename \"$l_fname\")\" in lastlog | lastlog.* | wtmp | wtmp.* | wtmp -* | btmp | btmp.* | btmp -* | README) perm_mask='0113' l_rperms=\"ug -x,o-wx\" l_auser=\"root\" l_agroup=\"(root|utmp)\" f_file_test_fix ;;\ncloud-init.log* | localmessages* | waagent.log*) perm_mask='0133' l_rperms=\"u -x,go-wx\" l_auser=\"(root|syslog)\" l_agroup=\"(root|adm)\" file_test_fix ;;\nsecure | auth.log | syslog | messages) perm_mask='0137' l_rperms=\"u -x,g-wx,o-rwx\" l_auser=\"(root|syslog)\" l_agroup=\"(root|adm)\" f_file_test_fix ;;\nSSSD | sssd) perm_mask='0117' l_rperms=\"ug -x,o-rwx\" l_auser=\"(root|SSSD)\" l_agroup=\"(root|SSSD)\" f_file_test_fix ;;\ngdm | gdm3) perm_mask='0117' l_rperms=\"ug -x,o-rwx\" l_auser=\"root\" l_agroup=\"(root|gdm|gdm3)\" f_file_test_fix ;;\n*.journal | *.journal~) perm_mask='0137' l_rperms=\"u -x,g-wx,o-rwx\" l_auser=\"root\" l_agroup=\"(root|systemd - journal)\" f_file_test_fix ;;\n*) perm_mask='0137' l_rperms=\"u -x,g-wx,o-rwx\" l_auser=\"(root|syslog)\" l_agroup=\"(root|adm)\" if [ \"$l_user\" = \"root\" ] || ! grep -Pq -- \"^*$(awk -F: '$1==\"'\"$l_user\"'\" print\n$7' /etc/passwd) \" /etc/shells; then ! grep -Pq -- \"$l_auser\" <<< \"$l_user\" && l_auser=\"(root|syslog|$l_user)\" ! grep -Pq -- \"$l_agroup\" <<< \"$l_group\" && l_agroup=\"(root|adm|$l_group)\" fi f_file_test_fix ;;\nesac fi done < <(stat -Lc '%n:%#a:%U:%G' \"$l_file\") done < <(find -L /var/log -type f \\( -perm /0137 -o ! -user root -o ! -group root \\) -print0) if [ \"$#a_output2[@]\" -le 0 ]; then # If all files passed, then we report no changes a_output+=(\" - All files in \\\"/var/log/ \\\" have appropriate permissions and ownership\") printf ' %s' \"- All files in \\\"/var/log/ \\\" have appropriate permissions and ownership\" \" o No changes required\" \"\" else printf ' %s' \"$a_output2[@]\" \"\" fi Internal Only - General Note: You may also need to change the configuration for your logging software or services for any logs that had incorrect permissions.\nIf there are services that log to other locations, ensure that those log files have the appropriate access configured.",
      "automated": true
    },
    {
      "id": "6.1.3.2",
      "title": "Ensure rsyslog service is enabled and active",
      "section": "System Logging",
      "profile": "Level1",
      "type": "Service",
      "service_name": "rsyslog",
      "expected_status": "enabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.3.2",
      "reference_note": "For detailed description, rationale, impact assessment, and remediation steps, please refer to the official CIS Ubuntu Linux 22.04 Benchmark document at the above URL.",
      "automated": true
    },
    {
      "id": "6.1.3.7",
      "title": "Ensure rsyslog is not configured to receive logs from a remote client",
      "section": "System Logging",
      "profile": "Level1",
      "type": "RsyslogConfig",
      "config_files": [
        "/etc/rsyslog.conf",
        "/etc/rsyslog.d/*.conf"
      ],
      "prohibited_directives": [
        "$ModLoad imtcp",
        "$InputTCPServerRun",
        "$ModLoad imudp",
        "$UDPServerRun"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.3.7",
      "reference_note": "For detailed description, rationale, impact assessment, and remediation steps, please refer to the official CIS Ubuntu Linux 22.04 Benchmark document at the above URL.",
      "automated": true
    },
    {
      "id": "6.1.4.1",
      "title": "Ensure access to all logfiles has been configured",
      "section": "System Logging",
      "profile": "Level1",
      "type": "LogFilePermissions",
      "log_directory": "/var/log",
      "expected_file_permissions": "640",
      "expected_dir_permissions": "750",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.1.4.1",
      "reference_note": "For detailed description, rationale, impact assessment, and remediation steps, please refer to the official CIS Ubuntu Linux 22.04 Benchmark document at the above URL.",
      "automated": true
    }
  ]
}