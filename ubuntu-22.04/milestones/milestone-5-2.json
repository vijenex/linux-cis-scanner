{
  "milestone": "5.2 Configure Privilege Escalation",
  "version": "1.0.0",
  "description": "Ubuntu 22.04 LTS CIS Benchmark - Section 5.2 Configure Privilege Escalation",
  "controls": [
    {
      "id": "5.2.1",
      "title": "Ensure sudo is installed",
      "section": "Access Control",
      "profile": "Level1",
      "type": "Package",
      "package_name": "sudo",
      "should_be_installed": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.2.1",
      "description": "sudo allows a permitted user to execute a command as the superuser or another user, as specified by the security policy. The invoking user's real (not effective) user ID is used to determine the user name with which to query the security policy.",
      "remediation": "First determine is LDAP functionality is required. If so, then install sudo-ldap , else install sudo .\nExample:\n# apt install sudo",
      "automated": true
    },
    {
      "id": "5.2.2",
      "title": "Ensure sudo commands use pty",
      "section": "Access Control",
      "profile": "Level1",
      "type": "SudoConfig",
      "config_files": [
        "/etc/sudoers",
        "/etc/sudoers.d/*"
      ],
      "required_setting": "Defaults use_pty",
      "prohibited_setting": "",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.2.2",
      "description": "sudo can be configured to run only from a pseudo terminal ( pseudo-pty).",
      "remediation": "Edit the file /etc/sudoers with visudo or a file in /etc/sudoers.d/ with visudo -f <PATH TO FILE> and add the following line:\nDefaults use_pty\nEdit the file /etc/sudoers with visudo and any files in /etc/sudoers.d/ with visudo -f <PATH TO FILE> and remove any occurrence of !use_pty Note:\n\u2022 sudo will read each file in /etc/sudoers.d , skipping file names that end in ~ or contain a . character to avoid causing problems with package manager or editor temporary/backup files.\n\u2022 Files are parsed in sorted lexical order. That is, /etc/sudoers.d/01_first will be parsed before /etc/sudoers.d/10_second .\n\u2022 Be aware that because the sorting is lexical, not numeric, /etc/sudoers.d/1_whoops would be loaded after /etc/sudoers.d/10_second .\n\u2022 Using a consistent number of leading zeroes in the file names can be used to avoid such problems.",
      "automated": true
    },
    {
      "id": "5.2.3",
      "title": "Ensure sudo log file exists",
      "section": "Access Control",
      "profile": "Level1",
      "type": "SudoConfig",
      "config_files": [
        "/etc/sudoers",
        "/etc/sudoers.d/*"
      ],
      "required_setting": "Defaults logfile=",
      "prohibited_setting": "",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.2.3",
      "description": "sudo can use a custom log file",
      "remediation": "Edit the file /etc/sudoers or a file in /etc/sudoers.d/ with visudo -f <PATH TO FILE> and add the following line:\nDefaults logfile=\"<PATH TO CUSTOM LOG FILE>\" Example:\nDefaults logfile=\"/var/log/sudo.log\" Notes:\n\u2022 sudo will read each file in /etc/sudoers.d , skipping file names that end in ~ or contain a . character to avoid causing problems with package manager or editor temporary/backup files.\n\u2022 Files are parsed in sorted lexical order. That is, /etc/sudoers.d/01_first will be parsed before /etc/sudoers.d/10_second .\n\u2022 Be aware that because the sorting is lexical, not numeric, /etc/sudoers.d/1_whoops would be loaded after /etc/sudoers.d/10_second .\n\u2022 Using a consistent number of leading zeroes in the file names can be used to avoid such problems.\nInternal Only - General",
      "automated": true
    },
    {
      "id": "5.2.4",
      "title": "Ensure users must provide password for escalation",
      "section": "Access Control",
      "profile": "Level1",
      "type": "SudoConfig",
      "config_files": [
        "/etc/sudoers",
        "/etc/sudoers.d/*"
      ],
      "required_setting": "",
      "prohibited_setting": "NOPASSWD",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.2.4",
      "description": "The operating system must be configured so that users must provide a password for privilege escalation.",
      "remediation": "Based on the outcome of the audit procedure, use visudo -f <PATH TO FILE> to edit the relevant sudoers file.\nRemove any line with occurrences of NOPASSWD tags in the file.",
      "automated": true
    },
    {
      "id": "5.2.5",
      "title": "Ensure re-authentication for privilege escalation is not disabled globally",
      "section": "Access Control",
      "profile": "Level1",
      "type": "SudoConfig",
      "config_files": [
        "/etc/sudoers",
        "/etc/sudoers.d/*"
      ],
      "required_setting": "",
      "prohibited_setting": "!authenticate",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.2.5",
      "description": "The operating system must be configured so that users must re -authenticate for privilege escalation.",
      "remediation": "Configure the operating system to require users to reauthenticate for privilege escalation.\nBased on the outcome of the audit procedure, use visudo -f <PATH TO FILE> to edit the relevant sudoers file.\nRemove any occurrences of !authenticate tags in the file(s).",
      "automated": true
    },
    {
      "id": "5.2.6",
      "title": "Ensure sudo timestamp_timeout is configured",
      "section": "Access Control",
      "profile": "Level1",
      "type": "SudoConfig",
      "config_files": [
        "/etc/sudoers",
        "/etc/sudoers.d/*"
      ],
      "required_setting": "Defaults timestamp_timeout=",
      "prohibited_setting": "",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.2.6",
      "description": "sudo timestamp_timeout controls how long a user's sudo privileges remain active after the initial password entry.",
      "remediation": "Edit the file listed in the audit section with visudo -f <PATH TO FILE> and modify the entry timestamp_timeout= to 15 minutes or less as per your site policy. The value is in minutes. This particular entry may appear on its own, or on the same line as env_reset . See the following two examples:\nExample 1:\nDefaults env_reset, timestamp_timeout=15 Example 2:\nDefaults timestamp_timeout=15 Defaults env_reset",
      "automated": true
    },
    {
      "id": "5.2.7",
      "title": "Ensure access to the su command is restricted",
      "section": "Access Control",
      "profile": "Level1",
      "type": "PAMConfig",
      "config_file": "/etc/pam.d/su",
      "required_setting": "auth required pam_wheel.so use_uid",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.2.7",
      "description": "The su command allows a user to run a command or shell as another user. The program has been superseded by sudo , which allows for more granular control over privileged access. Normally, the su command can be executed by any user. By uncommenting the pam_wheel.so statement in /etc/pam.d/su , the su command will only allow users in a specific groups to execute su. This group should be empty to reinforce the use of sudo for privileged access.",
      "remediation": "Create an empty group that will be specified for use of the su command. The group should be named according to site policy.\nExample:\n# groupadd sugroup\nAdd the following line to the /etc/pam.d/su file, specifying the empty group:\nauth required pam_wheel.so use_uid group=sugroup",
      "automated": true
    }
  ]
}