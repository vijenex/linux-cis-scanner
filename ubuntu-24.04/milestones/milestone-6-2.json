{
  "milestone": "6.2",
  "title": "System Auditing",
  "description": "CIS Ubuntu Linux 24.04 LTS Benchmark - Section 6.2: System Auditing",
  "version": "1.0.0",
  "controls": [
    {
      "id": "6.2.1.1",
      "title": "Ensure auditd packages are installed",
      "section": "6.2.1.1 Configure auditd Service",
      "profile": "Level2",
      "automated": true,
      "type": "MultiPackage",
      "package_names": [
        "auditd",
        "audispd-plugins"
      ],
      "should_be_installed": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.1.1",
      "description": "auditd is the userspace component to the Linux Auditing System. It's responsible for writing audit records to the disk",
      "remediation": "Run the following command to Install auditd and audispd-plugins\n# apt install auditd audispd -plugins"
    },
    {
      "id": "6.2.1.2",
      "title": "Ensure auditd service is enabled and active",
      "section": "6.2.1.2 Configure auditd Service",
      "profile": "Level2",
      "automated": true,
      "type": "Service",
      "service_name": "auditd",
      "expected_status": "enabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.1.2",
      "description": "Turn on the auditd daemon to record system events.",
      "remediation": "Run the following commands to unmask, enable and start auditd :\n# systemctl unmask auditd\n# systemctl enable auditd\n# systemctl start auditd"
    },
    {
      "id": "6.2.1.3",
      "title": "Ensure auditing for processes that start prior to auditd is enabled",
      "section": "6.2.1.3 Configure auditd Service",
      "profile": "Level2",
      "automated": true,
      "type": "BootParameter",
      "parameters": [
        "audit=1"
      ],
      "config_file": "/etc/default/grub",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.1.3",
      "description": "Configure grub2 so that processes that are capable of being audited can be audited even if they start up prior to auditd startup.",
      "remediation": "Edit /etc/default/grub and add audit=1 to GRUB_CMDLINE_LINUX :\nExample:\nGRUB_CMDLINE_LINUX=\"audit=1\"\nRun the following command to update the grub2 configuration:\n# update -grub"
    },
    {
      "id": "6.2.1.4",
      "title": "Ensure audit_backlog_limit is sufficient",
      "section": "6.2.1.4 Configure auditd Service",
      "profile": "Level2",
      "automated": true,
      "type": "BootParameter",
      "parameters": [
        "audit_backlog_limit=8192"
      ],
      "config_file": "/etc/default/grub",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.1.4",
      "description": "In the kernel -level audit subsystem, a socket buffer queue is used to hold audit events.\nWhenever a new audit event is received, it is logged and prepared to be added to this queue.\nThe kernel boot parameter audit_backlog_limit=N , with N representing the amount of messages, will ensure that a queue cannot grow beyond a certain size. If an audit event is logged which would grow the queue beyond this limit, then a failure occurs and is handled according to the system configuration",
      "remediation": "Edit /etc/default/grub and add audit_backlog_limit=N to GRUB_CMDLINE_LINUX. The recommended size for N is 8192 or larger.\nExample:\nGRUB_CMDLINE_LINUX=\"audit_backlog_limit=8192\"\nRun the following command to update the grub2 configuration:\n# update -grub"
    },
    {
      "id": "6.2.2.1",
      "title": "Ensure audit log storage size is configured",
      "section": "6.2.2.1 Configure Data Retention",
      "profile": "Level2",
      "automated": true,
      "type": "AuditdConfig",
      "config_file": "/etc/audit/auditd.conf",
      "parameter": "max_log_file",
      "check_configured": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.2.1",
      "description": "Configure the maximum size of the audit log file. Once the log reaches the maximum size, it will be rotated and a new log file will be started.",
      "remediation": "Set the following parameter in /etc/audit/auditd.conf in accordance with site policy:\nmax_log_file = <MB>"
    },
    {
      "id": "6.2.2.2",
      "title": "Ensure audit logs are not automatically deleted",
      "section": "6.2.2.2 Configure Data Retention",
      "profile": "Level2",
      "automated": true,
      "type": "AuditdConfig",
      "config_file": "/etc/audit/auditd.conf",
      "parameter": "max_log_file_action",
      "expected_value": "keep_logs",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.2.2",
      "description": "The max_log_file_action setting determines how to handle the audit log file reaching the max file size. A value of keep_logs will rotate the logs but never delete old logs.",
      "remediation": "Set the following parameter in /etc/audit/auditd.conf:\nmax_log_file_action = keep_logs"
    },
    {
      "id": "6.2.3.1",
      "title": "Ensure changes to system administration scope (sudoers) is collected",
      "section": "6.2.3.1 Configure auditd Rules",
      "profile": "Level2",
      "automated": true,
      "type": "AuditRule",
      "rule_file": "/etc/audit/rules.d/50-scope.rules",
      "expected_rules": [
        "-w /etc/sudoers -p wa -k scope",
        "-w /etc/sudoers.d/ -p wa -k scope"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.3.1",
      "description": "Monitor scope changes for system administrators. If the system has been properly configured to force system administrators to log in as themselves first and then use the sudo command to execute privileged commands, it is possible to monitor changes in scope. The file /etc/sudoers , or files in /etc/sudoers.d , will be written to when the file(s) or related attributes have changed. The audit records will be tagged with the identifier \"scope\".",
      "remediation": "Edit or create a file in the /etc/audit/rules.d/ directory, ending in .rules extension, with the relevant rules to monitor scope changes for system administrators.\nExample:\n# printf \" -w /etc/sudoers -p wa -k scope -w /etc/sudoers.d -p wa -k scope \" >> /etc/audit/rules.d/50 -scope.rules Merge and load the rules into active configuration:\n# augenrules --load Check if reboot is required.\n# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules \"; fi"
    },
    {
      "id": "6.2.3.4",
      "title": "Ensure events that modify date and time information are collected",
      "section": "6.2.3.4 Configure auditd Rules",
      "profile": "Level2",
      "automated": true,
      "type": "AuditRule",
      "rule_file": "/etc/audit/rules.d/50-time-change.rules",
      "expected_rules": [
        "-a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change",
        "-a always,exit -F arch=b32 -S adjtimex -S settimeofday -S stime -k time-change",
        "-a always,exit -F arch=b64 -S clock_settime -k time-change",
        "-a always,exit -F arch=b32 -S clock_settime -k time-change",
        "-w /etc/localtime -p wa -k time-change"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.3.4",
      "description": "Capture events where the system date and/or time has been modified. The parameters in this section are set to determine if the;\n• adjtimex - tune kernel clock • settimeofday - set time using timeval and timezone structures • stime - using seconds since 1/1/1970 • clock_settime - allows for the setting of several internal clocks and timers system calls have been executed. Further, ensure to write an audit record to the configured audit log file upon exit, tagging the records with a unique identifier such as \"time -change\".",
      "remediation": "Create audit rules\nEdit or create a file in the /etc/audit/rules.d/ directory, ending in .rules extension, with the relevant rules to monitor events that modify date and time information.\nExample:\n# printf \" -a always,exit -F arch=b64 -S adjtimex,settimeofday -k time-change -a always,exit -F arch=b32 -S adjtimex,settimeofday -k time-change -a always,exit -F arch=b64 -S clock_settime -F a0=0x0 -k time-change -a always,exit -F arch=b32 -S clock_settim e -F a0=0x0 -k time-change -w /etc/localtime -p wa -k time-change \" >> /etc/audit/rules.d/50 -time-change.rules Load audit rules Merge and load the rules into active configuration:\n# augenrules --load Check if reboot is required.\n# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules \"; fi"
    },
    {
      "id": "6.2.3.20",
      "title": "Ensure the audit configuration is immutable",
      "section": "6.2.3.20 Configure auditd Rules",
      "profile": "Level2",
      "automated": true,
      "type": "AuditRule",
      "rule_file": "/etc/audit/rules.d/99-finalize.rules",
      "expected_rules": [
        "-e 2"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.3.20",
      "description": "Set system audit so that audit rules cannot be modified with auditctl . Setting the flag \"-e 2\" forces audit to be put in immutable mode. Audit changes can only be made on system reboot.\nNote: This setting will require the system to be rebooted to update the active auditd configuration settings.",
      "remediation": "Edit or create the file /etc/audit/rules.d/99 -finalize.rules and add the line -e 2 at the end of the file:\nExample:\n# printf ' %s' \"-e 2\" >> /etc/audit/rules.d/99 -finalize.rules Load audit rules Merge and load the rules into active configuration:\n# augenrules --load Check if reboot is required.\n# if [[ $(auditctl -s | grep \"enabled\") =~ \"2\" ]]; then printf \"Reboot required to load rules \"; fi"
    },
    {
      "id": "6.2.4.1",
      "title": "Ensure audit log files mode is configured",
      "section": "6.2.4.1 Configure auditd File Access",
      "profile": "Level2",
      "automated": true,
      "type": "AuditLogPermissions",
      "log_directory": "/var/log/audit",
      "expected_file_mode": "600",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.2.4.1",
      "description": "Audit log files contain information about the system and system activity.",
      "remediation": "Run the following command to remove more permissive mode than 0640 from audit log files:\n# [ -f /etc/audit/auditd.conf ] && find \"$(dirname $(awk -F \"=\" '/^*log_file/ print $2' /etc/audit/auditd.conf | xargs))\" -type f -perm /0137 -exec chmod u -x,g-wx,o-rwx +"
    }
  ]
}