{
  "milestone": "2.3 Time Synchronization & 2.4 Job Schedulers",
  "version": "1.0.0",
  "description": "Ubuntu 22.04 LTS CIS Benchmark - Sections 2.3 Time Synchronization & 2.4 Job Schedulers",
  "controls": [
    {
      "id": "2.3.1.1",
      "title": "Ensure a single time synchronization daemon is in use",
      "section": "Services",
      "profile": "Level1",
      "type": "SingleLoggingSystem",
      "logging_services": [
        "systemd-timesyncd",
        "chrony",
        "ntp"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.3.1.1",
      "description": "System time should be synchronized between all systems in an environment. This is typically done by establishing an authoritative time server or set of servers and having all systems synchronize their clocks to them.\nNote :\n\u2022 On virtual systems where host based time synchronization is available consult your virtualization software documentation and verify that host based synchronization is in use and follows local site policy. In this scenario, this section should be skipped \u2022 Only one time synchronization method should be in use on the system.\nConfiguring multiple time synchronization methods could lead to unexpected or unreliable results",
      "remediation": "On physical systems, and virtual systems where host based time synchronization is not available.\nSelect one of the two time synchronization daemons; chrony (1) or systemd- timesyncd (2) and following the remediation procedure for the selected daemon.\nNote: enabling more than one synchronization daemon could lead to unexpected or unreliable results:\n1. chrony\nRun the following command to install chrony :\n# apt install chrony\nRun the following commands to stop and mask the systemd-timesyncd daemon:\n# systemctl stop systemd -timesyncd.service\n# systemctl mask systemd -timesyncd.service Note:\n\u2022 Subsection: Configure chrony should be followed \u2022 Subsection: Configure systemd -timesyncd should be skipped 2. systemd-timesyncd\nRun the following command to remove the chrony package:\n# apt purge chrony\n# apt autoremove chrony Note:\n\u2022 Subsection: Configure systemd -timesyncd should be followed \u2022 Subsection: Configure chrony should be skipped",
      "automated": true
    },
    {
      "id": "2.3.2.1",
      "title": "Ensure systemd-timesyncd configured with authorized timeserver",
      "section": "Services",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/systemd/timesyncd.conf",
      "pattern": "NTP=",
      "expected_match": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.3.2.1",
      "description": "NTP= \u2022 A space -separated list of NTP server host names or IP addresses. During runtime this list is combined with any per -interface NTP servers acquired from systemd -networkd.service(8). systemd -timesyncd will contact all configured system or per -interface server s in turn, until one responds. When the empty string is assigned, the list of NTP servers is reset, and all prior assignments will have no effect. This setting defaults to an empty list.\nFallbackNTP= \u2022 A space -separated list of NTP server host names or IP addresses to be used as the fallback NTP servers. Any per -interface NTP servers obtained from systemd - networkd.service(8) take precedence over this setting, as do any servers set via NTP= above. This se tting is hence only relevant if no other NTP server information is known. When the empty string is assigned, the list of NTP servers is reset, and all prior assignments will have no effect. If this option is not given, a compiled -in list of NTP servers is used.",
      "remediation": "Set NTP and/or FallbackNPT parameters to local site approved authoritative time server(s) in /etc/systemd/timesyncd.conf or a file in /etc/systemd/timesyncd.conf.d/ ending in .conf in the [Time] section:\nExample file:\n[Time] NTP=time.nist.gov # Uses the generic name for NIST's time servers FallbackNTP=time -a-g.nist.gov time -b-g.nist.gov time -c-g.nist.gov # Space separated list of NIST time servers Example script to create systemd drop -in configuration file:\n#!/usr/bin/env bash a_settings=(\"NTP=time.nist.gov\" \"FallbackNTP=time -a-g.nist.gov time -b- g.nist.gov time -c-g.nist.gov\") [ ! -d /etc/systemd/timesyncd.conf.d/ ] && mkdir /etc/systemd/timesyncd.conf.d/ if grep -Psq -- '^*\\[Time\\]' /etc/systemd /timesyncd.conf.d/60 - timesyncd.conf; then printf '%s ' \"\" \"$a_settings[@]\" >> /etc/systemd/timesyncd.conf.d/60 -timesyncd.conf else printf '%s ' \"\" \"[Time]\" \"$a_settings[@]\" >> /etc/systemd/timesyncd.conf.d/60 -timesyncd.conf fi Note: If this setting appears in a canonically later file, or later in the same file, the\nsetting will be overwritten\nRun to following command to update the parameters in the service:\n# systemctl reload -or-restart systemd -journald",
      "automated": true
    },
    {
      "id": "2.3.2.2",
      "title": "Ensure systemd-timesyncd is enabled and running",
      "section": "Services",
      "profile": "Level1",
      "type": "Service",
      "service_name": "systemd-timesyncd",
      "expected_status": "enabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.3.2.2",
      "description": "systemd -timesyncd is a daemon that has been added for synchronizing the system clock across the network",
      "remediation": "- IF - systemd-timesyncd is in use on the system, run the following commands:\nRun the following command to unmask systemd-timesyncd.service :\n# systemctl unmask systemd -timesyncd.service\nRun the following command to enable and start systemd-timesyncd.service :\n# systemctl --now enable systemd -timesyncd.service - OR - If another time synchronization service is in use on the system, run the following command to stop and mask systemd-timesyncd :\n# systemctl --now mask systemd -timesyncd.service",
      "automated": true
    },
    {
      "id": "2.3.3.1",
      "title": "Ensure chrony is configured with authorized timeserver",
      "section": "Services",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/chrony/chrony.conf",
      "pattern": "^(server|pool)",
      "expected_match": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.3.3.1",
      "description": "\u2022 server o The server directive specifies an NTP server which can be used as a time source. The client -server relationship is strictly hierarchical: a client might synchronize its system time to that of the server, but the server\u2019s system time will never be influence d by that of a client.\no This directive can be used multiple times to specify multiple servers.\no The directive is immediately followed by either the name of the server, or its IP address.\n\u2022 pool o The syntax of this directive is similar to that for the server directive, except that it is used to specify a pool of NTP servers rather than a single NTP server. The pool name is expected to resolve to multiple addresses which might change over time.\no This directive can be used multiple times to specify multiple pools.\no All options valid in the server directive can be used in this directive too.",
      "remediation": "Edit /etc/chrony/chrony.conf or a file ending in .sources in /etc/chrony/sources.d/ and add or edit server or pool lines as appropriate according to local site policy:\nEdit the Chrony configuration and add or edit the server and/or pool lines returned by the Audit Procedure as appropriate according to local site policy <[server|pool]> <[remote -server|remote -pool]> Example script to add a drop -in configuration for the pool directive:\n#!/usr/bin/env bash [ ! -d \"/etc/chrony/sources.d/\" ] && mkdir /etc/chrony/sources.d/ printf '%s ' \"\" \"#The maxsources option is unique to the pool directive\" \\ \"pool time.nist.gov iburst maxsources 4\" >> /etc/chrony/sources.d/60 - sources.sourc es chronyc reload sources &>/dev/null Example script to add a drop -in configuration for the server directive:\n#!/usr/bin/env bash [ ! -d \"/etc/chrony/sources.d/\" ] && mkdir /etc/chrony/sources.d/ printf '%s ' \"\" \"server time -a-g.nist.gov iburst\" \"server 132.163.97.3 iburst\" \\ \"server time -d-b.nist.gov iburst\" >> /etc/chrony/sources.d/60 - sources.source s chronyc reload sources &>/dev/null\nRun the following command to reload the chronyd config:\n# systemctl reload -or-restart chronyd",
      "automated": true
    },
    {
      "id": "2.3.3.2",
      "title": "Ensure chrony is running as user _chrony",
      "section": "Services",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/chrony/chrony.conf",
      "pattern": "user _chrony",
      "expected_match": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.3.3.2",
      "description": "The chrony package is installed with a dedicated user account _chrony . This account is granted the access required by the chronyd service",
      "remediation": "Add or edit the user line to /etc/chrony/chrony.conf or a file ending in .conf in /etc/chrony/conf.d/ :\nuser _chrony - OR - If another time synchronization service is in use on the system, run the following command to remove chrony from the system:\n# apt purge chrony\n# apt autoremove chrony",
      "automated": true
    },
    {
      "id": "2.3.3.3",
      "title": "Ensure chrony is enabled and running",
      "section": "Services",
      "profile": "Level1",
      "type": "Service",
      "service_name": "chrony",
      "expected_status": "enabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.3.3.3",
      "description": "chrony is a daemon for synchronizing the system clock across the network",
      "remediation": "- IF - chrony is in use on the system, run the following commands:\nRun the following command to unmask chrony.service :\n# systemctl unmask chrony.service\nRun the following command to enable and start chrony.service :\n# systemctl --now enable chrony.service - OR - If another time synchronization service is in use on the system, run the following command to remove chrony :\n# apt purge chrony\n# apt autoremove chrony",
      "automated": true
    },
    {
      "id": "2.4.1.1",
      "title": "Ensure cron daemon is enabled and active",
      "section": "Services",
      "profile": "Level1",
      "type": "Service",
      "service_name": "cron",
      "expected_status": "enabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.1",
      "description": "The cron daemon is used to execute batch jobs on the system.",
      "remediation": "- IF - cron is installed on the system:\nRun the following commands to unmask, enable, and start cron :\n# systemctl unmask \"$(systemctl list -unit-files | awk '$1~/^crond? \\.service/print $1')\"\n# systemctl --now enable \"$(systemctl list -unit-files | awk '$1~/^crond? \\.service/print $1')\"",
      "automated": true
    },
    {
      "id": "2.4.1.2",
      "title": "Ensure access to /etc/crontab is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FilePermission",
      "file_path": "/etc/crontab",
      "expected_mode": "600",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.2",
      "description": "The /etc/crontab file is used by cron to control its own jobs. The commands in this item make sure that root is the user and group owner of the file and that only the owner can access the file.",
      "remediation": "- IF - cron is installed on the system:\nRun the following commands to set ownership and permissions on /etc/crontab :\n# chown root:root /etc/crontab\n# chmod og -rwx /etc/crontab",
      "automated": true
    },
    {
      "id": "2.4.1.3",
      "title": "Ensure access to /etc/cron.hourly is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FilePermission",
      "file_path": "/etc/cron.hourly",
      "expected_mode": "700",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.3",
      "description": "This directory contains system cron jobs that need to run on an hourly basis. The files in this directory cannot be manipulated by the crontab command, but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory.",
      "remediation": "- IF - cron is installed on the system:\nRun the following commands to set ownership and permissions on the /etc/cron.hourly directory:\n# chown root:root /etc/cron.hourly/\n# chmod og -rwx /etc/cron.hourly/",
      "automated": true
    },
    {
      "id": "2.4.1.4",
      "title": "Ensure access to /etc/cron.daily is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FilePermission",
      "file_path": "/etc/cron.daily",
      "expected_mode": "700",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.4",
      "description": "The /etc/cron.daily directory contains system cron jobs that need to run on a daily basis. The files in this directory cannot be manipulated by the crontab command, but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory.",
      "remediation": "- IF - cron is installed on the system:\nRun the following commands to set ownership and permissions on the /etc/cron.daily directory:\n# chown root:root /etc/cron.daily/\n# chmod og -rwx /etc/cron.daily/",
      "automated": true
    },
    {
      "id": "2.4.1.5",
      "title": "Ensure access to /etc/cron.weekly is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FilePermission",
      "file_path": "/etc/cron.weekly",
      "expected_mode": "700",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.5",
      "description": "The /etc/cron.weekly directory contains system cron jobs that need to run on a weekly basis. The files in this directory cannot be manipulated by the crontab command but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory.",
      "remediation": "- IF - cron is installed on the system:\nRun the following commands to set ownership and permissions on the /etc/cron.weekly directory:\n# chown root:root /etc/cron.weekly/\n# chmod og -rwx /etc/cron.weekly/",
      "automated": true
    },
    {
      "id": "2.4.1.6",
      "title": "Ensure access to /etc/cron.monthly is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FilePermission",
      "file_path": "/etc/cron.monthly",
      "expected_mode": "700",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.6",
      "description": "The /etc/cron.monthly directory contains system cron jobs that need to run on a monthly basis. The files in this directory cannot be manipulated by the crontab command but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory.",
      "remediation": "- IF - cron is installed on the system:\nRun the following commands to set ownership and permissions on the /etc/cron.monthly directory:\n# chown root:root /etc/cron.monthly/\n# chmod og -rwx /etc/cron.monthly/",
      "automated": true
    },
    {
      "id": "2.4.1.7",
      "title": "Ensure access to /etc/cron.yearly is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FilePermission",
      "file_path": "/etc/cron.yearly",
      "expected_mode": "700",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.7",
      "description": "The /etc/cron.d directory contains system cron jobs that need to run in a similar manner to the hourly, daily weekly and monthly jobs from /etc/crontab , but require more granular control as to when they run. The files in this directory cannot be manipulated by the crontab command but are instead edited by system administrators using a text editor. The commands below restrict read/write and search access to user and group root, preventing regular users from accessing this directory.",
      "remediation": "- IF - cron is installed on the system:\nRun the following commands to set ownership and permissions on the /etc/cron.d directory:\n# chown root:root /etc/cron.d/\n# chmod og -rwx /etc/cron.d/",
      "automated": true
    },
    {
      "id": "2.4.1.8",
      "title": "Ensure access to /etc/cron.d is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FilePermission",
      "file_path": "/etc/cron.d",
      "expected_mode": "700",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.8",
      "description": "crontab is the program used to install, deinstall, or list the tables used to drive the cron daemon. Each user can have their own crontab, and though these are files in /var/spool/cron/crontabs , they are not intended to be edited directly.\nIf the /etc/cron.allow file exists, then you must be listed (one user per line) therein in order to be allowed to use this command. If the /etc/cron.allow file does not exist but the /etc/cron.deny file does exist, then you must not be listed in the /etc/cron.deny file in order to use this command.\nIf neither of these files exists, then depending on site -dependent configuration parameters, only the super user will be allowed to use this command, or all users will be able to use this command.\nIf both files exist then /etc/cron.allow takes precedence. Which means that /etc/cron.deny is not considered and your user must be listed in /etc/cron.allow in order to be able to use the crontab.\nRegardless of the existence of any of these files, the root administrative user is always allowed to setup a crontab.\nThe files /etc/cron.allow and /etc/cron.deny , if they exist, must be either world - readable, or readable by group crontab . If they are not, then cron will deny access to all users until the permissions are fixed.\nThere is one file for each user's crontab under the /var/spool/cron/crontabs directory. Users are not allowed to edit the files under that directory directly to ensure that only users allowed by the system to run periodic tasks can add them, and only syntactically correct crontabs will be written there. This is enforced by having the directory writable only by the crontab group and configuring crontab command with the setgid bid set for that specific group.\nNote:\n\u2022 Even though a given user is not listed in cron.allow , cron jobs can still be run as that user \u2022 The files /etc/cron.allow and /etc/cron.deny , if they exist, only controls administrative access to the crontab command for scheduling and modifying cron jobs ",
      "remediation": "- IF - cron is installed on the system:\nRun the following script to:\n\u2022 Create /etc/cron.allow if it doesn't exist \u2022 Change owner to user root \u2022 Change group owner to group root - OR - group crontab if it exists \u2022 Change mode to 640 or more restrictive\n#!/usr/bin/env bash [ ! -e \"/etc/cron.deny\" ] && touch /etc/cron.allow chmod u-x,g-wx,o-rwx /etc/cron.allow if grep -Pq -- '^*crontab \\:' /etc/group; then chown root:crontab /etc/cron.allow else chown root:root /etc/cron.allow fi - IF - /etc/cron.deny exists, run the following script to:\n\u2022 Change owner to user root \u2022 Change group owner to group root - OR - group crontab if it exists \u2022 Change mode to 640 or more restrictive\n#!/usr/bin/env bash if [ -e \"/etc/cron.deny\" ]; then chmod u-x,g-wx,o-rwx /etc/cron.deny if grep -Pq -- '^*crontab \\:' /etc/group; then chown root:crontab /etc/cron.deny else chown root:root /etc/cron.deny fi fi Note: On systems where cron is configured to use the group crontab , if the group crontab is not set as the owner of cron.allow , then cron will deny access to all users and you will see an error similar to:\nYou (<USERNAME>) are not allowed to use this program (crontab) See crontab(1) for more information",
      "automated": true
    },
    {
      "id": "2.4.1.9",
      "title": "Ensure access to crontab is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FileContent",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.1.9",
      "reference_note": "For detailed description, rationale, impact assessment, and remediation steps, please refer to the official CIS Ubuntu Linux 24.04 Benchmark document at the above URL.",
      "automated": true,
      "file_path": "/etc/cron.allow /etc/cron.deny",
      "pattern": ".*",
      "expected_result": "found"
    },
    {
      "id": "2.4.2.1",
      "title": "Ensure access to at is configured",
      "section": "Services",
      "profile": "Level1",
      "type": "FilePermission",
      "file_path": "/etc/at.allow",
      "expected_mode": "600",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "2.4.2.1",
      "description": "at allows fairly complex time specifications, extending the POSIX.2 standard. It accepts times of the form HH:MM to run a job at a specific time of day. (If that time is already past, the next day is assumed.) You may also specify midnight, noon, or teatime (4pm) and you can have a time -of-day suffixed with AM or PM for running in the morning or the evening. You can also say what day the job will be run, by giving a date in the form month -name day with an optional year, or giving a date of the form MMDD[CC] YY, MM/DD/[CC]YY, DD.MM.[CC]YY or [CC]YY -MM-DD. The specification of a date must follow the specification of the time of day. You can also give times like now + count time-units, where the time -units can be minutes, hours, days, or weeks and you can tell at to run the job today by suffixing the time with today and to run the job tomorrow by suffixing the time with tomorrow.\nThe /etc/at.allow and /etc/at.deny files determine which user can submit commands for later execution via at or batch. The format of the files is a list of usernames, one on each line. Whitespace is not permitted. If the file /etc/at.allow exists, only usernames mentioned in it are allowed to use at. If /etc/at.allow does not exist, /etc/at.deny is checked, every username not mentioned in it is then allowed to use at. An empty /etc/at.deny means that every user may use at. If neither file exists, only the s uperuser is allowed to use at.",
      "remediation": "- IF - at is installed on the system:\nRun the following script to:\n\u2022 /etc/at.allow :\no Create the file if it doesn't exist o Change owner or user root o If group daemon exists, change to group daemon , else change group to root o Change mode to 640 or more restrictive \u2022 - IF - /etc/at.deny exists:\no Change owner or user root o If group daemon exists, change to group daemon , else change group to root o Change mode to 640 or more restrictive\n#!/usr/bin/env bash grep -Pq -- '^daemon ' /etc/group && l_group=\"daemon\" || l_group=\"root\" [ ! -e \"/etc/at.allow\" ] && touch /etc/at.allow chown root:\"$l_group\" /etc/at.allow chmod u-x,g-wx,o-rwx /etc/at.allow [ -e \"/etc/at.deny\" ] && c hown root:\"$l_group\" /etc/at.deny [ -e \"/etc/at.deny\" ] && chmod u -x,g-wx,o-rwx /etc/at.deny",
      "automated": true
    }
  ]
}