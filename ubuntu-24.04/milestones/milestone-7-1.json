{
  "milestone": "7.1",
  "title": "System File Permissions",
  "description": "CIS Ubuntu Linux 24.04 LTS Benchmark - Section 7.1: System File Permissions",
  "version": "1.0.0",
  "controls": [
    {
      "id": "7.1.1",
      "title": "Ensure permissions on /etc/passwd are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/passwd",
      "expected_mode": "644",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.1",
      "description": "The /etc/passwd file contains user account information that is used by many system utilities and therefore must be readable for these utilities to operate.",
      "remediation": "Run the following commands to remove excess permissions, set owner, and set group on /etc/passwd :\n# chmod u -x,go-wx /etc/passwd\n# chown root:root /etc/passwd"
    },
    {
      "id": "7.1.2",
      "title": "Ensure permissions on /etc/passwd- are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/passwd-",
      "expected_mode": "644",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.2",
      "description": "The /etc/passwd - file contains backup user account information.",
      "remediation": "Run the following commands to remove excess permissions, set owner, and set group on /etc/passwd -:\n# chmod u -x,go-wx /etc/passwd -\n# chown root:root /etc/passwd -"
    },
    {
      "id": "7.1.3",
      "title": "Ensure permissions on /etc/group are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/group",
      "expected_mode": "644",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.3",
      "description": "The /etc/group file contains a list of all the valid groups defined in the system. The command below allows read/write access for root and read access for everyone else.",
      "remediation": "Run the following commands to remove excess permissions, set owner, and set group on /etc/group :\n# chmod u -x,go-wx /etc/group\n# chown root:root /etc/group"
    },
    {
      "id": "7.1.4",
      "title": "Ensure permissions on /etc/group- are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/group-",
      "expected_mode": "644",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.4",
      "description": "The /etc/group - file contains a backup list of all the valid groups defined in the system.",
      "remediation": "Run the following commands to remove excess permissions, set owner, and set group on /etc/group -:\n# chmod u -x,go-wx /etc/group -\n# chown root:root /etc/group -"
    },
    {
      "id": "7.1.5",
      "title": "Ensure permissions on /etc/shadow are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/shadow",
      "expected_mode": "640",
      "expected_owner": "root",
      "expected_group": "shadow",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.5",
      "description": "The /etc/shadow file is used to store the information about user accounts that is critical to the security of those accounts, such as the hashed password and other security information.",
      "remediation": "Run one of the following commands to set ownership of /etc/shadow to root and group to either root or shadow :\n# chown root:shadow /etc/shadow -OR-\n# chown root:root /etc/shadow\nRun the following command to remove excess permissions form /etc/shadow :\n# chmod u -x,g-wx,o-rwx /etc/shadow"
    },
    {
      "id": "7.1.6",
      "title": "Ensure permissions on /etc/shadow- are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/shadow-",
      "expected_mode": "640",
      "expected_owner": "root",
      "expected_group": "shadow",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.6",
      "description": "The /etc/shadow - file is used to store backup information about user accounts that is critical to the security of those accounts, such as the hashed password and other security information.",
      "remediation": "Run one of the following commands to set ownership of /etc/shadow - to root and group to either root or shadow :\n# chown root:shadow /etc/shadow - -OR-\n# chown root:root /etc/shadow -\nRun the following command to remove excess permissions form /etc/shadow -:\n# chmod u -x,g-wx,o-rwx /etc/shadow -"
    },
    {
      "id": "7.1.7",
      "title": "Ensure permissions on /etc/gshadow are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/gshadow",
      "expected_mode": "640",
      "expected_owner": "root",
      "expected_group": "shadow",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.7",
      "description": "The /etc/gshadow file is used to store the information about groups that is critical to the security of those accounts, such as the hashed password and other security information.",
      "remediation": "Run one of the following commands to set ownership of /etc/gshadow to root and group to either root or shadow :\n# chown root:shadow /etc/gshadow -OR-\n# chown root:root /etc/gshadow\nRun the following command to remove excess permissions form /etc/gshadow :\n# chmod u -x,g-wx,o-rwx /etc/gshadow"
    },
    {
      "id": "7.1.8",
      "title": "Ensure permissions on /etc/gshadow- are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/gshadow-",
      "expected_mode": "640",
      "expected_owner": "root",
      "expected_group": "shadow",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.8",
      "description": "The /etc/gshadow - file is used to store backup information about groups that is critical to the security of those accounts, such as the hashed password and other security information.",
      "remediation": "Run one of the following commands to set ownership of /etc/gshadow - to root and group to either root or shadow :\n# chown root:shadow /etc/gshadow - -OR-\n# chown root:root /etc/gshadow -\nRun the following command to remove excess permissions form /etc/gshadow -:\n# chmod u -x,g-wx,o-rwx /etc/gshadow -"
    },
    {
      "id": "7.1.9",
      "title": "Ensure permissions on /etc/shells are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/shells",
      "expected_mode": "644",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.9",
      "description": "/etc/shells is a text file which contains the full pathnames of valid login shells. This file is consulted by chsh and available to be queried by other programs.",
      "remediation": "Run the following commands to remove excess permissions, set owner, and set group on /etc/shells :\n# chmod u -x,go-wx /etc/shells\n# chown root:root /etc/shells"
    },
    {
      "id": "7.1.10",
      "title": "Ensure permissions on /etc/security/opasswd are configured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/security/opasswd",
      "expected_mode": "600",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.10",
      "description": "/etc/security/opasswd and it's backup /etc/security/opasswd.old hold user's previous passwords if pam_unix or pam_pwhistory is in use on the system",
      "remediation": "Run the following commands to remove excess permissions, set owner, and set group on /etc/security/opasswd and /etc/security/opasswd.old is they exist:\n# [ -e \"/etc/security/opasswd\" ] && chmod u -x,go-rwx /etc/security/opasswd\n# [ -e \"/etc/security/opasswd\" ] && chown root:root /etc/security/opasswd\n# [ -e \"/etc/security/opasswd.old\" ] && chmod u -x,go-rwx /etc/security/opasswd.old\n# [ -e \"/etc/security/op asswd.old\" ] && chown root:root /etc/security/opasswd.old"
    },
    {
      "id": "7.1.11",
      "title": "Ensure world writable files and directories are secured",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "WorldWritableFiles",
      "search_paths": [
        "/",
        "/home",
        "/tmp",
        "/var"
      ],
      "exclude_paths": [
        "/proc",
        "/sys",
        "/dev"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.11",
      "description": "World writable files are the least secure. Data in world -writable files can be modified and compromised by any user on the system. World writable files may also indicate an incorrectly written script or program that could potentially be the cause of a larg er compromise to the system's integrity. See the chmod(2) man page for more information.\nSetting the sticky bit on world writable directories prevents users from deleting or renaming files in that directory that are not owned by them.",
      "remediation": "• World Writable Files:\no It is recommended that write access is removed from other with the command ( chmod o-w <filename> ), but always consult relevant vendor documentation to avoid breaking any application dependencies on a given file.\n• World Writable Directories:\no Set the sticky bit on all world writable directories with the command ( chmod a+t <directory_name> )\nRun the following script to:\n• Remove other write permission from any world writable files • Add the sticky bit to all world writable directories\n#!/usr/bin/env bash l_smask='01000' a_file=(); a_dir=() # Initialize arrays a_path=(! -path \"/run/user/*\" -a ! -path \"/proc/*\" -a ! -path \"*/containerd/*\" -a ! -path \"*/kubelet/pods/*\" -a ! -path \"*/kubelet/plugins/*\" -a ! -path \"/sys/*\" -a ! -path \"/snap/*\") while IFS= read -r l_mount; do while IFS= read -r -d $'\\0' l_file; do if [ -e \"$l_file\" ]; then l_mode=\"$(stat -Lc '%#a' \"$l_file\")\" if [ -f \"$l_file\" ]; then # Remove excess permissions from WW files echo -e \" - File: \\\"$l_file \\\" is mode: \\\"$l_mode \\\" - removing write permission on \\\"$l_file \\\" from \\\"other\\\"\" chmod o-w \"$l_file\" fi if [ -d \"$l_file\" ]; then # Add sticky bit if [ ! $(( $l_mode & $l_smask )) -gt 0 ]; then echo -e \" - Directory: \\\"$l_file \\\" is mode: \\\"$l_mode \\\" and doesn't have the sticky bit set - Adding the sticky bit\" chmod a+t \"$l_file\" fi fi fi done < <(find \"$l_mount\" -xdev \\( \"$a_path[@]\" \\) \\( -type f -o -type d \\) -perm -0002 -print0 2> /dev/null) done < <(findmnt -Dkerno fstype,target | awk '($1 !~ /^*(nfs|proc|smb|vfat|iso9660|efivarfs|selinuxfs)/ && $2 !~ /^(\\/run\\/user\\/|\\/tmp|\\/var\\/tmp)/)print $2')"
    },
    {
      "id": "7.1.12",
      "title": "Ensure no files or directories without an owner and a group exist",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "OrphanedFiles",
      "search_paths": [
        "/",
        "/home",
        "/var"
      ],
      "exclude_paths": [
        "/proc",
        "/sys",
        "/dev"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.12",
      "description": "Administrators may delete users or groups from the system and neglect to remove all files and/or directories owned by those users or groups.",
      "remediation": "Remove or set ownership and group ownership of these files and/or directories to an active user on the system as appropriate."
    },
    {
      "id": "7.1.13",
      "title": "Ensure SUID and SGID files are reviewed",
      "section": "7.1 System File Permissions",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "expected": "SUID and SGID files reviewed and verified as legitimate",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "7.1.13",
      "description": "The owner of a file can set the file's permissions to run with the owner's or group's permissions, even if the user running the program is not the owner or a member of the group. The most common reason for a SUID or SGID program is to enable users to perfo rm functions (such as changing their password) that require root privileges.",
      "remediation": "Ensure that no rogue SUID or SGID programs have been introduced into the system.\nReview the files returned by the action in the Audit section and confirm the integrity of these binaries.",
      "audit_command": "df --local -P | awk '{if (NR!=1) print $6}' | xargs -I '{}' find '{}' -xdev -type f \\( -perm -4000 -o -perm -2000 \\) 2>/dev/null"
    }
  ]
}