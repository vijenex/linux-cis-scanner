{
  "milestone": "4.4",
  "title": "Configure iptables",
  "description": "Configure iptables firewall for host-based protection",
  "controls": [
    {
      "id": "4.4.1.1",
      "title": "Ensure iptables packages are installed",
      "profile": "Level1",
      "type": "Package",
      "package": "iptables",
      "expected_state": "installed",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.1.1",
      "description": "iptables is a utility program that allows a system administrator to configure the tables provided by the Linux kernel firewall, implemented as different Netfilter modules, and the chains and rules it stores. Different kernel modules and programs are used for different protocols; iptables applies to IPv4, ip6tables to IPv6, arptables to ARP, and ebtables to Ethernet frames.",
      "remediation": "Run the following command to install iptables and iptables -persistent\n# apt install iptables iptables -persistent"
    },
    {
      "id": "4.4.1.2",
      "title": "Ensure nftables is not in use with iptables",
      "profile": "Level1",
      "type": "Package",
      "package": "nftables",
      "expected_state": "not_installed",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.1.2",
      "description": "nftables is a subsystem of the Linux kernel providing filtering and classification of network packets/datagrams/frames and is the successor to iptables.",
      "remediation": "Run the following command to remove nftables :\n# apt purge nftables - OR -\nRun the following commands to stop and mask nftables.service :\n# systemctl stop nftables.service\n# systemctl mask nftables.service"
    },
    {
      "id": "4.4.1.3",
      "title": "Ensure ufw is not in use with iptables",
      "profile": "Level1",
      "type": "Service",
      "service": "ufw",
      "expected_state": "disabled",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.1.3",
      "description": "Uncomplicated Firewall (UFW) is a program for managing a netfilter firewall designed to be easy to use.\n• Uses a command -line interface consisting of a small number of simple commands • Uses iptables for configuration",
      "remediation": "Run the following command to remove ufw:\n# apt purge ufw - OR -\nRun the following commands to disable ufw, and stop and mask ufw.service :\n# ufw disable\n# systemctl stop ufw.service\n# systemctl mask ufw.service Note: ufw disable needs to be run before systemctl mask ufw.service in order to correctly disable UFW"
    },
    {
      "id": "4.4.2.1",
      "title": "Ensure iptables default deny firewall policy",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.2.1",
      "description": "A default deny all policy on connections ensures that any unconfigured network usage will be rejected.\nNotes:\n• Changing firewall settings while connected over network can result in being locked out of the system • Remediation will only affect the active system firewall, be sure to configure the default policy in your firewall management to apply on boot as well",
      "remediation": "Run the following commands to implement a default DROP policy:\n# iptables -P INPUT DROP\n# iptables -P OUTPUT DROP\n# iptables -P FORWARD DROP"
    },
    {
      "id": "4.4.2.2",
      "title": "Ensure iptables loopback traffic is configured",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.2.2",
      "description": "Configure the loopback interface to accept traffic. Configure all other interfaces to deny traffic to the loopback network (127.0.0.0/8).\nNote:\n• Changing firewall settings while connected over network can result in being locked out of the system • Remediation will only affect the active system firewall, be sure to configure the default policy in your firewall management to apply on boot as well",
      "remediation": "Run the following commands to implement the loopback rules:\n# iptables -A INPUT -i lo -j ACCEPT\n# iptables -A OUTPUT -o lo -j ACCEPT\n# iptables -A INPUT -s 127.0.0.0/8 -j DROP"
    },
    {
      "id": "4.4.2.3",
      "title": "Ensure iptables outbound and established connections are configured",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.2.3",
      "description": "Configure the firewall rules for new outbound, and established connections.\nNote:\n• Changing firewall settings while connected over network can result in being locked out of the system • Remediation will only affect the active system firewall, be sure to configure the default policy in your firewall management to apply on boot as well",
      "remediation": "Configure iptables in accordance with site policy. The following commands will implement a policy to allow all outbound connections and all established connections:\n# iptables -A OUTPUT -p tcp -m state --state NEW,ESTABLISHED -j ACCEPT\n# iptables -A OUTPUT -p udp -m state --state NEW,ESTABLISHED -j ACCEPT\n# iptables -A INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT\n# iptables -A INPUT -p udp -m state --state ESTA BLISHED -j ACCEPT"
    },
    {
      "id": "4.4.2.4",
      "title": "Ensure iptables firewall rules exist for all open ports",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.2.4",
      "description": "Any ports that have been opened on non -loopback addresses need firewall rules to govern traffic.\nNotes:\n• Changing firewall settings while connected over network can result in being locked out of the system • Remediation will only affect the active system firewall, be sure to configure the default policy in your firewall management to apply on boot as well • The remediation command opens up the port to traffic from all sources. Consult iptables documentation and set any restrictions in compliance with site policy",
      "remediation": "For each port identified in the audit which does not have a firewall rule establish a proper rule for accepting inbound connections:\n# iptables -A INPUT -p <protocol> --dport <port> -m state --state NEW -j ACCEPT"
    },
    {
      "id": "4.4.3.1",
      "title": "Ensure ip6tables default deny firewall policy",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.3.1",
      "description": "A default deny all policy on connections ensures that any unconfigured network usage will be rejected.\nNote:\n• Changing firewall settings while connected over network can result in being locked out of the system • Remediation will only affect the active system firewall, be sure to configure the default policy in your firewall management to apply on boot as well",
      "remediation": "- IF - IPv6 is enabled on your system:\nRun the following commands to implement a default DROP policy:\n# ip6tables -P INPUT DROP\n# ip6tables -P OUTPUT DROP\n# ip6tables -P FORWARD DROP"
    },
    {
      "id": "4.4.3.2",
      "title": "Ensure ip6tables loopback traffic is configured",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.3.2",
      "description": "Configure the loopback interface to accept traffic. Configure all other interfaces to deny traffic to the loopback network (::1).\nNote:\n• Changing firewall settings while connected over network can result in being locked out of the system • Remediation will only affect the active system firewall, be sure to configure the default policy in your firewall management to apply on boot as well",
      "remediation": "Run the following commands to implement the loopback rules:\n# ip6tables -A INPUT -i lo -j ACCEPT\n# ip6tables -A OUTPUT -o lo -j ACCEPT\n# ip6tables -A INPUT -s ::1 -j DROP"
    },
    {
      "id": "4.4.3.3",
      "title": "Ensure ip6tables outbound and established connections are configured",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.3.3",
      "description": "Configure the firewall rules for new outbound, and established IPv6 connections.\nNote:\n• Changing firewall settings while connected over network can result in being locked out of the system • Remediation will only affect the active system firewall, be sure to configure the default policy in your firewall management to apply on boot as well",
      "remediation": "Configure iptables in accordance with site policy. The following commands will implement a policy to allow all outbound connections and all established connections:\n# ip6tables -A OUTPUT -p tcp -m state --state NEW,ESTABLISHED -j ACCEPT\n# ip6tables -A OUTPUT -p udp -m state --state NEW,ESTABLISHED -j ACCEPT\n# ip6tables -A INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT\n# ip6tables -A INPUT -p udp -m state --state ESTABLISHED -j ACCEPT"
    },
    {
      "id": "4.4.3.4",
      "title": "Ensure ip6tables firewall rules exist for all open ports",
      "profile": "Level1",
      "type": "Manual",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "4.4.3.4",
      "description": "Any ports that have been opened on non -loopback addresses need firewall rules to govern traffic.\nNotes:\n• Changing firewall settings while connected over network can result in being locked out of the system • Remediation will only affect the active system firewall, be sure to configure the default policy in your firewall management to apply on boot as well • The remediation command opens up the port to traffic from all sources. Consult iptables documentation and set any restrictions in compliance with site policy",
      "remediation": "For each port identified in the audit which does not have a firewall rule establish a proper rule for accepting inbound connections:\n# ip6tables -A INPUT -p <protocol> --dport <port> -m state --state NEW -j ACCEPT"
    }
  ]
}