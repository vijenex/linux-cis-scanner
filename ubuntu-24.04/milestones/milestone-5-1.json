{
  "milestone": "5.1",
  "title": "Configure SSH Server",
  "description": "CIS Ubuntu Linux 24.04 LTS Benchmark - Section 5.1: Configure SSH Server",
  "version": "1.0.0",
  "controls": [
    {
      "id": "5.1.1",
      "title": "Ensure permissions on /etc/ssh/sshd_config are configured",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermission",
      "file_path": "/etc/ssh/sshd_config",
      "expected_mode": "600",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.1",
      "description": "The file /etc/ssh/sshd_config , and files ending in .conf in the /etc/ssh/sshd_config.d directory, contain configuration specifications for sshd .",
      "remediation": "Run the following script to set ownership and permissions on /etc/ssh/sshd_config and files ending in .conf in the /etc/ssh/sshd_config.d directory:\n#!/usr/bin/env bash chmod u-x,og-rwx /etc/ssh/sshd_config chown root:root /etc/ssh/sshd_config while IFS= read -r -d $'\\0' l_file; do if [ -e \"$l_file\" ]; then chmod u-x,og-rwx \"$l_file\" chown root:root \"$l_file\" fi done < <(find /etc/ssh/sshd_config.d -type f -print0 2>/dev/null) - IF - other locations are listed in an Include statement, *.conf files in these locations access should also be modified."
    },
    {
      "id": "5.1.2",
      "title": "Ensure permissions on SSH private host key files are configured",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHPrivateKeys",
      "key_pattern": "/etc/ssh/ssh_host_*_key",
      "expected_mode": "600",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.2",
      "description": "An SSH private key is one of two files used in SSH public key authentication. In this authentication method, the possession of the private key is proof of identity. Only a private key that corresponds to a public key will be able to authenticate successful ly.\nThe private keys need to be stored and handled carefully, and no copies of the private key should be distributed.",
      "remediation": "Run the following script to set mode, ownership, and group on the private SSH host key files:\n#!/usr/bin/env bash a_output=(); a_output2=(); l_ssh_group_name=\" $(awk -F: '($1 ~ /^(ssh_keys|_?ssh)$/) print $1' /etc/group)\" f_file_access_fix() while IFS=: read -r l_file_mode l_file_owner l_file_group; do a_out2=() [ \"$l_file_group\" = \"$l_ssh_group_name\" ] && l_pmask=\"0137\" || l_pma sk=\"0177\" l_maxperm=\"$( printf '%o' $(( 0777 & ~$l_pmask )) )\" if [ $(( $l_file_mode & $l_pmask )) -gt 0 ]; then a_out2+=(\" Mode: \\\"$l_file_mode \\\" should be mode: \\\"$l_maxperm \\\" or more restrictive\" \\ \" updat ing to mode: \\:$l_maxperm \\\"\") if [ \"l_file_group\" = \"$l_ssh_group_name\" ]; then chmod u-x,g-wx,o-rwx \"$l_file\" else chmod u-x,go-rwx \"$l_file\" fi fi if [ \"$l_file_owner\" != \"root\" ]; then a_out2+=(\" Owned by: \\\"$l_file_owner \\\" should be owned by \\\"root\\\"\" \\ \" Changing ownership to \\\"root\\\"\") chown root \"$l_file\" fi if [[ ! \"$l_file_group\" =~ ($l_ssh_group_name|root) ]]; then [ -n \"$l_ssh_group_name\" ] && l_new_group=\"$l_ssh_group_name\" || l_new_group=\"root\" a_out2+=(\" Owned by group \\\"$l_file_group \\\" should be group owned by:\n\\\"$l_ssh_group_name \\\" or \\\"root\\\"\" \\ \" Changing gr oup ownership to \\\"$l_new_group \\\"\") chgrp \"$l_new_group\" \"$l_file\" fi if [ \"$#a_out2[@]\" -gt \"0\" ]; then a_output2+=(\" - File: \\\"$l_file \\\"\" \"$a_out2[@]\") else a_output+=(\" - File: \\\"$l_file\\\"\" \\ \"Correct: mode: \\\"$l_file_mode \\\", owner: \\\"$l_file_owner \\\", and group owner: \\\"$l_file_group \\\" configured\") fi done < <(stat -Lc '%#a:%U:%G' \"$l_file\") while IFS= read -r -d $'\\0' l_file; do if ssh-keygen -lf &>/dev/null \"$l_file\"; then file \"$l_file\" | grep -Piq -- '+([^#]++)?private +key' && f_file_access_fix fi done < <(find -L /etc/ssh -xdev -type f -print0 2>/dev/null) if [ \"$#a_output2[@]\" -le \"0\" ]; then printf '%s ' \"\" \" - No access changes required\" \"\" else printf '%s ' \"\" \" - Remediation results:\" \"$a_output2[@]\" \"\" fi"
    },
    {
      "id": "5.1.3",
      "title": "Ensure permissions on SSH public host key files are configured",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHPublicKeys",
      "key_pattern": "/etc/ssh/ssh_host_*_key.pub",
      "expected_mode": "644",
      "expected_owner": "root",
      "expected_group": "root",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.3",
      "description": "An SSH public key is one of two files used in SSH public key authentication. In this authentication method, a public key is a key that can be used for verifying digital signatures generated using a corresponding private key. Only a public key that correspo nds to a private key will be able to authenticate successfully.",
      "remediation": "Run the following script to set mode, ownership, and group on the public SSH host key files:\n#!/usr/bin/env bash a_output=(); a_output2=() l_pmask=\"0133\"; l_maxperm=\"$( printf '%o' $(( 0777 & ~$l_pmask )) )\" f_file_access_fix() while IFS=: read -r l_file_mode l_file_owner l_file_group; do a_out2=() [ $(( $l _file_mode & $l_pmask )) -gt 0 ] && \\ a_out2+=(\" Mode: \\\"$l_file_mode \\\" should be mode:\n\\\"$l_maxperm \\\" or more restrictive\" \\ \" updating to mode: \\\"$l_maxperm \\\"\") && chmod u -x,go-wx \"$l_file\" [ \"$l_file_owner\" != \"roo t\" ] && \\ a_out2+=(\" Owned by: \\\"$l_file_owner \\\" should be owned by \\\"root\\\"\" \\ \" Changing ownership to \\\"root\\\"\") && chown root \"$l_file\" [ \"$l_file_group\" != \"root\" ] && \\ a_out2+=(\" Owned by group \\\"$l_file_group \\\" should be group owned by: \\\"root\\\"\" \\ \" Changing group ownership to \\\"root\\\"\") && chgrp root \"$l_file\" if [ \"$#a_out2[@]\" -gt \"0\" ]; then a_output2+=(\" - File: \\\"$l_file \\\"\" \"$a_out2[@]\") else a_output+=(\" - File: \\\"$l_file \\\"\" \\ \" Correct: mode: \\\"$l_file_mode \\\", owner: \\\"$l_file_owner \\\", and group owner: \\\"$l_file_group \\\" configured\") fi done < <(stat -Lc '%#a:%U:%G' \"$l_file\") while IFS= rea d -r -d $'\\0' l_file; do if ssh-keygen -lf &>/dev/null \"$l_file\"; then file \"$l_file\" | grep -Piq -- '+([^#]++)?public +key' && f_file_access_fix fi done < <(find -L /etc/ssh -xdev -type f -print0 2>/dev/null) if [ \"$#a_output2[@]\" -le \"0\" ]; then printf '%s ' \"\" \" - No access changes required\" \"\" else printf '%s ' \" - Remediation results:\" \"$a_output2[@]\" \"\" fi"
    },
    {
      "id": "5.1.4",
      "title": "Ensure sshd access is configured",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHDConfig",
      "config_file": "/etc/ssh/sshd_config",
      "check_parameters": [
        "AllowUsers",
        "AllowGroups",
        "DenyUsers",
        "DenyGroups"
      ],
      "require_one_of": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.4",
      "description": "There are several options available to limit which users and group can access the system via SSH. It is recommended that at least one of the following options be leveraged:\n• AllowUsers :\no The AllowUsers variable gives the system administrator the option of allowing specific users to ssh into the system. The list consists of space separated user names. Numeric user IDs are not recognized with this variable. If a system administrator wants to restrict user access further by only allowing the allowed users to log in from a particular host, the entry can be specified in the form of user@host.\n• AllowGroups :\no The AllowGroups variable gives the system administrator the option of allowing specific groups of users to ssh into the system. The list consists of space separated group names. Numeric group IDs are not recognized with this variable.\n• DenyUsers :\no The DenyUsers variable gives the system administrator the option of denying specific users to ssh into the system. The list consists of space separated user names. Numeric user IDs are not recognized with this variable. If a system administrator wants to restrict user access further by specifically denying a user's access from a particular host, the e ntry can be specified in the form of user@host.\n• DenyGroups :\no The DenyGroups variable gives the system administrator the option of denying specific groups of users to ssh into the system. The list consists of space separated group names. Numeric group IDs are not recognized with this variable.",
      "remediation": "Edit the /etc/ssh/sshd_config file to set one or more of the parameters above any Include and Match set statements as follows:\nAllowUsers <userlist> - AND/OR - AllowGroups <grouplist> Note:\n• First occurrence of a option takes precedence, Match set statements withstanding. If Include locations are enabled, used, and order of precedence is understood in your environment, the entry may be created in a .conf file in an Include directory.\n• Be advised that these options are \"ANDed\" together. If both AllowUsers and AllowGroups are set, connections will be limited to the list of users that are also a member of an allowed group. It is recommended that only one be set for clarity and ease of administration.\n• It is easier to manage an allow list than a deny list. In a deny list, you could potentially add a user or group and forget to add it to the deny list."
    },
    {
      "id": "5.1.5",
      "title": "Ensure sshd Banner is configured",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHDConfig",
      "config_file": "/etc/ssh/sshd_config",
      "check_parameters": [
        "Banner"
      ],
      "expected_values": {
        "Banner": "/etc/issue.net"
      },
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.5",
      "description": "The Banner parameter specifies a file whose contents must be sent to the remote user before authentication is permitted. By default, no banner is displayed.",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the Banner parameter above any Include and Match entries as follows:\nBanner /etc/issue.net Note: First occurrence of a option takes precedence, Match set statements withstanding. If Include locations are enabled, used, and order of precedence is understood in your environment, the entry may be created in a file in Include location.\nEdit the file bein g called by the Banner argument with the appropriate contents according to your site policy, remove any instances of , , , or references to the OS platform Example:\n# printf '%s ' \"Authorized users only. All activity may be monitored and reported.\" > \"$(sshd -T | awk '$1 == \"banner\" print $2')\""
    },
    {
      "id": "5.1.6",
      "title": "Ensure sshd Ciphers are configured",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHDConfig",
      "config_file": "/etc/ssh/sshd_config",
      "check_parameters": [
        "Ciphers"
      ],
      "validate_crypto": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.6",
      "description": "This variable limits the ciphers that SSH can use during communication.\nNotes:\n• Some organizations may have stricter requirements for approved ciphers.\n• Ensure that ciphers used are in compliance with site policy.\n• The only \"strong\" ciphers currently FIPS 140 compliant are:\no aes256 -gcm@openssh.com o aes128 -gcm@openssh.com o aes256 -ctr o aes192 -ctr o aes128 -ctr",
      "remediation": "Edit the /etc/ssh/sshd_config file and add/modify the Ciphers line to contain a comma separated list of the site unapproved (weak) Ciphers preceded with a - above any Include entries:\nExample:\nCiphers -3des-cbc,aes128 -cbc,aes192 -cbc,aes256 -cbc,chacha20 - poly1305@openssh.com - IF - CVE-2023-48795 has been addressed, and it meets local site policy, chacha20 - poly1305@openssh.com may be removed from the list of excluded ciphers.\nNote: First occurrence of an option takes precedence. If Include locations are enabled, used, and order of precedence is understood in your environment, the entry may be\ncreated in a file in Include location."
    },
    {
      "id": "5.1.7",
      "title": "Ensure sshd ClientAliveInterval and ClientAliveCountMax are configured",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHDConfig",
      "config_file": "/etc/ssh/sshd_config",
      "check_parameters": [
        "ClientAliveInterval",
        "ClientAliveCountMax"
      ],
      "expected_values": {
        "ClientAliveInterval": "15",
        "ClientAliveCountMax": "3"
      },
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.7",
      "description": "Note: To clarify, the two settings described below are only meant for idle connections from a protocol perspective and are not meant to check if the user is active or not. An idle user does not mean an idle connection. SSH does not and never had, intentionally, the capability to drop idle users. In SSH versions before 8.2p1 there was a bug that caused these values to behave in such a manner that they were abused to disconnect idle users. This bug has been resolved in 8.2p1 and thus it can no longer be abused disconnect idle users.\nThe two options ClientAliveInterval and ClientAliveCountMax control the timeout of SSH sessions. Taken directly from man 5 sshd_config :\n• ClientAliveInterval Sets a timeout interval in seconds after which if no data has been received from the client, sshd(8) will send a message through the encrypted channel to request a response from the client. The default is 0, indicating that these messages will not be sent to the client.\n• ClientAliveCountMax Sets the number of client alive messages which may be sent without sshd(8) receiving any messages back from the client. If this threshold is reached while client alive messages are being sent, sshd will disconnect the client, terminating the session. It i s important to note that the use of client alive messages is very different from TCPKeepAlive. The client alive messages are sent through the encrypted channel and therefore will not be spoofable. The TCP keepalive option en ‐abled by TCPKeepAlive is spoofable.\nThe client alive mechanism is valuable when the client or server depend on knowing when a connection has become unresponsive. The default value is 3. If ClientAliveInterval is set to 15, and ClientAliveCountMax is left a t the default, unresponsive SSH clients will be disconnected after approximately 45 seconds.\nSetting a zero ClientAliveCountMax disables connection termination.\n",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the ClientAliveInterval and ClientAliveCountMax parameters above any Include and Match entries according to site policy.\nExample:\nClientAliveInterval 15 ClientAliveCountMax 3 Note: First occurrence of a option takes precedence, Match set statements withstanding. If Include locations are enabled, used, and order of precedence is understood in your environment, the entry may be created in a file in Include location."
    },
    {
      "id": "5.1.8",
      "title": "Ensure sshd DisableForwarding is enabled",
      "section": "5.1 Configure SSH Server",
      "profile": "Level2",
      "automated": true,
      "type": "SSHDConfig",
      "config_file": "/etc/ssh/sshd_config",
      "check_parameters": [
        "DisableForwarding"
      ],
      "expected_values": {
        "DisableForwarding": "yes"
      },
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.8",
      "description": "The DisableForwarding parameter disables all forwarding features, including X11, ssh-agent(1), TCP and StreamLocal. This option overrides all other forwarding -related options and may simplify restricted configurations.\n• X11Forwarding provides the ability to tunnel X11 traffic through the connection to enable remote graphic connections.\n• ssh-agent is a program to hold private keys used for public key authentication.\nThrough use of environment variables the agent can be located and automatically used for authentication when logging in to other machines using ssh.\n• SSH port forwarding is a mechanism in SSH for tunneling application ports from the client to the server, or servers to clients. It can be used for adding encryption to legacy applications, going through firewalls, and some system administrators and IT prof essionals use it for opening backdoors into the internal network from their home machines.",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the DisableForwarding parameter to yes above any Include entry as follows:\nDisableForwarding yes Note: First occurrence of a option takes precedence. If Include locations are enabled, used, and order of precedence is understood in your environment, the entry may be\ncreated in a file in Include location."
    },
    {
      "id": "5.1.20",
      "title": "Ensure sshd PermitRootLogin is disabled",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHDConfig",
      "config_file": "/etc/ssh/sshd_config",
      "check_parameters": [
        "PermitRootLogin"
      ],
      "expected_values": {
        "PermitRootLogin": "no"
      },
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.20",
      "description": "The PermitRootLogin parameter specifies if the root user can log in using SSH. The default is prohibit -password .",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the PermitRootLogin parameter to no above any Include and Match entries as follows:\nPermitRootLogin no Note: First occurrence of an option takes precedence, Match set statements withstanding. If Include locations are enabled, used, and order of precedence is understood in your environment, the entry may be created in a file in Include location."
    },
    {
      "id": "5.1.19",
      "title": "Ensure sshd PermitEmptyPasswords is disabled",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHDConfig",
      "config_file": "/etc/ssh/sshd_config",
      "check_parameters": [
        "PermitEmptyPasswords"
      ],
      "expected_values": {
        "PermitEmptyPasswords": "no"
      },
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.19",
      "description": "The PermitEmptyPasswords parameter specifies if the SSH server allows login to accounts with empty password strings.",
      "remediation": "Edit /etc/ssh/sshd_config and set the PermitEmptyPasswords parameter to no above any Include and Match entries as follows:\nPermitEmptyPasswords no Note: First occurrence of an option takes precedence, Match set statements withstanding. If Include locations are enabled, used, and order of precedence is understood in your environment, the entry may be created in a file in Include location."
    },
    {
      "id": "5.1.22",
      "title": "Ensure sshd UsePAM is enabled",
      "section": "5.1 Configure SSH Server",
      "profile": "Level1",
      "automated": true,
      "type": "SSHDConfig",
      "config_file": "/etc/ssh/sshd_config",
      "check_parameters": [
        "UsePAM"
      ],
      "expected_values": {
        "UsePAM": "yes"
      },
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "5.1.22",
      "description": "The UsePAM directive enables the Pluggable Authentication Module (PAM) interface. If set to yes this will enable PAM authentication using ChallengeResponseAuthentication and PasswordAuthentication directives in addition to PAM account and session module processing for all authentication types.",
      "remediation": "Edit the /etc/ssh/sshd_config file to set the UsePAM parameter to yes above any Include entries as follows:\nUsePAM yes Note: First occurrence of an option takes precedence. If Include locations are enabled, used, and order of precedence is understood in your environment, the entry may be\ncreated in a file in Include location."
    }
  ]
}