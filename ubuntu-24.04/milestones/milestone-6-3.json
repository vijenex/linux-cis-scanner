{
  "milestone": "6.3",
  "title": "Configure Integrity Checking",
  "description": "CIS Ubuntu Linux 24.04 LTS Benchmark - Section 6.3: Configure Integrity Checking",
  "version": "1.0.0",
  "controls": [
    {
      "id": "6.3.1",
      "title": "Ensure AIDE is installed",
      "section": "6.3 Configure Integrity Checking",
      "profile": "Level1",
      "automated": true,
      "type": "MultiPackage",
      "package_names": [
        "aide",
        "aide-common"
      ],
      "should_be_installed": true,
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.3.1",
      "description": "AIDE takes a snapshot of filesystem state including modification times, permissions, and file hashes which can then be used to compare against the current state of the filesystem to detect modifications to the system.",
      "remediation": "Install AIDE using the appropriate package manager or manual installation:\n# apt install aide aide -common\nConfigure AIDE as appropriate for your environment. Consult the AIDE documentation for options.\nRun the following commands to initialize AIDE:\n# aideinit\n# mv /var/lib/aide/aide.db.new /var/lib/aide/aide.db"
    },
    {
      "id": "6.3.2",
      "title": "Ensure filesystem integrity is regularly checked",
      "section": "6.3 Configure Integrity Checking",
      "profile": "Level1",
      "automated": true,
      "type": "CronJob",
      "cron_user": "root",
      "expected_job": "/usr/bin/aide",
      "job_description": "AIDE filesystem integrity check",
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.3.2",
      "description": "Periodic checking of the filesystem integrity is needed to detect changes to the filesystem.",
      "remediation": "Run the following command to unmask dailyaidecheck.timer and dailyaidecheck.service :\n# systemctl unmask dailyaidecheck.timer dailyaidecheck.service\nRun the following command to enable and start dailyaidecheck.timer :\n# systemctl --now enable dailyaidecheck.timer"
    },
    {
      "id": "6.3.3",
      "title": "Ensure cryptographic mechanisms are used to protect the integrity of audit tools",
      "section": "6.3 Configure Integrity Checking",
      "profile": "Level1",
      "automated": true,
      "type": "AIDEConfig",
      "config_file": "/etc/aide/aide.conf",
      "monitored_tools": [
        "/sbin/auditctl",
        "/sbin/auditd",
        "/sbin/ausearch",
        "/sbin/aureport",
        "/sbin/autrace",
        "/sbin/audispd",
        "/sbin/augenrules"
      ],
      "cis_reference": "https://www.cisecurity.org/benchmark/ubuntu_linux",
      "cis_control_id": "6.3.3",
      "description": "Audit tools include, but are not limited to, vendor -provided and open source audit tools needed to successfully view and manipulate audit information system activity and records. Audit tools include custom queries and report generators.\naide.conf is case -sensitive. Leading and trailing white spaces are ignored. Each config lines must end with new line.\nAIDE uses the backslash character \\ as escape character for ' ' (space), '@' and '' (backslash) (e.g. ' \\ ' or '@'). To literally match a '' in a file path with a regular expression you have to escape the backslash twice (i.e. ' \\\\').\nThere are three types of lines in aide.conf :\n• The configuration options which are used to set configuration parameters and define groups.\n• (restricted) rules that are used to indicate which files are added to the database.\n• Macro lines define or undefine variables within the config file.\nNote: Lines beginning with # are ignored as comments.\n@@include <FILE> - Include <FILE> .\n• The content of the file is used as if it were inserted in this part of the config file.\n• The maximum depth of nested includes is 16.\n`@@include <DIRECTORY> <REGEX> - [RULE_PREFIX] (added in AIDE v0.17) • Include all (regular) files found in <DIRECTORY> matching regular expression <REGEX> (sub -directories are ignored).\n• The file are included in lexical sort order.\n• If RULE_PREFIX is set, all rules included by the statement are prefixed with given <RULE_PREFIX> (added in AIDE v0.18). Prefixes from nested include statements are concatenated.\n• The content of the files is used as if it were inserted in this part of the config file.\n@x_include :\n• is identical to @@include , except that if a config file is executable is is run and the output is used as config.\n• If the executable file exits with status greater than zero or writes to stderr aide stops with an error.\n• For security reasons <DIRECTORY> and each executable config file must be owned by the current user or root. They must not be group - or world -writable.\n• @@x_include _<FILE>_ (added in AIDE v0.17):\n • `@@x_include <DIRECTORY> <REGEX> [RULE_PREFIX] (added in AIDE v0.17) @@x_include_setenv <VAR> <VALUE> (added in AIDE v0.17) • Adds the variable <VAR> with the value <VALUE> to the environment used for config file execution.\n• Environment variable names are limited to alphanumeric characters (A -Za-z0-9) and the underscore '_' and must not begin with a digit.",
      "remediation": "Run the following command to determine the absolute path to the non -symlinked version on the audit tools:\n# readlink -f /sbin The output will be either /usr/sbin - OR - /sbin . Ensure the correct path is used.\nEdit /etc/aide/aide.conf and add or update the following selection lines replacing <PATH> with the correct path returned in the command above:\n# Audit Tools <PATH>/auditctl p+i+n+u+g+s+b+acl+xattrs+sha512 <PATH>/auditd p+i+n+u+g+s+b+acl+xattrs+sha512 <PATH>/ausearch p+i+n+u+g+s+b+acl+xattrs+sha512 <PATH>/aureport p+i+n+u+g+s+b+acl+xattrs+sha512 <PATH>/autrace p+i+n+u+g+s+b+acl+xattrs+sha512 <PATH>/augenrules p+i+n+u+g+s+b+acl+xattrs+sha512 Example\n# printf '%s ' \"\" \"# Audit Tools\" \"$(readlink -f /sbin/auditctl) p+i+n+u+g+s+b+acl+xattrs+sha512\" \"$(readlink -f /sbin/auditd) p+i+n+u+g+s+b+acl+xattrs+sha512\" \"$(readlink -f /sbin/ausearch) p+i+n+u+g+s+b+acl+xattrs+sha512\" \"$(readlink -f /sbin/aureport) p+i+n+u+g+s+b+acl+xattrs+sha512\" \"$(readlink -f /sbin/autrace) p+i+n+u+g+s+b+acl+xattrs+sha512\" \"$(readlink -f /sbin/augenrules) p+i+n+u+g+s+b+acl+xattrs+sha512\" >> /etc/aide/aide.conf Note: - IF - /etc/aide/aide.conf includes a @@x_include statement:\n• <DIRECTORY> and each executable config file must be owned by the current user or root • They must not be group or world -writable Example:\n@@x_include /etc/aide.conf.d ^[a -zA-Z0-9_-]+$"
    }
  ]
}