{
  "milestone": "5.4 User Accounts and Environment",
  "version": "1.0.0",
  "description": "Ubuntu 22.04 LTS CIS Benchmark - Section 5.4 User Accounts and Environment",
  "controls": [
    {
      "id": "5.4.1.1",
      "title": "Ensure password expiration is configured",
      "section": "Access Control",
      "description": "The PASS_MAX_DAYS parameter in /etc/login.defs allows an administrator to force passwords to expire once they reach a defined age.",
      "rationale": "The window of opportunity for an attacker to leverage compromised credentials or successfully compromise credentials via an online brute force attack is limited by the age of the password.",
      "impact": "Users will be forced to change their passwords on a regular basis.",
      "remediation": "Set PASS_MAX_DAYS parameter to 365 or less in /etc/login.defs",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/login.defs",
      "pattern": "PASS_MAX_DAYS\\s+([1-9]|[1-9][0-9]|[1-2][0-9][0-9]|3[0-5][0-9]|36[0-5])",
      "expected_match": true
    },
    {
      "id": "5.4.1.3",
      "title": "Ensure password expiration warning days is configured",
      "section": "Access Control",
      "description": "The PASS_WARN_AGE parameter in /etc/login.defs allows an administrator to notify users that their password will expire in a defined number of days.",
      "rationale": "Providing an advance warning that a password will be expiring gives users time to think of a secure password.",
      "impact": "Users will receive advance warning of password expiration.",
      "remediation": "Set PASS_WARN_AGE parameter to 7 or more in /etc/login.defs",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/login.defs",
      "pattern": "PASS_WARN_AGE\\s+([7-9]|[1-9][0-9])",
      "expected_match": true
    },
    {
      "id": "5.4.1.4",
      "title": "Ensure strong password hashing algorithm is configured",
      "section": "Access Control",
      "description": "The commands below change password encryption from md5 to sha512 (a much stronger hashing algorithm).",
      "rationale": "The SHA-512 algorithm provides much stronger hashing than MD5, thus providing additional protection to the system by increasing the level of effort for an attacker to successfully determine passwords.",
      "impact": "All existing accounts will need to perform a password change to upgrade the stored hashes to the new algorithm.",
      "remediation": "Edit the /etc/login.defs file and set ENCRYPT_METHOD SHA512",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/login.defs",
      "pattern": "ENCRYPT_METHOD\\s+SHA512",
      "expected_match": true
    },
    {
      "id": "5.4.1.5",
      "title": "Ensure inactive password lock is configured",
      "section": "Access Control",
      "description": "User accounts that have been inactive for over a given period of time can be automatically disabled.",
      "rationale": "Inactive accounts pose a threat to system security since the users are not logging in to notice failed login attempts or other anomalies.",
      "impact": "Users that do not log in within the specified number of days will have their account disabled.",
      "remediation": "Run the following command to set the default password inactivity period to 30 days: useradd -D -f 30",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/default/useradd",
      "pattern": "INACTIVE=([1-2][0-9]|30)",
      "expected_match": true
    },
    {
      "id": "5.4.2.1",
      "title": "Ensure root is the only UID 0 account",
      "section": "Access Control",
      "description": "Any account with UID 0 has superuser privileges on the system.",
      "rationale": "This access must be limited to only the default root account and only from the system console. Administrative access must be through an unprivileged account using an approved mechanism as noted in Item 5.6 Ensure access to the su command is restricted.",
      "impact": "None.",
      "remediation": "Remove any users other than root with UID 0 or assign them a new UID if appropriate.",
      "profile": "Level1",
      "type": "DuplicateUIDs",
      "passwd_file": "/etc/passwd"
    },
    {
      "id": "5.4.2.7",
      "title": "Ensure system accounts do not have a valid login shell",
      "section": "Access Control",
      "description": "There are a number of accounts provided with most distributions that are used to manage applications and are not intended to provide an interactive shell.",
      "rationale": "It is important to make sure that accounts that are not being used by regular users are prevented from being used to provide an interactive shell.",
      "impact": "None.",
      "remediation": "Set the shell for any accounts returned by the audit to /usr/sbin/nologin",
      "profile": "Level1",
      "type": "Manual"
    },
    {
      "id": "5.4.3.1",
      "title": "Ensure nologin is not listed in /etc/shells",
      "section": "Access Control",
      "description": "The /etc/shells file contains the list of valid login shells for users on the system.",
      "rationale": "An attacker with access to an account assigned the nologin shell could potentially bypass the intended restriction if nologin is listed as a valid shell.",
      "impact": "None.",
      "remediation": "Remove /usr/sbin/nologin and /sbin/nologin entries from /etc/shells",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/shells",
      "pattern": "/usr/sbin/nologin|/sbin/nologin",
      "expected_match": false
    },
    {
      "id": "5.4.3.2",
      "title": "Ensure default user shell timeout is configured",
      "section": "Access Control",
      "description": "The default TMOUT environment variable sets a timeout on interactive shell sessions.",
      "rationale": "Having no timeout value associated with a shell could allow an unauthorized user to access another user's shell session that has been left unattended for an extended period of time.",
      "impact": "The setting removes the ability for users to have indefinite idle time. However, the setting will not affect users who are logged in via a graphical interface.",
      "remediation": "Edit the /etc/bash.bashrc, /etc/profile files (and the appropriate files in /etc/profile.d) and add or edit any umask parameters as follows: TMOUT=900",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/bash.bashrc",
      "pattern": "TMOUT=([1-8][0-9][0-9]|900)",
      "expected_match": true
    },
    {
      "id": "5.4.3.3",
      "title": "Ensure default user umask is configured",
      "section": "Access Control",
      "description": "The default umask determines the permissions of files created by users.",
      "rationale": "Setting a very secure default value for umask ensures that users make a conscious choice about their file permissions.",
      "impact": "Setting a very restrictive default umask may cause problems with some software installations.",
      "remediation": "Edit the /etc/bash.bashrc, /etc/profile files (and the appropriate files in /etc/profile.d) and add or edit any umask parameters as follows: umask 027",
      "profile": "Level1",
      "type": "ConfigFile",
      "file_path": "/etc/bash.bashrc",
      "pattern": "umask\\s+(0[0-2][0-7]|[0-2][0-7])",
      "expected_match": true
    }
  ]
}