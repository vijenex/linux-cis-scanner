{
  "milestone": "5.4",
  "version": "1.0.0",
  "description": "CentOS Linux 7 CIS Benchmark v3.1.2 - Section 5.4",
  "controls": [
    {
      "id": "5.4.1",
      "title": "Ensure password creation requirements are configured",
      "section": "Section 5.4",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "severity": "medium",
      "cis_reference": "CIS CentOS Linux 7 Benchmark v3.1.2 - 5.4.1",
      "description": "The pam_pwquality.so module checks the strength of passwords. It performs checks such as making sure a password is not a dictionary word, it is a certain length, contains a mix of characters (e.g. alphabet, numeric, other) and more. The following are definitions of the pam_pwquality.so options. The following options are set in the /etc/security/pwquality.conf file: Password Length: \uf0b7 minlen = 14 - password must be 14 characters or more Password complexity: \uf0b7 minclass = 4 - The minimum number of required classes of characters for t he new password (digits, uppercase, lowercase, others) OR \uf0b7 dcredit = -1 - provide at least one digit \uf0b7 ucredit = -1 - provide at least one uppercase character \uf0b7 ocredit = -1 - provide at least one special character \uf0b7 lcredit = -1 - provide at least one lowercase character The following is set in the /etc/pam.d/password -auth and /etc/pam.d/system -auth files \uf0b7 try_first_pass - retrieve the password from a previous stacked PAM module. If not available, then prompt the user for a passwo rd. \uf0b7 retry=3 - Allow 3 tries before sending back a failure. The settings shown above are one possible policy. Alter these values to conform to your own organization's password policies. Notes: \uf0b7 Settings in /etc/security/pwquality.conf must use spaces around the = symbol. \uf0b7 Additional modules options may be set in the /etc/pam.d/password -auth and /etc/pam.d/system -auth files 501 | P a g e",
      "rationale": "Strong passwords and limited attempts before locking an account protect systems from being hacked thro ugh brute force methods.",
      "remediation": ": Edit the file /etc/security/pwquality.conf and add or modify the following line for password length to conform to site policy minlen = 14 Edit the file /etc/security/pwquality.conf and add or modify the following line for password complexity t o conform to site policy minclass = 4 OR dcredit = -1 ucredit = -1 ocredit = -1 lcredit = -1 Edit the /etc/pam.d/password -auth and /etc/pam.d/system -auth files to include the appropriate options for pam_pwquality.so and to conform to site policy: password requisite pam_pwquality.so try_first_pass retry=3 CIS Controls: Controls Version Control IG 1 IG 2 IG 3 v8 5.2 Use Unique Passwords Use unique passwords for all enterprise assets. Best practice implementation includes, at a minimum, an 8 -character password for accounts using MFA and a 14 - character password for accounts not using MFA. \u25cf \u25cf \u25cf v7 4.4 Use Unique Passwords Where multi -factor authentication is not supported (such as local administrator, root, or service accounts), accounts will use passwords that are unique to that system. \u25cf \u25cf 503 | P a g e",
      "impact": "None",
      "audit_command": "Verify password creation requirements conform to organization policy. Run the following command to verify the minimum password length is 14 or more characters. # grep '^ \\s*minlen \\s*' /etc/security/pwquality.conf minlen = 14 Run one of the following commands to verify the required password complexity: # grep '^ \\s*minclass \\s*' /etc/security/pwquality.conf minclass = 4 OR # grep -E '^\\s*[duol]credit \\s*' /etc/security/pwquality.conf dcredit = -1 ucredit = -1 lcredit = -1 ocredit = -1 Run the following commands to verify the files: /etc/pam.d/password -auth and /etc/pam.d/system -auth include try_first_pass and retry=3 on the password requisite pam_pwquality.so line. # grep -P '^\\s*password \\s+(?:requisite|required) \\s+pam_pwquality \\.so\\s+(?:\\S+\\s+)*(?!\\2 )(retry=[1 -3]|try_first_pass) \\s+(?:\\S+\\s+)*(?!\\1)(retry=[1 - 3]|try_first_pass) \\s*(?:\\s+\\S+\\s*)*(?:\\s+#.*)?$' /etc/pam.d/password -auth password requisite pam_pwquality.so try_first_pass retry=3 # grep -P '^\\s*password \\s+(?:requ isite|required) \\s+pam_pwquality \\.so\\s+(?:\\S+\\s+)*(?!\\2 )(retry=[1 -3]|try_first_pass) \\s+(?:\\S+\\s+)*(?!\\1)(retry=[1 - 3]|try_first_pass) \\s*(?:\\s+\\S+\\s*)*(?:\\s+#.*)?$' /etc/pam.d/system -auth password requisite pam_pwquality.so try_first_pass retry=3 502 | P a g e",
      "file_path": "/etc/security/pwquality.conf",
      "pattern": "password|authentication"
    },
    {
      "id": "5.4.2",
      "title": "Ensure lockout for failed password attempts is configured",
      "section": "Section 5.4",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "severity": "medium",
      "cis_reference": "CIS CentOS Linux 7 Benchmark v3.1.2 - 5.4.2",
      "description": "Lock out users after n unsuccessful consecutive login attempts. These settings are commonly configured with the pam_faillock.so module. Some environments may continue using the pam_tally2.so module, where this older method may simplify automation in mixed environments. Set the lockout number in deny= to the policy in effect at your site. unlock_time=_n_ is the number of seconds the account remains locked after the number of attem pts configured in deny=_n_ has been met. Notes: \uf0b7 Additional module options may be set, recommendation only covers those listed here. \uf0b7 When modifying authentication configuration using the authconfig utility, the system - auth and password -auth files are overw ritten with the settings from the authconfig utility. This can be avoided by creating symbolic links in place of the configuration files, which authconfig recognizes and does not overwrite. These symbolic links are the default for Fedora 19 derived distrib utions. \uf0b7 Use of the \"audit\" keyword may log credentials in the case of user error during authentication. This risk should be evaluated in the context of the site policies of your organization. \uf0b7 If a user has been locked out because they have reached the ma ximum consecutive failure count defined by deny= in the pam_faillock.so or the pam_tally2.so module, the user can be unlocked by issuing following commands. This command sets the failed count to 0, effectively unlocking the user. o If pam_faillock.so is used: o # faillock --user <username> --reset o If pam_tally2.so is used: o # pam_tally2 -u <username> --reset 504 | P a g e",
      "rationale": "Locking out user IDs after n unsuccessful consecutive login attempts mitigates brute force password attacks against your systems.",
      "remediation": "Edit the files /etc/pam.d/system -auth and /etc/pam.d/password -auth and add the following lines: Modify the deny= and unlock_time= parameters to conform to local site policy, Not to be greater than deny=5 To use pam_faillock.so module, add the following lines to the auth section: auth required pam_faillock.so preauth silent audit deny=5 unlock_time=900 auth [default=die] pam_faillock.so authfail audit deny=5 unlock_time=900 The auth sections should look simila r to the following example: Note: The ordering on the lines in the auth section is important. The preauth line needs to below the line auth required pam_env.so and above all password validation lines. The authfail line needs to be after all password valida tion lines such as pam_sss.so . Incorrect order can cause you to be locked out of the system Example: auth required pam_env.so auth required pam_faillock.so preauth silent audit deny=5 unlock_time=900 # < - Under \"auth required pam_env.so\" auth sufficient pam_unix.so nullok try_first_pass auth [default=die] pam_faillock.so authfail audit deny=5 unlock_time=900 # < - Last auth line before \"auth requisite pam_succeed_if.so\" auth requisite pam_succeed_if. so uid >= 1000 quiet_success auth required pam_deny.so Add the following line to the account section: 506 | P a g e account required pam_faillock.so Example: account required pam_faillock.so account required pam_unix.so account s ufficient pam_localuser.so account sufficient pam_pam_succeed_if.so uid < 1000 quiet account required pam_permit.so OR To use the pam_tally2.so module, add the following line to the auth section: auth required pam_tally2.so deny =5 onerr=fail unlock_time=900 The auth sections should look similar to the following example: Note: The ordering on the lines in the auth section is important. the additional line needs to below the line auth required pam_env.so and above all password vali dation lines. Example: auth required pam_env.so auth required pam_tally2.so deny=5 onerr=fail unlock_time=900 # <- Under \"auth required pam_env.so\" auth sufficient pam_unix.so nullok try_first_pass auth requisite pam_succeed_if.so uid >= 1000 quiet_success auth required pam_deny.so Add the following line to the account section: account required pam_tally2.so Example: account required pam_tally2.so account required pam_unix.so account sufficient pam_localuser.so account sufficient pam_pam_succeed_if.so uid < 1000 quiet account required pam_permit.so",
      "impact": "None",
      "audit_command": "Verify password lockouts are configured. Ensure that the deny=_n_ follows local site policy. This should not exceed deny=5 . If pam_failock.so is used: Run the following commands: # grep -E '^\\s*auth\\s+\\S+\\s+pam_(faillock|unix) \\.so' /etc/pam.d/system -auth /etc/pam.d/password -auth Verify the output includes the following lines: /etc/pam.d/system -auth:auth required pam_faillock.so preauth silent audit deny=5 unlock_time=900 /etc/pam.d/system -auth:auth sufficient pam_unix.so nullok try_first_pass /etc/pam.d/system -auth:auth [default=die] pam_faillock.so authfail audit deny=5 unlock_time=900 /etc/pam.d/password -auth:auth required pam_faillock.so preauth silent audit deny=5 unlock_time=900 /etc/pam.d/password -auth:auth sufficient pam_unix.so nullok try_first_pass /etc/pam.d/password -auth:auth [default=die] pam_faillock.so authfail audit deny=5 unlock_time=900 # grep -E '^\\s*account \\s+required \\s+pam_faillock.so \\s*' /etc/pam.d/system - auth /etc/pam.d/pas sword-auth Verify the output includes the following lines: /etc/pam.d/system -auth:account required pam_faillock.so /etc/pam.d/password -auth:account required pam_faillock.so OR If pam_tally2.so is used: Run the following commands: # grep -E '^\\s*auth\\s+\\S+\\s+pam_(tally2|unix) \\.so' /etc/pam.d/system -auth /etc/pam.d/password -auth Verify the output includes the following lines: 505 | P a g e /etc/pam.d/system -auth:auth required pam_tally2.so deny=5 onerr=fail unlock_time=900 /etc/pam.d/system -auth:auth sufficient pam_unix.so nullok try_first_pass /etc/pam.d/password -auth:auth required pam_tally2.so deny=5 onerr=fail unlock_time=900 /etc/pam.d/password -auth:auth sufficient pam_unix.so nullok try_first_pass # grep -E '^\\s*account \\s+required \\s+pam_tally2.so \\s*' /etc/pam.d/system -auth /etc/pam.d/password -auth Verify the output includes the following lines: /etc/pam.d/system -auth:account required pam_tally2.so /etc/pam.d/password -auth:account required pam_tally2.so"
    },
    {
      "id": "5.4.3",
      "title": "Ensure password hashing algorithm is SHA -512",
      "section": "Section 5.4",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "severity": "medium",
      "cis_reference": "CIS CentOS Linux 7 Benchmark v3.1.2 - 5.4.3",
      "description": "The commands below change password encryption from md5 to sha512 (a much stronger hashing algorithm). All existing accounts will need to perform a password change to upgrade the stored hashes to the new algorithm. Note: \uf0b7 These changes only apply to accounts configured on the local system. \uf0b7 Additional module options may be set, recommendation only covers those listed here.",
      "rationale": "The SHA -512 algorithm provides much stronger hashing than MD5, thus providing additional protection to the system by increasing the level of effort for an attacker to successfully determine passwords.",
      "remediation": ": Edit the /etc/pam.d/password -auth and /etc/pam.d/system -auth files to include sha512 option and remove the md5 option for pam_unix.so : password sufficient pam_unix.so sha512 Note: \uf0b7 Any system accounts that need to be expired should be carefully done separately by the system administrator to prevent any potential problems. \uf0b7 If it is determined that the password algorithm being used is not SHA -512, once it is changed, it is recommended that all user ID's be immediately expired and forced to change their passwords on next login, In accordance wit h local site policies. \uf0b7 To accomplish this, the following command can be used. o This command intentionally does not affect the root account. The root account's password will also need to be changed. # awk -F: '( $3<'\"$(awk '/^ \\s*UID_MIN/{print $2}' /etc/login.defs)\"' && $1 !~ /^(nfs)?nobody$/ && $1 != \"root\" ) { print $1 }' /etc/passwd | xargs -n 1 chage -d 0 CIS Controls: Controls Version Control IG 1 IG 2 IG 3 v8 3.11 Encrypt Sensitive Data at Rest Encrypt sensitive data at rest on servers, applications, and databases containing sensitive data. Storage -layer encryption, also known as server -side encryption, meets the minimum requirement of this Safeguard. Additional encryption methods may include app lication -layer encryption, also known as client -side encryption, where access to the data storage device(s) does not permit access to the plain -text data. \u25cf \u25cf v7 16.4 Encrypt or Hash all Authentication Credentials Encrypt or hash with a salt all authentication credentials when stored. \u25cf \u25cf 510 | P a g e",
      "impact": "None",
      "audit_command": "Run the following command to verify the sha512 option is included: # grep -P '^\\h*password \\h+(sufficient|requisite|required) \\h+pam_unix \\.so\\h+([^#\\n\\r]+)? sha512(\\h+.*)?$' /etc/pam.d/system -auth /etc/pam.d/password -auth /etc/pam.d/system -auth:password sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok /etc/pam.d/password -auth:password sufficient pam_unix.so sha512 shadow nullok try_first_pass use_authtok 509 | P a g e"
    },
    {
      "id": "5.4.4",
      "title": "Ensure password reuse is limited",
      "section": "Section 5.4",
      "profile": "Level1",
      "automated": true,
      "type": "Manual",
      "severity": "medium",
      "cis_reference": "CIS CentOS Linux 7 Benchmark v3.1.2 - 5.4.4",
      "description": "Ensure password reuse is limited",
      "rationale": "Refer to CIS Benchmark documentation",
      "remediation": "Refer to CIS Benchmark documentation",
      "impact": "None",
      "audit_command": "Manual review required"
    }
  ]
}