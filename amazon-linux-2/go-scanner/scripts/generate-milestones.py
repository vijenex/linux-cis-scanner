#!/usr/bin/env python3
"""
Generate all milestone files for Amazon Linux 2 CIS Benchmark v3.0.0
Based on the official CIS Amazon Linux 2 Benchmark document
"""

import json
import os

def create_control(control_id, title, section, profile, automated, control_type, **kwargs):
    """Create a control entry without severity field"""
    control = {
        "id": control_id,
        "title": title,
        "section": section,
        "profile": profile,
        "automated": automated,
        "type": control_type,
        "cis_reference": f"CIS Amazon Linux 2 - {control_id} | {profile}",
        "description": kwargs.get("description", ""),
        "remediation": kwargs.get("remediation", "")
    }
    # Add type-specific fields
    for key, value in kwargs.items():
        if key not in ["description", "remediation"]:
            control[key] = value
    return control

def create_milestone(milestone_id, section_name, description, controls):
    """Create a milestone file structure"""
    return {
        "milestone": milestone_id,
        "version": "1.0.0",
        "description": f"Amazon Linux 2 CIS Benchmark v3.0.0 - {description}",
        "section": section_name,
        "controls": controls
    }

# Section 1.1.2 - Continue filesystem partitions
def milestone_1_2_remaining():
    controls = [
        create_control("1.1.2.2.1", "Ensure /dev/shm is a separate partition", "1.1.2.2 Configure /dev/shm", "Level1", True, "MountPoint",
                      mount_point="/dev/shm", expected_status="separate_partition",
                      description="The /dev/shm filesystem is used for the Shared Memory Segment. Separating /dev/shm from the root filesystem ensures that processes cannot exhaust all available space on the root filesystem.",
                      remediation="Create a separate partition for /dev/shm and add it to /etc/fstab"),
        create_control("1.1.2.2.2", "Ensure nodev option set on /dev/shm partition", "1.1.2.2 Configure /dev/shm", "Level1", True, "MountOption",
                      mount_point="/dev/shm", required_option="nodev",
                      description="The nodev mount option specifies that the filesystem cannot contain special devices. This prevents device files from being created in /dev/shm.",
                      remediation="Edit /etc/fstab and add nodev to the mount options for /dev/shm"),
        create_control("1.1.2.2.3", "Ensure nosuid option set on /dev/shm partition", "1.1.2.2 Configure /dev/shm", "Level1", True, "MountOption",
                      mount_point="/dev/shm", required_option="nosuid",
                      description="The nosuid mount option specifies that the filesystem cannot contain setuid files. This prevents setuid files from being executed from /dev/shm.",
                      remediation="Edit /etc/fstab and add nosuid to the mount options for /dev/shm"),
        create_control("1.1.2.2.4", "Ensure noexec option set on /dev/shm partition", "1.1.2.2 Configure /dev/shm", "Level1", True, "MountOption",
                      mount_point="/dev/shm", required_option="noexec",
                      description="The noexec mount option specifies that the filesystem cannot contain executable binaries. This prevents executable files from being executed from /dev/shm.",
                      remediation="Edit /etc/fstab and add noexec to the mount options for /dev/shm"),
    ]
    return create_milestone("1.2.2", "1 Initial Setup", "Section 1.1.2.2 Configure /dev/shm", controls)

# Section 1.1.2.3 - Configure /home
def milestone_1_2_3():
    controls = [
        create_control("1.1.2.3.1", "Ensure separate partition exists for /home", "1.1.2.3 Configure /home", "Level1", True, "MountPoint",
                      mount_point="/home", expected_status="separate_partition",
                      description="The /home directory is used to support disk storage needs of local users. Separating /home from the root filesystem ensures that processes cannot exhaust all available space on the root filesystem.",
                      remediation="Create a separate partition for /home and add it to /etc/fstab"),
        create_control("1.1.2.3.2", "Ensure nodev option set on /home partition", "1.1.2.3 Configure /home", "Level1", True, "MountOption",
                      mount_point="/home", required_option="nodev",
                      description="The nodev mount option specifies that the filesystem cannot contain special devices. This prevents device files from being created in /home.",
                      remediation="Edit /etc/fstab and add nodev to the mount options for /home"),
        create_control("1.1.2.3.3", "Ensure nosuid option set on /home partition", "1.1.2.3 Configure /home", "Level1", True, "MountOption",
                      mount_point="/home", required_option="nosuid",
                      description="The nosuid mount option specifies that the filesystem cannot contain setuid files. This prevents setuid files from being executed from /home.",
                      remediation="Edit /etc/fstab and add nosuid to the mount options for /home"),
    ]
    return create_milestone("1.2.3", "1 Initial Setup", "Section 1.1.2.3 Configure /home", controls)

# Section 1.1.2.4 - Configure /var
def milestone_1_2_4():
    controls = [
        create_control("1.1.2.4.1", "Ensure separate partition exists for /var", "1.1.2.4 Configure /var", "Level1", True, "MountPoint",
                      mount_point="/var", expected_status="separate_partition",
                      description="The /var directory is used by daemons and other system services to store frequently changing data. Separating /var from the root filesystem ensures that processes cannot exhaust all available space on the root filesystem.",
                      remediation="Create a separate partition for /var and add it to /etc/fstab"),
        create_control("1.1.2.4.2", "Ensure nodev option set on /var partition", "1.1.2.4 Configure /var", "Level1", True, "MountOption",
                      mount_point="/var", required_option="nodev",
                      description="The nodev mount option specifies that the filesystem cannot contain special devices. This prevents device files from being created in /var.",
                      remediation="Edit /etc/fstab and add nodev to the mount options for /var"),
        create_control("1.1.2.4.3", "Ensure nosuid option set on /var partition", "1.1.2.4 Configure /var", "Level1", True, "MountOption",
                      mount_point="/var", required_option="nosuid",
                      description="The nosuid mount option specifies that the filesystem cannot contain setuid files. This prevents setuid files from being executed from /var.",
                      remediation="Edit /etc/fstab and add nosuid to the mount options for /var"),
    ]
    return create_milestone("1.2.4", "1 Initial Setup", "Section 1.1.2.4 Configure /var", controls)

# Section 1.1.2.5 - Configure /var/tmp
def milestone_1_2_5():
    controls = [
        create_control("1.1.2.5.1", "Ensure separate partition exists for /var/tmp", "1.1.2.5 Configure /var/tmp", "Level1", True, "MountPoint",
                      mount_point="/var/tmp", expected_status="separate_partition",
                      description="The /var/tmp directory is a world-writable directory used for temporary file storage. Separating /var/tmp from the root filesystem ensures that processes cannot exhaust all available space on the root filesystem.",
                      remediation="Create a separate partition for /var/tmp and add it to /etc/fstab"),
        create_control("1.1.2.5.2", "Ensure nodev option set on /var/tmp partition", "1.1.2.5 Configure /var/tmp", "Level1", True, "MountOption",
                      mount_point="/var/tmp", required_option="nodev",
                      description="The nodev mount option specifies that the filesystem cannot contain special devices. This prevents device files from being created in /var/tmp.",
                      remediation="Edit /etc/fstab and add nodev to the mount options for /var/tmp"),
        create_control("1.1.2.5.3", "Ensure nosuid option set on /var/tmp partition", "1.1.2.5 Configure /var/tmp", "Level1", True, "MountOption",
                      mount_point="/var/tmp", required_option="nosuid",
                      description="The nosuid mount option specifies that the filesystem cannot contain setuid files. This prevents setuid files from being executed from /var/tmp.",
                      remediation="Edit /etc/fstab and add nosuid to the mount options for /var/tmp"),
        create_control("1.1.2.5.4", "Ensure noexec option set on /var/tmp partition", "1.1.2.5 Configure /var/tmp", "Level1", True, "MountOption",
                      mount_point="/var/tmp", required_option="noexec",
                      description="The noexec mount option specifies that the filesystem cannot contain executable binaries. This prevents executable files from being executed from /var/tmp.",
                      remediation="Edit /etc/fstab and add noexec to the mount options for /var/tmp"),
    ]
    return create_milestone("1.2.5", "1 Initial Setup", "Section 1.1.2.5 Configure /var/tmp", controls)

# Section 1.1.2.6 - Configure /var/log
def milestone_1_2_6():
    controls = [
        create_control("1.1.2.6.1", "Ensure separate partition exists for /var/log", "1.1.2.6 Configure /var/log", "Level1", True, "MountPoint",
                      mount_point="/var/log", expected_status="separate_partition",
                      description="The /var/log directory is used by system services to store log data. Separating /var/log from the root filesystem ensures that processes cannot exhaust all available space on the root filesystem.",
                      remediation="Create a separate partition for /var/log and add it to /etc/fstab"),
        create_control("1.1.2.6.2", "Ensure nodev option set on /var/log partition", "1.1.2.6 Configure /var/log", "Level1", True, "MountOption",
                      mount_point="/var/log", required_option="nodev",
                      description="The nodev mount option specifies that the filesystem cannot contain special devices. This prevents device files from being created in /var/log.",
                      remediation="Edit /etc/fstab and add nodev to the mount options for /var/log"),
        create_control("1.1.2.6.3", "Ensure nosuid option set on /var/log partition", "1.1.2.6 Configure /var/log", "Level1", True, "MountOption",
                      mount_point="/var/log", required_option="nosuid",
                      description="The nosuid mount option specifies that the filesystem cannot contain setuid files. This prevents setuid files from being executed from /var/log.",
                      remediation="Edit /etc/fstab and add nosuid to the mount options for /var/log"),
        create_control("1.1.2.6.4", "Ensure noexec option set on /var/log partition", "1.1.2.6 Configure /var/log", "Level1", True, "MountOption",
                      mount_point="/var/log", required_option="noexec",
                      description="The noexec mount option specifies that the filesystem cannot contain executable binaries. This prevents executable files from being executed from /var/log.",
                      remediation="Edit /etc/fstab and add noexec to the mount options for /var/log"),
    ]
    return create_milestone("1.2.6", "1 Initial Setup", "Section 1.1.2.6 Configure /var/log", controls)

# Section 1.1.2.7 - Configure /var/log/audit
def milestone_1_2_7():
    controls = [
        create_control("1.1.2.7.1", "Ensure separate partition exists for /var/log/audit", "1.1.2.7 Configure /var/log/audit", "Level1", True, "MountPoint",
                      mount_point="/var/log/audit", expected_status="separate_partition",
                      description="The /var/log/audit directory is used by the audit daemon to store audit records. Separating /var/log/audit from the root filesystem ensures that processes cannot exhaust all available space on the root filesystem.",
                      remediation="Create a separate partition for /var/log/audit and add it to /etc/fstab"),
        create_control("1.1.2.7.2", "Ensure nodev option set on /var/log/audit partition", "1.1.2.7 Configure /var/log/audit", "Level1", True, "MountOption",
                      mount_point="/var/log/audit", required_option="nodev",
                      description="The nodev mount option specifies that the filesystem cannot contain special devices. This prevents device files from being created in /var/log/audit.",
                      remediation="Edit /etc/fstab and add nodev to the mount options for /var/log/audit"),
        create_control("1.1.2.7.3", "Ensure nosuid option set on /var/log/audit partition", "1.1.2.7 Configure /var/log/audit", "Level1", True, "MountOption",
                      mount_point="/var/log/audit", required_option="nosuid",
                      description="The nosuid mount option specifies that the filesystem cannot contain setuid files. This prevents setuid files from being executed from /var/log/audit.",
                      remediation="Edit /etc/fstab and add nosuid to the mount options for /var/log/audit"),
        create_control("1.1.2.7.4", "Ensure noexec option set on /var/log/audit partition", "1.1.2.7 Configure /var/log/audit", "Level1", True, "MountOption",
                      mount_point="/var/log/audit", required_option="noexec",
                      description="The noexec mount option specifies that the filesystem cannot contain executable binaries. This prevents executable files from being executed from /var/log/audit.",
                      remediation="Edit /etc/fstab and add noexec to the mount options for /var/log/audit"),
    ]
    return create_milestone("1.2.7", "1 Initial Setup", "Section 1.1.2.7 Configure /var/log/audit", controls)

# Section 1.2 - Configure Software and Patch Management
def milestone_1_3():
    controls = [
        create_control("1.2.1", "Ensure GPG keys are configured", "1.2 Configure Software and Patch Management", "Level1", False, "Manual",
                      description="The RPM Package Manager implements GPG key signing to verify package integrity during and after installation. It is important to ensure that updates are obtained from a valid source to protect against spoofing that could lead to the inadvertent installation of malware on the system.",
                      remediation="Update your package manager GPG keys in accordance with site policy."),
        create_control("1.2.2", "Ensure gpgcheck is globally activated", "1.2 Configure Software and Patch Management", "Level1", True, "FileContent",
                      file_path="/etc/yum.conf", pattern="^gpgcheck\\s*=\\s*1", expected_result="found",
                      description="The gpgcheck option controls verifying package signatures after download. It is important to ensure that an RPM's package signature is always checked prior to installation to ensure that the software is obtained from a trusted source.",
                      remediation="Edit /etc/yum.conf and set gpgcheck=1 in the [main] section. Edit any failing files in /etc/yum.repos.d/* and set all instances starting with gpgcheck to 1."),
        create_control("1.2.3", "Ensure repo_gpgcheck is globally activated", "1.2 Configure Software and Patch Management", "Level2", False, "Manual",
                      description="The repo_gpgcheck option, found in the main section of the /etc/yum.conf and individual /etc/yum.repos.d/* files, will perform a GPG signature check on the repodata.",
                      remediation="Global configuration: Edit /etc/yum.conf and set repo_gpgcheck=1 in the [main] section. Per repository configuration: Edit any failing files in /etc/yum.repos.d/* and set all instances starting with repo_gpgcheck to 1."),
        create_control("1.2.4", "Ensure package manager repositories are configured", "1.2 Configure Software and Patch Management", "Level1", False, "Manual",
                      description="Systems need to have the respective package manager repositories configured to ensure that the system is able to receive the latest patches and updates.",
                      remediation="Configure your package manager repositories according to site policy."),
        create_control("1.2.5", "Ensure updates, patches, and additional security software are installed", "1.2 Configure Software and Patch Management", "Level1", False, "Manual",
                      description="Periodically patches are released for included software either due to security flaws or to include additional functionality.",
                      remediation="Run the following command to update all packages: # yum update"),
    ]
    return create_milestone("1.3", "1 Initial Setup", "Section 1.2 Configure Software and Patch Management", controls)

# Section 1.3 - Configure Secure Boot Settings
def milestone_1_4():
    controls = [
        create_control("1.3.1", "Ensure authentication required for single user mode", "1.3 Configure Secure Boot Settings", "Level1", True, "FileContent",
                      file_path="/etc/sysconfig/init", pattern="^SINGLE", expected_result="found",
                      description="Single user mode is used for recovery when the system enters an undesirable state. Requiring authentication prevents unauthorized local access to the system.",
                      remediation="Edit /etc/sysconfig/init and set SINGLE=/sbin/sulogin"),
    ]
    return create_milestone("1.4", "1 Initial Setup", "Section 1.3 Configure Secure Boot Settings", controls)

# Section 1.4 - Configure Additional Process Hardening
def milestone_1_5():
    controls = [
        create_control("1.4.1", "Ensure address space layout randomization (ASLR) is enabled", "1.4 Configure Additional Process Hardening", "Level1", True, "SysctlParameter",
                      parameter_name="kernel.randomize_va_space", expected_value="2",
                      description="Address space layout randomization (ASLR) is an exploit mitigation technique which randomly arranges the address space of key data areas of a process. Randomly placing virtual memory regions will make it difficult to write memory page exploits as the memory placement will be consistently shifting.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: kernel.randomize_va_space = 2"),
        create_control("1.4.2", "Ensure ptrace_scope is restricted", "1.4 Configure Additional Process Hardening", "Level1", True, "SysctlParameter",
                      parameter_name="kernel.yama.ptrace_scope", expected_value="1",
                      description="The ptrace() system call provides a means by which one process may observe and control the execution of another process. Restricting ptrace to only child processes prevents processes from being able to observe and manipulate arbitrary processes.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: kernel.yama.ptrace_scope = 1"),
        create_control("1.4.3", "Ensure core dump backtraces are disabled", "1.4 Configure Additional Process Hardening", "Level1", True, "SysctlParameter",
                      parameter_name="kernel.core_pattern", expected_value="|/bin/false",
                      description="A core dump includes a memory image taken at the time the operating system terminates an application. The memory image could contain sensitive data and is generally useful only for developers trying to debug problems.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: kernel.core_pattern = |/bin/false"),
        create_control("1.4.4", "Ensure core dump storage is disabled", "1.4 Configure Additional Process Hardening", "Level1", True, "FileContent",
                      file_path="/etc/security/limits.conf", pattern="\\*\\s+hard\\s+core\\s+0", expected_result="found",
                      description="A core dump includes a memory image taken at the time the operating system terminates an application. The memory image could contain sensitive data and is generally useful only for developers trying to debug problems.",
                      remediation="Add the following line to /etc/security/limits.conf or a file in /etc/security/limits.d/: * hard core 0"),
    ]
    return create_milestone("1.5", "1 Initial Setup", "Section 1.4 Configure Additional Process Hardening", controls)

# Section 1.5 - Mandatory Access Control (SELinux)
def milestone_1_6():
    controls = [
        create_control("1.5.1.1", "Ensure SELinux is installed", "1.5.1 Configure SELinux", "Level1", True, "PackageInstalled",
                      package_name="libselinux", expected_status="installed",
                      description="SELinux provides Mandatory Access Control. Without a Mandatory Access Control system installed only the default Discretionary Access Control system will be available.",
                      remediation="Run the following command to install SELinux: # yum install libselinux"),
        create_control("1.5.1.2", "Ensure SELinux is not disabled in bootloader configuration", "1.5.1 Configure SELinux", "Level1", True, "FileContent",
                      file_path="/etc/default/grub", pattern="selinux=0|enforcing=0", expected_result="not_found",
                      description="Configure SELINUX to be enabled at boot time and verify that it has not been overwritten by the grub boot parameters.",
                      remediation="Remove any instances of selinux=0 or enforcing=0 from /etc/default/grub and run: # grub2-mkconfig -o /boot/grub2/grub.cfg"),
        create_control("1.5.1.3", "Ensure SELinux policy is configured", "1.5.1 Configure SELinux", "Level1", True, "FileContent",
                      file_path="/etc/selinux/config", pattern="SELINUXTYPE=(targeted|mls)", expected_result="found",
                      description="Configure SELinux to meet or exceed the default targeted policy, which constrains daemons and system software only.",
                      remediation="Edit /etc/selinux/config and add set the SELINUXTYPE line to targeted or mls: SELINUXTYPE=targeted"),
        create_control("1.5.1.4", "Ensure the SELinux mode is not disabled", "1.5.1 Configure SELinux", "Level1", True, "FileContent",
                      file_path="/etc/selinux/config", pattern="SELINUX=(enforcing|permissive)", expected_result="found",
                      description="SELinux can run in one of three modes: disabled, permissive, or enforcing. Running SELinux in disabled mode is strongly discouraged.",
                      remediation="Edit /etc/selinux/config and update the SELINUX parameter to either SELINUX=enforcing or SELINUX=permissive"),
        create_control("1.5.1.5", "Ensure the SELinux mode is enforcing", "1.5.1 Configure SELinux", "Level2", True, "FileContent",
                      file_path="/etc/selinux/config", pattern="SELINUX=enforcing", expected_result="found",
                      description="SELinux can run in one of three modes: disabled, permissive, or enforcing. Enforcing mode is the default, and recommended, mode of operation.",
                      remediation="Edit /etc/selinux/config and update the SELINUX parameter to SELINUX=enforcing"),
        create_control("1.5.1.6", "Ensure no unconfined services exist", "1.5.1 Configure SELinux", "Level2", False, "Manual",
                      description="Unconfined processes run in unconfined domains. For unconfined processes, SELinux policy rules are applied, but policy rules exist that allow processes running in unconfined domains almost all access.",
                      remediation="Investigate any unconfined processes found during the audit action. If necessary create a customize SELinux policy to allow necessary actions for the service."),
        create_control("1.5.1.7", "Ensure the MCS Translation Service (mcstrans) is not installed", "1.5.1 Configure SELinux", "Level1", True, "PackageNotInstalled",
                      package_name="mcstrans", expected_status="not_installed",
                      description="The mcstransd daemon provides category label information to client processes requesting information. Since this service is not used very often, remove it to reduce the amount of potentially vulnerable code running on the system.",
                      remediation="Run the following command to uninstall mcstrans: # yum remove mcstrans"),
        create_control("1.5.1.8", "Ensure SETroubleshoot is not installed", "1.5.1 Configure SELinux", "Level1", True, "PackageNotInstalled",
                      package_name="setroubleshoot", expected_status="not_installed",
                      description="The SETroubleshoot service notifies desktop users of SELinux denials through a user-friendly interface. The SETroubleshoot service is an unnecessary daemon to have running on a server, especially if X Windows is disabled.",
                      remediation="Run the following command to uninstall setroubleshoot: # yum remove setroubleshoot"),
    ]
    return create_milestone("1.6", "1 Initial Setup", "Section 1.5 Mandatory Access Control", controls)

# Section 1.6 - Configure Command Line Warning Banners
def milestone_1_7():
    controls = [
        create_control("1.6.1", "Ensure message of the day is configured properly", "1.6 Configure Command Line Warning Banners", "Level1", False, "Manual",
                      description="The contents of /etc/motd are displayed to users after login and function as a message of the day for automated communication to users.",
                      remediation="Edit /etc/motd with the appropriate contents according to your site policy, remove any instances of \\m, \\r, \\s, \\v or references to the OS platform"),
        create_control("1.6.2", "Ensure local login warning banner is configured properly", "1.6 Configure Command Line Warning Banners", "Level1", True, "FileContent",
                      file_path="/etc/issue", pattern="(\\v|\\r|\\m|\\s)", expected_result="not_found",
                      description="The contents of /etc/issue are displayed to users prior to login for local terminals. Warning banners inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organization that owns the system.",
                      remediation="Edit /etc/issue with the appropriate contents according to your site policy, remove any instances of \\m, \\r, \\s, \\v or references to the OS platform"),
        create_control("1.6.3", "Ensure remote login warning banner is configured properly", "1.6 Configure Command Line Warning Banners", "Level1", True, "FileContent",
                      file_path="/etc/issue.net", pattern="(\\v|\\r|\\m|\\s)", expected_result="not_found",
                      description="The contents of /etc/issue.net are displayed to users prior to login for remote connections from configured services. Warning banners inform users who are attempting to login to the system of their legal status regarding the system.",
                      remediation="Edit /etc/issue.net with the appropriate contents according to your site policy, remove any instances of \\m, \\r, \\s, \\v or references to the OS platform"),
        create_control("1.6.4", "Ensure access to /etc/motd is configured", "1.6 Configure Command Line Warning Banners", "Level1", True, "FilePermissions",
                      file_path="/etc/motd", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="The /etc/motd file is used to display a message of the day to all users. The file needs to be protected from unauthorized changes.",
                      remediation="Run: chmod 644 /etc/motd && chown root:root /etc/motd"),
        create_control("1.6.5", "Ensure access to /etc/issue is configured", "1.6 Configure Command Line Warning Banners", "Level1", True, "FilePermissions",
                      file_path="/etc/issue", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="The /etc/issue file contains a message or system identification information to be printed before the login prompt. The file needs to be protected from unauthorized changes.",
                      remediation="Run: chmod 644 /etc/issue && chown root:root /etc/issue"),
        create_control("1.6.6", "Ensure access to /etc/issue.net is configured", "1.6 Configure Command Line Warning Banners", "Level1", True, "FilePermissions",
                      file_path="/etc/issue.net", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="The /etc/issue.net file contains a message or system identification information to be printed before the login prompt for remote connections. The file needs to be protected from unauthorized changes.",
                      remediation="Run: chmod 644 /etc/issue.net && chown root:root /etc/issue.net"),
    ]
    return create_milestone("1.7", "1 Initial Setup", "Section 1.6 Configure Command Line Warning Banners", controls)

# Section 2.1 - Configure Time Synchronization
def milestone_2_1():
    controls = [
        create_control("2.1.1", "Ensure time synchronization is in use", "2.1 Configure Time Synchronization", "Level1", True, "ServiceStatus",
                      service_name="chronyd", expected_status="enabled",
                      description="Time synchronization is important to support accurate time logging. Accurate time logging is important for correlation of events and for supporting forensic investigations.",
                      remediation="Run the following command to install chrony: # yum install chrony && systemctl enable chronyd && systemctl start chronyd"),
        create_control("2.1.2", "Ensure chrony is configured", "2.1 Configure Time Synchronization", "Level1", True, "FileContent",
                      file_path="/etc/chrony.conf", pattern="^(server|pool)", expected_result="found",
                      description="chrony is a daemon which implements the Network Time Protocol (NTP). It is designed to synchronize system clocks across a variety of systems and use a variety of mechanisms.",
                      remediation="Edit /etc/chrony.conf and add one or more time servers: server <remote-server>"),
        create_control("2.1.3", "Ensure chrony is not run as the root user", "2.1 Configure Time Synchronization", "Level1", True, "FileContent",
                      file_path="/etc/chrony.conf", pattern="^user", expected_result="found",
                      description="Running chrony as a non-privileged user reduces the impact of a potential security vulnerability in the chrony daemon.",
                      remediation="Edit /etc/chrony.conf and add: user _chrony"),
    ]
    return create_milestone("2.1", "2 Services", "Section 2.1 Configure Time Synchronization", controls)

# Section 2.2 - Configure Special Purpose Services
def milestone_2_2():
    controls = [
        create_control("2.2.1", "Ensure autofs services are not in use", "2.2 Configure Special Purpose Services", "Level2", True, "ServiceStatus",
                      service_name="autofs", expected_status="disabled",
                      description="autofs allows automatic mounting of devices, typically including CD/DVDs and USB drives. With automounting enabled anyone with physical access could attach a USB drive or disc and have its contents available in system even if they lacked permissions to mount it themselves.",
                      remediation="Run the following commands to stop autofs.service and remove autofs package: # systemctl stop autofs.service && yum remove autofs"),
        create_control("2.2.2", "Ensure avahi daemon services are not in use", "2.2 Configure Special Purpose Services", "Level2", True, "ServiceStatus",
                      service_name="avahi-daemon", expected_status="disabled",
                      description="Avahi is a free zeroconf implementation, including a system for multicast DNS/DNS-SD service discovery. Automatic discovery of network services is not normally required for system functionality.",
                      remediation="Run the following commands to stop avahi-daemon.socket avahi-daemon.service, and remove the avahi package: # systemctl stop avahi-daemon.socket avahi-daemon.service && yum remove avahi"),
        create_control("2.2.3", "Ensure dhcp server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="dhcpd", expected_status="disabled",
                      description="The Dynamic Host Configuration Protocol (DHCP) is a service that allows machines to be dynamically assigned IP addresses. Unless a system is specifically set up to act as a DHCP server, it is recommended that the dhcp-server package be removed.",
                      remediation="Run the following commands to stop dhcpd.service and dhcpd6.service and remove dhcp-server package: # systemctl stop dhcpd.service dhcpd6.service && yum remove dhcp-server"),
        create_control("2.2.4", "Ensure dns server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="named", expected_status="disabled",
                      description="The Domain Name System (DNS) is a hierarchical naming system that maps names to IP addresses for computers, services and other resources connected to a network. Unless a system is specifically designated to act as a DNS server, it is recommended that the package be removed.",
                      remediation="Run the following commands to stop named.service and remove bind package: # systemctl stop named.service && yum remove bind"),
        create_control("2.2.5", "Ensure dnsmasq services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="dnsmasq", expected_status="disabled",
                      description="dnsmasq is a lightweight tool that provides DNS caching, DNS forwarding and DHCP (Dynamic Host Configuration Protocol) services. Unless a system is specifically designated to act as a DNS caching, DNS forwarding and/or DHCP server, it is recommended that the package be removed.",
                      remediation="Run the following commands to stop dnsmasq.service and remove dnsmasq package: # systemctl stop dnsmasq.service && yum remove dnsmasq"),
        create_control("2.2.6", "Ensure samba file server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="smb", expected_status="disabled",
                      description="The Samba daemon allows system administrators to configure their Linux systems to share file systems and directories with Windows desktops. If there is no need to mount directories and file systems to Windows systems, then this package can be removed.",
                      remediation="Run the following command to stop smb.service and remove samba package: # systemctl stop smb.service && yum remove samba"),
        create_control("2.2.7", "Ensure ftp server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="vsftpd", expected_status="disabled",
                      description="FTP (File Transfer Protocol) is a traditional and widely used standard tool for transferring files between a server and clients over a network. Unless there is a need to run the system as a FTP server, it is recommended that the package be removed.",
                      remediation="Run the following commands to stop vsftpd.service and remove vsftpd package: # systemctl stop vsftpd.service && yum remove vsftpd"),
        create_control("2.2.8", "Ensure message access server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="dovecot", expected_status="disabled",
                      description="dovecot and cyrus-imapd are open source IMAP and POP3 server packages for Linux based systems. Unless POP3 and/or IMAP servers are to be provided by this system, it is recommended that the package be removed.",
                      remediation="Run the following commands to stop dovecot.socket dovecot.service, and remove dovecot cyrus-imapd packages: # systemctl stop dovecot.socket dovecot.service && yum remove dovecot cyrus-imapd"),
        create_control("2.2.9", "Ensure network file system services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="nfs-server", expected_status="disabled",
                      description="The Network File System (NFS) is one of the first and most widely distributed file systems in the UNIX environment. If the system does not require access to network shares or the ability to provide network file system services for other host's network shares, it is recommended that the nfs-utils package be removed.",
                      remediation="Run the following command to stop nfs-server.service and remove nfs-utils package: # systemctl stop nfs-server.service && yum remove nfs-utils"),
        create_control("2.2.10", "Ensure nis server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="ypserv", expected_status="disabled",
                      description="The Network Information Service (NIS) is a client-server directory service protocol used to distribute system configuration files. The NIS service is inherently an insecure system that has been vulnerable to DOS attacks, buffer overflows and has poor authentication.",
                      remediation="Run the following commands to stop ypserv.service and remove ypserv package: # systemctl stop ypserv.service && yum remove ypserv"),
        create_control("2.2.11", "Ensure print server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="cups", expected_status="disabled",
                      description="The Common Unix Print System (CUPS) provides the ability to print to both local and network printers. If the system does not need to print jobs or accept print jobs from other systems, it is recommended that CUPS be removed.",
                      remediation="Run the following commands to stop cups.socket cups.service, and remove the cups package: # systemctl stop cups.socket cups.service && yum remove cups"),
        create_control("2.2.12", "Ensure rpcbind services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="rpcbind", expected_status="disabled",
                      description="The rpcbind utility maps RPC services to the ports on which they listen. A small request sent to the Portmapper generates a large response, which makes it a suitable tool for DDoS attacks.",
                      remediation="Run the following commands to stop rpcbind.socket rpcbind.service, and remove the rpcbind package: # systemctl stop rpcbind.socket rpcbind.service && yum remove rpcbind"),
        create_control("2.2.13", "Ensure rsync services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="rsyncd", expected_status="disabled",
                      description="The rsyncd.service can be used to synchronize files between systems over network links. Unless required, the rsync-daemon package should be removed to reduce the potential attack surface.",
                      remediation="Run the following commands to stop rsyncd.socket rsyncd.service, and remove the rsync-daemon package: # systemctl stop rsyncd.socket rsyncd.service && yum remove rsync-daemon"),
        create_control("2.2.14", "Ensure snmp services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="snmpd", expected_status="disabled",
                      description="Simple Network Management Protocol (SNMP) is a widely used protocol for monitoring the health and welfare of network equipment. If the SNMP service is not required, the net-snmp package should be removed.",
                      remediation="Run the following commands to stop snmpd.service and remove net-snmp package: # systemctl stop snmpd.service && yum remove net-snmp"),
        create_control("2.2.15", "Ensure telnet server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="telnet", expected_status="disabled",
                      description="The telnet-server package contains the telnet daemon, which accepts connections from users from other systems via the telnet protocol. The telnet protocol is insecure and unencrypted.",
                      remediation="Run the following commands to stop telnet.socket and remove the telnet-server package: # systemctl stop telnet.socket && yum remove telnet-server"),
        create_control("2.2.16", "Ensure tftp server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="tftp", expected_status="disabled",
                      description="Trivial File Transfer Protocol (TFTP) is a simple protocol for exchanging files between two TCP/IP machines. Unless there is a need to run the system as a TFTP server, it is recommended that the package be removed.",
                      remediation="Run the following commands to stop tftp.socket tftp.service, and remove the tftp-server package: # systemctl stop tftp.socket tftp.service && yum remove tftp-server"),
        create_control("2.2.17", "Ensure web proxy server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="squid", expected_status="disabled",
                      description="Squid is a standard proxy server used in many distributions and environments. Unless a system is specifically set up to act as a proxy server, it is recommended that the squid package be removed.",
                      remediation="Run the following commands to stop squid.service and remove the squid package: # systemctl stop squid.service && yum remove squid"),
        create_control("2.2.18", "Ensure web server services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="httpd", expected_status="disabled",
                      description="Web servers provide the ability to host web site content. Unless there is a local site approved requirement to run a web server service on the system, web server packages should be removed.",
                      remediation="Run the following commands to stop httpd.socket httpd.service, and remove httpd nginx packages: # systemctl stop httpd.socket httpd.service && yum remove httpd nginx"),
        create_control("2.2.19", "Ensure xinetd services are not in use", "2.2 Configure Special Purpose Services", "Level1", True, "ServiceStatus",
                      service_name="xinetd", expected_status="disabled",
                      description="The eXtended InterNET Daemon (xinetd) is an open source super daemon that replaced the original inetd daemon. If there are no xinetd services required, it is recommended that the package be removed.",
                      remediation="Run the following commands to stop xinetd.service, and remove the xinetd package: # systemctl stop xinetd.service && yum remove xinetd"),
        create_control("2.2.20", "Ensure X window server services are not in use", "2.2 Configure Special Purpose Services", "Level2", True, "PackageNotInstalled",
                      package_name="xorg-x11-server-common", expected_status="not_installed",
                      description="The X Window System provides a Graphical User Interface (GUI) where users can have multiple windows in which to run programs. Unless your organization specifically requires graphical login access via X Windows, remove it.",
                      remediation="Run the following command to remove the X Windows Server packages: # yum remove xorg-x11-server-common"),
        create_control("2.2.21", "Ensure mail transfer agents are configured for local-only mode", "2.2 Configure Special Purpose Services", "Level1", True, "FileContent",
                      file_path="/etc/postfix/main.cf", pattern="^inet_interfaces\\s*=\\s*localhost", expected_result="found",
                      description="Mail Transfer Agents (MTA), such as sendmail and Postfix, are used to listen for incoming mail and transfer the messages to the appropriate user or mail server. If the system is not intended to be a mail server, it is recommended that the MTA be configured to only process local mail.",
                      remediation="Edit /etc/postfix/main.cf and add the following line: inet_interfaces = localhost"),
        create_control("2.2.22", "Ensure only approved services are listening on a network interface", "2.2 Configure Special Purpose Services", "Level1", False, "Manual",
                      description="Services listening on network interfaces provide potential attack vectors. It is important to ensure that only approved services are listening on network interfaces.",
                      remediation="Review the output of 'netstat -tuln' or 'ss -tuln' and ensure that only approved services are listening on network interfaces."),
    ]
    return create_milestone("2.2", "2 Services", "Section 2.2 Configure Special Purpose Services", controls)

# Section 2.3 - Configure Service Clients
def milestone_2_3():
    controls = [
        create_control("2.3.1", "Ensure ftp client is not installed", "2.3 Configure Service Clients", "Level1", True, "PackageNotInstalled",
                      package_name="ftp", expected_status="not_installed",
                      description="The ftp package provides the client programs for initiating FTP sessions to remote systems. The ftp protocol is insecure and unencrypted.",
                      remediation="Run the following command to remove the ftp package: # yum remove ftp"),
        create_control("2.3.2", "Ensure ldap client is not installed", "2.3 Configure Service Clients", "Level1", True, "PackageNotInstalled",
                      package_name="openldap-clients", expected_status="not_installed",
                      description="The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP. It is a service that provides a method for looking up information from a central database.",
                      remediation="Run the following command to remove the openldap-clients package: # yum remove openldap-clients"),
        create_control("2.3.3", "Ensure nis client is not installed", "2.3 Configure Service Clients", "Level1", True, "PackageNotInstalled",
                      package_name="ypbind", expected_status="not_installed",
                      description="The Network Information Service (NIS) is a client-server directory service protocol used to distribute system configuration files. The NIS service is inherently an insecure system.",
                      remediation="Run the following command to remove the ypbind package: # yum remove ypbind"),
        create_control("2.3.4", "Ensure telnet client is not installed", "2.3 Configure Service Clients", "Level1", True, "PackageNotInstalled",
                      package_name="telnet", expected_status="not_installed",
                      description="The telnet package contains the telnet client, which allows users to start connections to other systems via the telnet protocol. The telnet protocol is insecure and unencrypted.",
                      remediation="Run the following command to remove the telnet package: # yum remove telnet"),
        create_control("2.3.5", "Ensure tftp client is not installed", "2.3 Configure Service Clients", "Level1", True, "PackageNotInstalled",
                      package_name="tftp", expected_status="not_installed",
                      description="Trivial File Transfer Protocol (TFTP) is a simple protocol for exchanging files between two TCP/IP machines. TFTP does not have built-in encryption, access control or authentication.",
                      remediation="Run the following command to remove the tftp package: # yum remove tftp"),
    ]
    return create_milestone("2.3", "2 Services", "Section 2.3 Configure Service Clients", controls)

# Section 3.1 - Configure Network Devices
def milestone_3_1():
    controls = [
        create_control("3.1.1", "Ensure IPv6 status is identified", "3.1 Configure Network Devices", "Level1", False, "Manual",
                      description="Internet Protocol Version 6 (IPv6) is the most recent version of Internet Protocol (IP). It is recommended that IPv6 be enabled and configured in accordance with Benchmark recommendations.",
                      remediation="Enable or disable IPv6 in accordance with system requirements and local site policy"),
        create_control("3.1.2", "Ensure wireless interfaces are disabled", "3.1 Configure Network Devices", "Level1", True, "CommandOutputEmpty",
                      audit_command="find /sys/class/net/*/ -type d -name wireless",
                      description="Wireless networking is used when wired networks are unavailable. If wireless is not to be used, wireless devices can be disabled to reduce the potential attack surface.",
                      remediation="Run the following script to disable any wireless interfaces: # for driverdir in $(find /sys/class/net/*/ -type d -name wireless); do l_dname=$(basename $(dirname $driverdir)); echo \"install $l_dname /bin/false\" >> /etc/modprobe.d/disable-wireless.conf; done"),
        create_control("3.1.3", "Ensure bluetooth services are not in use", "3.1 Configure Network Devices", "Level2", True, "ServiceStatus",
                      service_name="bluetooth", expected_status="disabled",
                      description="Bluetooth is a short-range wireless technology standard that is used for exchanging data between devices over short distances. An attacker may be able to find a way to access or corrupt your data.",
                      remediation="Run the following commands to stop bluetooth.service, and remove the bluez package: # systemctl stop bluetooth.service && yum remove bluez"),
    ]
    return create_milestone("3.1", "3 Network", "Section 3.1 Configure Network Devices", controls)

# Section 3.2 - Configure Network Kernel Modules
def milestone_3_2():
    controls = [
        create_control("3.2.1", "Ensure dccp kernel module is not available", "3.2 Configure Network Kernel Modules", "Level1", True, "KernelModule",
                      module_name="dccp", expected_status="not_available",
                      description="The Datagram Congestion Control Protocol (DCCP) is a transport layer protocol that supports streaming media and telephony. Removing support for unneeded protocols reduces the local attack surface of the system.",
                      remediation="Run the following commands to unload and disable the dccp kernel module: # modprobe -r dccp && printf 'install dccp /bin/false\\n' >> /etc/modprobe.d/60-dccp.conf && printf 'blacklist dccp\\n' >> /etc/modprobe.d/60-dccp.conf"),
        create_control("3.2.2", "Ensure tipc kernel module is not available", "3.2 Configure Network Kernel Modules", "Level1", True, "KernelModule",
                      module_name="tipc", expected_status="not_available",
                      description="The Transparent Inter-Process Communication (TIPC) protocol is designed to provide communication between cluster nodes. Removing support for unneeded protocols reduces the local attack surface of the system.",
                      remediation="Run the following commands to unload and disable the tipc kernel module: # modprobe -r tipc && printf 'install tipc /bin/false\\n' >> /etc/modprobe.d/60-tipc.conf && printf 'blacklist tipc\\n' >> /etc/modprobe.d/60-tipc.conf"),
        create_control("3.2.3", "Ensure rds kernel module is not available", "3.2 Configure Network Kernel Modules", "Level1", True, "KernelModule",
                      module_name="rds", expected_status="not_available",
                      description="The Reliable Datagram Sockets (RDS) protocol is a transport layer protocol designed to provide low-latency, high-bandwidth communications between cluster nodes. Removing support for unneeded protocols reduces the local attack surface of the system.",
                      remediation="Run the following commands to unload and disable the rds kernel module: # modprobe -r rds && printf 'install rds /bin/false\\n' >> /etc/modprobe.d/60-rds.conf && printf 'blacklist rds\\n' >> /etc/modprobe.d/60-rds.conf"),
        create_control("3.2.4", "Ensure sctp kernel module is not available", "3.2 Configure Network Kernel Modules", "Level1", True, "KernelModule",
                      module_name="sctp", expected_status="not_available",
                      description="The Stream Control Transmission Protocol (SCTP) is a transport layer protocol used to support message oriented communication, with several streams of messages in one connection. Removing support for unneeded protocols reduces the local attack surface of the system.",
                      remediation="Run the following commands to unload and disable the sctp kernel module: # modprobe -r sctp && printf 'install sctp /bin/false\\n' >> /etc/modprobe.d/60-sctp.conf && printf 'blacklist sctp\\n' >> /etc/modprobe.d/60-sctp.conf"),
    ]
    return create_milestone("3.2", "3 Network", "Section 3.2 Configure Network Kernel Modules", controls)

# Section 3.3 - Configure Network Kernel Parameters
def milestone_3_3():
    controls = [
        create_control("3.3.1", "Ensure ip forwarding is disabled", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.ip_forward", expected_value="0",
                      description="IP forwarding permits the kernel to forward packets from one network interface to another. The ability to forward packets between two networks is only appropriate for systems acting as routers.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.ip_forward = 0"),
        create_control("3.3.2", "Ensure packet redirect sending is disabled", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.conf.all.send_redirects", expected_value="0",
                      description="ICMP redirects are used to send routing information to other hosts. As a host itself does not act as a router, there is no need to send redirects.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.send_redirects = 0"),
        create_control("3.3.3", "Ensure bogus icmp responses are ignored", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.icmp_ignore_bogus_error_responses", expected_value="1",
                      description="Ignoring bogus ICMP error responses reduces log size, although some activity would not be logged.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.icmp_ignore_bogus_error_responses = 1"),
        create_control("3.3.4", "Ensure broadcast icmp requests are ignored", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.icmp_echo_ignore_broadcasts", expected_value="1",
                      description="Accepting ICMP echo and timestamp requests with broadcast or multicast destinations for your network could be used to trick your host into starting (or participating) in a Smurf attack.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.icmp_echo_ignore_broadcasts = 1"),
        create_control("3.3.5", "Ensure icmp redirects are not accepted", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.conf.all.accept_redirects", expected_value="0",
                      description="ICMP redirect messages are used by routers to inform hosts that a more direct route exists for a particular destination. These messages contain unauthenticated data and could potentially be used to lure a host into sending traffic to an attacker controlled destination.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.accept_redirects = 0"),
        create_control("3.3.6", "Ensure secure icmp redirects are not accepted", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.conf.all.secure_redirects", expected_value="0",
                      description="Accepting secure ICMP redirects (from those gateways listed as default gateways) has few legitimate uses. It should be disabled unless it is absolutely required.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.secure_redirects = 0"),
        create_control("3.3.7", "Ensure reverse path filtering is enabled", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.conf.all.rp_filter", expected_value="1",
                      description="Reverse Path Filtering protects against IP spoofing by ensuring packets are only accepted if the system would route a response packet back to the source through the same interface.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.rp_filter = 1"),
        create_control("3.3.8", "Ensure source routed packets are not accepted", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.conf.all.accept_source_route", expected_value="0",
                      description="Source routed packets allow the sender to partially or completely specify the route packets take through the network. Accepting source routed packets can make the system vulnerable to attacks.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.accept_source_route = 0"),
        create_control("3.3.9", "Ensure suspicious packets are logged", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.conf.all.log_martians", expected_value="1",
                      description="When enabled, the system logs packets with un-routable source addresses to the kernel log. This helps detect potential attacks or misconfigurations.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.conf.all.log_martians = 1"),
        create_control("3.3.10", "Ensure tcp syn cookies is enabled", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv4.tcp_syncookies", expected_value="1",
                      description="TCP SYN cookies help protect against SYN flood attacks by enabling the system to continue responding to legitimate traffic even when under attack.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv4.tcp_syncookies = 1"),
        create_control("3.3.11", "Ensure ipv6 router advertisements are not accepted", "3.3 Configure Network Kernel Parameters", "Level1", True, "SysctlParameter",
                      parameter_name="net.ipv6.conf.all.accept_ra", expected_value="0",
                      description="Router advertisements can be used to configure IPv6 clients. Disabling acceptance of router advertisements helps prevent unauthorized network configuration.",
                      remediation="Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: net.ipv6.conf.all.accept_ra = 0"),
    ]
    return create_milestone("3.3", "3 Network", "Section 3.3 Configure Network Kernel Parameters", controls)

# Section 3.4 - Configure Host Based Firewall
def milestone_3_4():
    controls = [
        # 3.4.1 Configure firewall utility
        create_control("3.4.1.1", "Ensure iptables is installed", "3.4.1 Configure firewall utility", "Level1", True, "PackageInstalled",
                      package_name="iptables", expected_status="installed",
                      description="iptables is a utility program that allows a system administrator to configure the tables provided by the Linux kernel firewall.",
                      remediation="Run the following command to install iptables: # yum install iptables"),
        create_control("3.4.1.2", "Ensure a single firewall configuration utility is in use", "3.4.1 Configure firewall utility", "Level1", True, "ServiceStatus",
                      service_name="firewalld", expected_status="enabled",
                      description="Only one firewall configuration utility should be in use to avoid conflicts. firewalld, nftables, or iptables should be chosen based on site policy.",
                      remediation="Choose one firewall utility (firewalld, nftables, or iptables) and ensure only that one is installed and enabled."),
        # 3.4.2 Configure firewalld
        create_control("3.4.2.1", "Ensure firewalld is installed", "3.4.2 Configure firewalld", "Level1", True, "PackageInstalled",
                      package_name="firewalld", expected_status="installed",
                      description="firewalld is a firewall management daemon for Linux systems. It provides a way to configure the system to accept, reject, or forward network connections.",
                      remediation="Run the following command to install firewalld: # yum install firewalld"),
        create_control("3.4.2.2", "Ensure firewalld service enabled and running", "3.4.2 Configure firewalld", "Level1", True, "ServiceStatus",
                      service_name="firewalld", expected_status="enabled",
                      description="The firewalld service must be enabled and running to provide firewall protection for the system.",
                      remediation="Run the following commands to enable and start firewalld: # systemctl enable firewalld && systemctl start firewalld"),
        create_control("3.4.2.3", "Ensure firewalld drops unnecessary services and ports", "3.4.2 Configure firewalld", "Level1", False, "Manual",
                      description="Only necessary services and ports should be allowed through the firewall.",
                      remediation="Review firewall rules: # firewall-cmd --list-all. Remove unnecessary services and ports."),
        create_control("3.4.2.4", "Ensure network interfaces are assigned to appropriate zone", "3.4.2 Configure firewalld", "Level1", False, "Manual",
                      description="Network interfaces should be assigned to appropriate firewalld zones based on their trust level.",
                      remediation="Run: # firewall-cmd --get-active-zones. Assign interfaces to zones: # firewall-cmd --zone=<zone> --change-interface=<interface>"),
        # 3.4.3 Configure nftables
        create_control("3.4.3.1", "Ensure nftables is installed", "3.4.3 Configure nftables", "Level1", True, "PackageInstalled",
                      package_name="nftables", expected_status="installed",
                      description="nftables is a subsystem of the Linux kernel providing filtering and classification of network packets.",
                      remediation="Run the following command to install nftables: # yum install nftables"),
        create_control("3.4.3.2", "Ensure iptables are flushed with nftables", "3.4.3 Configure nftables", "Level1", False, "Manual",
                      description="When using nftables, iptables rules should be flushed to avoid conflicts.",
                      remediation="Run: # iptables -F && # ip6tables -F && # iptables -X && # ip6tables -X"),
        create_control("3.4.3.3", "Ensure an nftables table exists", "3.4.3 Configure nftables", "Level1", True, "CommandOutputEmpty",
                      audit_command="nft list tables",
                      description="nftables requires at least one table to be defined.",
                      remediation="Create a table: # nft create table inet filter"),
        create_control("3.4.3.4", "Ensure nftables base chains exist", "3.4.3 Configure nftables", "Level1", True, "CommandOutputEmpty",
                      audit_command="nft list chains",
                      description="nftables requires base chains for input, forward, and output.",
                      remediation="Create base chains: # nft create chain inet filter input { type filter hook input priority 0 \\; }"),
        create_control("3.4.3.5", "Ensure nftables loopback traffic is configured", "3.4.3 Configure nftables", "Level1", True, "FileContent",
                      file_path="/etc/nftables.conf", pattern="iif.*lo.*accept|iif.*loopback.*accept", expected_result="found",
                      description="Loopback traffic should be allowed.",
                      remediation="Add rule to nftables configuration: iif lo accept"),
        create_control("3.4.3.6", "Ensure nftables outbound and established connections are configured", "3.4.3 Configure nftables", "Level1", False, "Manual",
                      description="Outbound and established connections should be allowed.",
                      remediation="Configure nftables rules to allow outbound and established connections."),
        create_control("3.4.3.7", "Ensure nftables default deny firewall policy", "3.4.3 Configure nftables", "Level1", True, "FileContent",
                      file_path="/etc/nftables.conf", pattern="policy.*drop|policy.*deny", expected_result="found",
                      description="The default firewall policy should be deny/drop.",
                      remediation="Set default policy: # nft chain inet filter input { policy drop \\; }"),
        create_control("3.4.3.8", "Ensure nftables service is enabled and active", "3.4.3 Configure nftables", "Level1", True, "ServiceStatus",
                      service_name="nftables", expected_status="enabled",
                      description="The nftables service must be enabled and running.",
                      remediation="Run: # systemctl enable nftables && systemctl start nftables"),
        create_control("3.4.3.9", "Ensure nftables rules are permanent", "3.4.3 Configure nftables", "Level1", True, "FileExists",
                      file_path="/etc/nftables.conf", expected_status="exists",
                      description="nftables rules should be saved to a configuration file to persist across reboots.",
                      remediation="Save rules: # nft list ruleset > /etc/nftables.conf"),
        # 3.4.4 Configure iptables
        create_control("3.4.4.1.1", "Ensure iptables packages are installed", "3.4.4.1 Configure iptables software", "Level1", True, "PackageInstalled",
                      package_name="iptables", expected_status="installed",
                      description="iptables is a utility program that allows a system administrator to configure the tables provided by the Linux kernel firewall.",
                      remediation="Run the following command to install iptables: # yum install iptables iptables-services"),
        create_control("3.4.4.2.1", "Ensure iptables loopback traffic is configured", "3.4.4.2 Configure iptables", "Level1", True, "FileContent",
                      file_path="/etc/sysconfig/iptables", pattern="-A INPUT -i lo -j ACCEPT", expected_result="found",
                      description="Loopback traffic should be allowed.",
                      remediation="Add rule: -A INPUT -i lo -j ACCEPT"),
        create_control("3.4.4.2.2", "Ensure iptables outbound and established connections are configured", "3.4.4.2 Configure iptables", "Level1", False, "Manual",
                      description="Outbound and established connections should be allowed.",
                      remediation="Configure iptables rules to allow outbound and established connections."),
        create_control("3.4.4.2.3", "Ensure iptables rules exist for all open ports", "3.4.4.2 Configure iptables", "Level1", True, "FileContent",
                      file_path="/etc/sysconfig/iptables", pattern="-A INPUT.*-p.*--dport", expected_result="found",
                      description="Firewall rules should exist for all open ports.",
                      remediation="Add iptables rules for all open ports."),
        create_control("3.4.4.2.4", "Ensure iptables default deny firewall policy", "3.4.4.2 Configure iptables", "Level1", True, "FileContent",
                      file_path="/etc/sysconfig/iptables", pattern="-P INPUT DROP|-P FORWARD DROP", expected_result="found",
                      description="The default firewall policy should be deny/drop.",
                      remediation="Set default policies: -P INPUT DROP -P FORWARD DROP -P OUTPUT ACCEPT"),
        create_control("3.4.4.2.5", "Ensure iptables rules are saved", "3.4.4.2 Configure iptables", "Level1", True, "FileExists",
                      file_path="/etc/sysconfig/iptables", expected_status="exists",
                      description="iptables rules should be saved to persist across reboots.",
                      remediation="Save rules: # service iptables save or # iptables-save > /etc/sysconfig/iptables"),
        create_control("3.4.4.2.6", "Ensure iptables service is enabled and active", "3.4.4.2 Configure iptables", "Level1", True, "ServiceStatus",
                      service_name="iptables", expected_status="enabled",
                      description="The iptables service must be enabled and running.",
                      remediation="Run: # systemctl enable iptables && systemctl start iptables"),
        create_control("3.4.4.3.1", "Ensure ip6tables loopback traffic is configured", "3.4.4.3 Configure ip6tables", "Level1", True, "FileContent",
                      file_path="/etc/sysconfig/ip6tables", pattern="-A INPUT -i lo -j ACCEPT", expected_result="found",
                      description="Loopback traffic should be allowed for IPv6.",
                      remediation="Add rule: -A INPUT -i lo -j ACCEPT"),
        create_control("3.4.4.3.2", "Ensure ip6tables outbound and established connections are configured", "3.4.4.3 Configure ip6tables", "Level1", False, "Manual",
                      description="Outbound and established connections should be allowed for IPv6.",
                      remediation="Configure ip6tables rules to allow outbound and established connections."),
        create_control("3.4.4.3.3", "Ensure ip6tables firewall rules exist for all open ports", "3.4.4.3 Configure ip6tables", "Level1", True, "FileContent",
                      file_path="/etc/sysconfig/ip6tables", pattern="-A INPUT.*-p.*--dport", expected_result="found",
                      description="Firewall rules should exist for all open IPv6 ports.",
                      remediation="Add ip6tables rules for all open ports."),
        create_control("3.4.4.3.4", "Ensure ip6tables default deny firewall policy", "3.4.4.3 Configure ip6tables", "Level1", True, "FileContent",
                      file_path="/etc/sysconfig/ip6tables", pattern="-P INPUT DROP|-P FORWARD DROP", expected_result="found",
                      description="The default IPv6 firewall policy should be deny/drop.",
                      remediation="Set default policies: -P INPUT DROP -P FORWARD DROP -P OUTPUT ACCEPT"),
        create_control("3.4.4.3.5", "Ensure ip6tables rules are saved", "3.4.4.3 Configure ip6tables", "Level1", True, "FileExists",
                      file_path="/etc/sysconfig/ip6tables", expected_status="exists",
                      description="ip6tables rules should be saved to persist across reboots.",
                      remediation="Save rules: # service ip6tables save or # ip6tables-save > /etc/sysconfig/ip6tables"),
        create_control("3.4.4.3.6", "Ensure ip6tables is enabled and active", "3.4.4.3 Configure ip6tables", "Level1", True, "ServiceStatus",
                      service_name="ip6tables", expected_status="enabled",
                      description="The ip6tables service must be enabled and running.",
                      remediation="Run: # systemctl enable ip6tables && systemctl start ip6tables"),
    ]
    return create_milestone("3.4", "3 Network", "Section 3.4 Configure Host Based Firewall", controls)

# Section 4.1 - Configure job schedulers
def milestone_4_1():
    controls = [
        create_control("4.1.1.1", "Ensure cron daemon is enabled and active", "4.1.1 Configure cron", "Level1", True, "ServiceStatus",
                      service_name="crond", expected_status="enabled",
                      description="The cron daemon is used to execute scheduled commands. It should be enabled to support automated system maintenance.",
                      remediation="Run the following command to enable and start crond: # systemctl --now enable crond"),
        create_control("4.1.1.2", "Ensure permissions on /etc/crontab are configured", "4.1.1 Configure cron", "Level1", True, "FilePermissions",
                      file_path="/etc/crontab", expected_permissions="0600", expected_owner="root", expected_group="root",
                      description="The /etc/crontab file contains system-wide cron jobs. It should be protected from unauthorized modification.",
                      remediation="Run: chmod 600 /etc/crontab && chown root:root /etc/crontab"),
        create_control("4.1.1.3", "Ensure permissions on /etc/cron.hourly are configured", "4.1.1 Configure cron", "Level1", True, "FilePermissions",
                      file_path="/etc/cron.hourly", expected_permissions="0700", expected_owner="root", expected_group="root",
                      description="The /etc/cron.hourly directory contains scripts that are executed hourly. It should be protected from unauthorized modification.",
                      remediation="Run: chmod 700 /etc/cron.hourly && chown root:root /etc/cron.hourly"),
        create_control("4.1.1.4", "Ensure permissions on /etc/cron.daily are configured", "4.1.1 Configure cron", "Level1", True, "FilePermissions",
                      file_path="/etc/cron.daily", expected_permissions="0700", expected_owner="root", expected_group="root",
                      description="The /etc/cron.daily directory contains scripts that are executed daily. It should be protected from unauthorized modification.",
                      remediation="Run: chmod 700 /etc/cron.daily && chown root:root /etc/cron.daily"),
        create_control("4.1.1.5", "Ensure permissions on /etc/cron.weekly are configured", "4.1.1 Configure cron", "Level1", True, "FilePermissions",
                      file_path="/etc/cron.weekly", expected_permissions="0700", expected_owner="root", expected_group="root",
                      description="The /etc/cron.weekly directory contains scripts that are executed weekly. It should be protected from unauthorized modification.",
                      remediation="Run: chmod 700 /etc/cron.weekly && chown root:root /etc/cron.weekly"),
        create_control("4.1.1.6", "Ensure permissions on /etc/cron.monthly are configured", "4.1.1 Configure cron", "Level1", True, "FilePermissions",
                      file_path="/etc/cron.monthly", expected_permissions="0700", expected_owner="root", expected_group="root",
                      description="The /etc/cron.monthly directory contains scripts that are executed monthly. It should be protected from unauthorized modification.",
                      remediation="Run: chmod 700 /etc/cron.monthly && chown root:root /etc/cron.monthly"),
        create_control("4.1.1.7", "Ensure permissions on /etc/cron.d are configured", "4.1.1 Configure cron", "Level1", True, "FilePermissions",
                      file_path="/etc/cron.d", expected_permissions="0700", expected_owner="root", expected_group="root",
                      description="The /etc/cron.d directory contains additional cron job files. It should be protected from unauthorized modification.",
                      remediation="Run: chmod 700 /etc/cron.d && chown root:root /etc/cron.d"),
        create_control("4.1.1.8", "Ensure crontab is restricted to authorized users", "4.1.1 Configure cron", "Level1", True, "FileExists",
                      file_path="/etc/cron.deny", expected_status="not_exists",
                      description="Restricting access to crontab helps prevent unauthorized users from scheduling jobs.",
                      remediation="Remove /etc/cron.deny if it exists. Ensure /etc/cron.allow exists and contains only authorized users."),
        create_control("4.1.2.1", "Ensure at is restricted to authorized users", "4.1.2 Configure at", "Level1", True, "FileExists",
                      file_path="/etc/at.deny", expected_status="not_exists",
                      description="Restricting access to the at command helps prevent unauthorized users from scheduling jobs.",
                      remediation="Remove /etc/at.deny if it exists. Ensure /etc/at.allow exists and contains only authorized users."),
    ]
    return create_milestone("4.1", "4 Access, Authentication and Authorization", "Section 4.1 Configure job schedulers", controls)

# Section 4.2 - Configure SSH Server
def milestone_4_2():
    controls = [
        create_control("4.2.1", "Ensure permissions on /etc/ssh/sshd_config are configured", "4.2 Configure SSH Server", "Level1", True, "FilePermissions",
                      file_path="/etc/ssh/sshd_config", expected_permissions="0600", expected_owner="root", expected_group="root",
                      description="The sshd_config file contains configuration specifications for sshd. The file needs to be protected from unauthorized changes.",
                      remediation="Run: chown root:root /etc/ssh/sshd_config && chmod 0600 /etc/ssh/sshd_config"),
        create_control("4.2.2", "Ensure permissions on SSH private host key files are configured", "4.2 Configure SSH Server", "Level1", True, "FilePermissions",
                      file_path="/etc/ssh/ssh_host_*_key", expected_permissions="0600", expected_owner="root", expected_group="root",
                      description="SSH private keys should be protected from unauthorized access.",
                      remediation="Run: find /etc/ssh -xdev -type f -name 'ssh_host_*_key' -exec chmod u-x,go-rwx {} \\; && find /etc/ssh -xdev -type f -name 'ssh_host_*_key' -exec chown root:root {} \\;"),
        create_control("4.2.3", "Ensure permissions on SSH public host key files are configured", "4.2 Configure SSH Server", "Level1", True, "FilePermissions",
                      file_path="/etc/ssh/ssh_host_*_key.pub", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="SSH public keys should be world-readable.",
                      remediation="Run: find /etc/ssh -xdev -type f -name 'ssh_host_*_key.pub' -exec chmod u-x,go-wx {} \\; && find /etc/ssh -xdev -type f -name 'ssh_host_*_key.pub' -exec chown root:root {} \\;"),
        create_control("4.2.4", "Ensure sshd access is configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="AllowUsers", expected_value="configured",
                      description="Configure AllowUsers, AllowGroups, DenyUsers, DenyGroups in sshd_config to restrict access.",
                      remediation="Edit /etc/ssh/sshd_config and configure access restrictions: AllowUsers <user_list> or AllowGroups <group_list>"),
        create_control("4.2.5", "Ensure sshd Banner is configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="Banner", expected_value="/etc/issue.net",
                      description="Banners are used to warn connecting users of the particular site's policy regarding connection.",
                      remediation="Edit /etc/ssh/sshd_config and set Banner /etc/issue.net"),
        create_control("4.2.6", "Ensure sshd Ciphers are configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="Ciphers", expected_value="strong",
                      description="Weak ciphers should not be used. Only strong ciphers should be allowed.",
                      remediation="Edit /etc/ssh/sshd_config and configure strong ciphers: Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr"),
        create_control("4.2.7", "Ensure sshd ClientAliveInterval and ClientAliveCountMax are configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="ClientAliveInterval", expected_value="300",
                      description="Idle SSH sessions should timeout after a period of inactivity.",
                      remediation="Edit /etc/ssh/sshd_config: ClientAliveInterval 300, ClientAliveCountMax 0"),
        create_control("4.2.8", "Ensure sshd DisableForwarding is enabled", "4.2 Configure SSH Server", "Level2", True, "SSHConfig",
                      parameter="DisableForwarding", expected_value="yes",
                      description="SSH port forwarding should be disabled unless required.",
                      remediation="Edit /etc/ssh/sshd_config and set DisableForwarding yes"),
        create_control("4.2.9", "Ensure sshd GSSAPIAuthentication is disabled", "4.2 Configure SSH Server", "Level2", True, "SSHConfig",
                      parameter="GSSAPIAuthentication", expected_value="no",
                      description="GSSAPI authentication should be disabled to reduce the attack surface.",
                      remediation="Edit /etc/ssh/sshd_config and set GSSAPIAuthentication no"),
        create_control("4.2.10", "Ensure sshd HostbasedAuthentication is disabled", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="HostbasedAuthentication", expected_value="no",
                      description="Host-based authentication should be disabled.",
                      remediation="Edit /etc/ssh/sshd_config and set HostbasedAuthentication no"),
        create_control("4.2.11", "Ensure sshd IgnoreRhosts is enabled", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="IgnoreRhosts", expected_value="yes",
                      description="SSH should ignore .rhosts files.",
                      remediation="Edit /etc/ssh/sshd_config and set IgnoreRhosts yes"),
        create_control("4.2.12", "Ensure sshd KexAlgorithms is configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="KexAlgorithms", expected_value="strong",
                      description="Weak key exchange algorithms should not be used.",
                      remediation="Edit /etc/ssh/sshd_config and configure strong key exchange algorithms."),
        create_control("4.2.13", "Ensure sshd LoginGraceTime is configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="LoginGraceTime", expected_value="60",
                      description="The LoginGraceTime parameter specifies the time allowed for successful authentication to the SSH server.",
                      remediation="Edit /etc/ssh/sshd_config and set LoginGraceTime 60"),
        create_control("4.2.14", "Ensure sshd LogLevel is configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="LogLevel", expected_value="VERBOSE",
                      description="SSH provides several logging levels. VERBOSE or INFO level is recommended.",
                      remediation="Edit /etc/ssh/sshd_config and set LogLevel VERBOSE or LogLevel INFO"),
        create_control("4.2.15", "Ensure sshd MACs are configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="MACs", expected_value="strong",
                      description="Weak MAC algorithms should not be used.",
                      remediation="Edit /etc/ssh/sshd_config and configure strong MAC algorithms."),
        create_control("4.2.16", "Ensure sshd MaxAuthTries is configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="MaxAuthTries", expected_value="4",
                      description="The MaxAuthTries parameter specifies the maximum number of authentication attempts permitted per connection.",
                      remediation="Edit /etc/ssh/sshd_config and set MaxAuthTries 4"),
        create_control("4.2.17", "Ensure sshd MaxSessions is configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="MaxSessions", expected_value="10",
                      description="The MaxSessions parameter specifies the maximum number of open sessions permitted from a given connection.",
                      remediation="Edit /etc/ssh/sshd_config and set MaxSessions 10"),
        create_control("4.2.18", "Ensure sshd MaxStartups is configured", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="MaxStartups", expected_value="10:30:60",
                      description="The MaxStartups parameter specifies the maximum number of concurrent unauthenticated connections to the SSH daemon.",
                      remediation="Edit /etc/ssh/sshd_config and set MaxStartups 10:30:60"),
        create_control("4.2.19", "Ensure sshd PermitEmptyPasswords is disabled", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="PermitEmptyPasswords", expected_value="no",
                      description="The PermitEmptyPasswords parameter specifies if the SSH server allows login to accounts with empty password strings.",
                      remediation="Edit /etc/ssh/sshd_config and set PermitEmptyPasswords no"),
        create_control("4.2.20", "Ensure sshd PermitRootLogin is disabled", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="PermitRootLogin", expected_value="no",
                      description="The PermitRootLogin parameter specifies if the root user can log in using SSH.",
                      remediation="Edit /etc/ssh/sshd_config and set PermitRootLogin no"),
        create_control("4.2.21", "Ensure sshd PermitUserEnvironment is disabled", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="PermitUserEnvironment", expected_value="no",
                      description="The PermitUserEnvironment option allows users to present environment options to the SSH daemon.",
                      remediation="Edit /etc/ssh/sshd_config and set PermitUserEnvironment no"),
        create_control("4.2.22", "Ensure sshd UsePAM is enabled", "4.2 Configure SSH Server", "Level1", True, "SSHConfig",
                      parameter="UsePAM", expected_value="yes",
                      description="The UsePAM directive enables the Pluggable Authentication Module (PAM) interface.",
                      remediation="Edit /etc/ssh/sshd_config and set UsePAM yes"),
    ]
    return create_milestone("4.2", "4 Access, Authentication and Authorization", "Section 4.2 Configure SSH Server", controls)

# Section 4.3 - Configure privilege escalation
def milestone_4_3():
    controls = [
        create_control("4.3.1", "Ensure sudo is installed", "4.3 Configure privilege escalation", "Level1", True, "PackageInstalled",
                      package_name="sudo", expected_status="installed",
                      description="sudo allows a permitted user to execute a command as the superuser or another user, as specified by the security policy.",
                      remediation="Run the following command to install sudo: # yum install sudo"),
        create_control("4.3.2", "Ensure sudo commands use pty", "4.3 Configure privilege escalation", "Level1", True, "SudoConfig",
                      parameter="use_pty", expected_value="enabled",
                      description="Requiring a pty prevents sudo from being used to execute commands that do not require a terminal.",
                      remediation="Edit /etc/sudoers or /etc/sudoers.d/* and add: Defaults use_pty"),
        create_control("4.3.3", "Ensure sudo log file exists", "4.3 Configure privilege escalation", "Level1", True, "SudoConfig",
                      parameter="logfile", expected_value="/var/log/sudo.log",
                      description="A log file for sudo commands helps in auditing and troubleshooting.",
                      remediation="Edit /etc/sudoers or /etc/sudoers.d/* and add: Defaults logfile=/var/log/sudo.log"),
        create_control("4.3.4", "Ensure users must provide password for escalation", "4.3 Configure privilege escalation", "Level1", True, "SudoConfig",
                      parameter="!authenticate", expected_value="not_found",
                      description="Requiring a password for privilege escalation provides an additional layer of security.",
                      remediation="Ensure that no user entries in /etc/sudoers or /etc/sudoers.d/* have NOPASSWD set."),
        create_control("4.3.5", "Ensure re-authentication for privilege escalation is not disabled globally", "4.3 Configure privilege escalation", "Level1", True, "SudoConfig",
                      parameter="!authenticate", expected_value="not_found",
                      description="Global disabling of re-authentication for privilege escalation reduces security.",
                      remediation="Ensure Defaults !authenticate is not set in /etc/sudoers or /etc/sudoers.d/*"),
        create_control("4.3.6", "Ensure sudo authentication timeout is configured correctly", "4.3 Configure privilege escalation", "Level1", True, "SudoConfig",
                      parameter="timestamp_timeout", expected_value="15",
                      description="The timestamp_timeout parameter controls how long a user can use sudo without re-entering their password.",
                      remediation="Edit /etc/sudoers or /etc/sudoers.d/* and set: Defaults timestamp_timeout=15"),
        create_control("4.3.7", "Ensure access to the su command is restricted", "4.3 Configure privilege escalation", "Level1", True, "FileContent",
                      file_path="/etc/pam.d/su", pattern="^auth\\s+required\\s+pam_wheel.so", expected_result="found",
                      description="Restricting access to the su command helps prevent unauthorized privilege escalation.",
                      remediation="Edit /etc/pam.d/su and add: auth required pam_wheel.so use_uid"),
    ]
    return create_milestone("4.3", "4 Access, Authentication and Authorization", "Section 4.3 Configure privilege escalation", controls)

# Section 4.4 - Configure Pluggable Authentication Modules
def milestone_4_4():
    controls = [
        create_control("4.4.1.1", "Ensure latest version of pam is installed", "4.4.1 Configure PAM software packages", "Level1", True, "PackageInstalled",
                      package_name="pam", expected_status="installed",
                      description="PAM provides authentication services. Ensure the latest version is installed.",
                      remediation="Run: yum update pam"),
        create_control("4.4.1.2", "Ensure libpwquality is installed", "4.4.1 Configure PAM software packages", "Level1", True, "PackageInstalled",
                      package_name="libpwquality", expected_status="installed",
                      description="libpwquality provides password quality checking functionality.",
                      remediation="Run: yum install libpwquality"),
        create_control("4.4.2.1.1", "Ensure pam_faillock module is enabled", "4.4.2.1 Configure pam_faillock module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="pam_faillock", expected_value="enabled",
                      description="The pam_faillock module provides account lockout functionality.",
                      remediation="Edit /etc/pam.d/system-auth and add: auth required pam_faillock.so preauth"),
        create_control("4.4.2.1.2", "Ensure password failed attempts lockout is configured", "4.4.2.1 Configure pam_faillock module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="deny", expected_value="5",
                      description="Configure account lockout after failed password attempts.",
                      remediation="Edit /etc/pam.d/system-auth and configure: auth required pam_faillock.so preauth deny=5"),
        create_control("4.4.2.1.3", "Ensure password unlock time is configured", "4.4.2.1 Configure pam_faillock module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="unlock_time", expected_value="900",
                      description="Configure the time before a locked account is automatically unlocked.",
                      remediation="Edit /etc/pam.d/system-auth and configure: auth required pam_faillock.so preauth unlock_time=900"),
        create_control("4.4.2.1.4", "Ensure password failed attempts lockout includes root account", "4.4.2.1 Configure pam_faillock module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="even_deny_root", expected_value="enabled",
                      description="Account lockout should apply to the root account as well.",
                      remediation="Edit /etc/pam.d/system-auth and configure: auth required pam_faillock.so preauth even_deny_root"),
        create_control("4.4.2.2.1", "Ensure pam_pwquality module is enabled", "4.4.2.2 Configure pam_pwquality module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="pam_pwquality", expected_value="enabled",
                      description="The pam_pwquality module checks password strength.",
                      remediation="Edit /etc/pam.d/system-auth and add: password requisite pam_pwquality.so"),
        create_control("4.4.2.2.2", "Ensure password number of changed characters is configured", "4.4.2.2 Configure pam_pwquality module", "Level1", True, "FileContent",
                      file_path="/etc/security/pwquality.conf", pattern="^minclass", expected_result="found",
                      description="Configure minimum number of character classes required in passwords.",
                      remediation="Edit /etc/security/pwquality.conf and set: minclass = 4"),
        create_control("4.4.2.2.3", "Ensure password length is configured", "4.4.2.2 Configure pam_pwquality module", "Level1", True, "FileContent",
                      file_path="/etc/security/pwquality.conf", pattern="^minlen\\s*=\\s*1[4-9]|[2-9][0-9]", expected_result="found",
                      description="Configure minimum password length.",
                      remediation="Edit /etc/security/pwquality.conf and set: minlen = 14"),
        create_control("4.4.2.2.4", "Ensure password complexity is configured", "4.4.2.2 Configure pam_pwquality module", "Level1", False, "Manual",
                      description="Configure password complexity requirements.",
                      remediation="Edit /etc/security/pwquality.conf and configure: dcredit=-1 ucredit=-1 ocredit=-1 lcredit=-1"),
        create_control("4.4.2.2.5", "Ensure password same consecutive characters is configured", "4.4.2.2 Configure pam_pwquality module", "Level1", True, "FileContent",
                      file_path="/etc/security/pwquality.conf", pattern="^maxrepeat", expected_result="found",
                      description="Limit the number of consecutive identical characters in passwords.",
                      remediation="Edit /etc/security/pwquality.conf and set: maxrepeat = 3"),
        create_control("4.4.2.2.6", "Ensure password maximum sequential characters is configured", "4.4.2.2 Configure pam_pwquality module", "Level1", True, "FileContent",
                      file_path="/etc/security/pwquality.conf", pattern="^maxsequence", expected_result="found",
                      description="Limit the number of sequential characters in passwords.",
                      remediation="Edit /etc/security/pwquality.conf and set: maxsequence = 4"),
        create_control("4.4.2.2.7", "Ensure password dictionary check is enabled", "4.4.2.2 Configure pam_pwquality module", "Level1", True, "FileContent",
                      file_path="/etc/security/pwquality.conf", pattern="^dictcheck", expected_result="found",
                      description="Enable dictionary checking for passwords.",
                      remediation="Edit /etc/security/pwquality.conf and set: dictcheck = 1"),
        create_control("4.4.2.3.1", "Ensure pam_pwhistory module is enabled", "4.4.2.3 Configure pam_pwhistory module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="pam_pwhistory", expected_value="enabled",
                      description="The pam_pwhistory module prevents password reuse.",
                      remediation="Edit /etc/pam.d/system-auth and add: password required pam_pwhistory.so"),
        create_control("4.4.2.3.2", "Ensure password history remember is configured", "4.4.2.3 Configure pam_pwhistory module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="remember", expected_value="5",
                      description="Configure the number of previous passwords to remember.",
                      remediation="Edit /etc/pam.d/system-auth and configure: password required pam_pwhistory.so remember=5"),
        create_control("4.4.2.3.3", "Ensure password history is enforced for the root user", "4.4.2.3 Configure pam_pwhistory module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="enforce_for_root", expected_value="enabled",
                      description="Password history should be enforced for the root user.",
                      remediation="Edit /etc/pam.d/system-auth and configure: password required pam_pwhistory.so enforce_for_root"),
        create_control("4.4.2.3.4", "Ensure pam_pwhistory includes use_authtok", "4.4.2.3 Configure pam_pwhistory module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="use_authtok", expected_value="enabled",
                      description="The use_authtok option ensures the password from the previous module is used.",
                      remediation="Edit /etc/pam.d/system-auth and configure: password required pam_pwhistory.so use_authtok"),
        create_control("4.4.2.4.1", "Ensure pam_unix does not include nullok", "4.4.2.4 Configure pam_unix module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="nullok", expected_value="not_found",
                      description="The nullok option allows accounts with empty passwords. This should be disabled.",
                      remediation="Ensure nullok is not present in pam_unix entries in /etc/pam.d/system-auth"),
        create_control("4.4.2.4.2", "Ensure pam_unix does not include remember", "4.4.2.4 Configure pam_unix module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="remember", expected_value="not_found",
                      description="The remember option should be in pam_pwhistory, not pam_unix.",
                      remediation="Ensure remember is not present in pam_unix entries in /etc/pam.d/system-auth"),
        create_control("4.4.2.4.3", "Ensure pam_unix includes a strong password hashing algorithm", "4.4.2.4 Configure pam_unix module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="sha512", expected_value="enabled",
                      description="Use SHA-512 for password hashing instead of weaker algorithms.",
                      remediation="Edit /etc/pam.d/system-auth and ensure: password sufficient pam_unix.so sha512"),
        create_control("4.4.2.4.4", "Ensure pam_unix includes use_authtok", "4.4.2.4 Configure pam_unix module", "Level1", True, "PAMConfig",
                      file_path="/etc/pam.d/system-auth", parameter="use_authtok", expected_value="enabled",
                      description="The use_authtok option ensures the password from the previous module is used.",
                      remediation="Edit /etc/pam.d/system-auth and configure: password sufficient pam_unix.so use_authtok"),
    ]
    return create_milestone("4.4", "4 Access, Authentication and Authorization", "Section 4.4 Configure Pluggable Authentication Modules", controls)

# Section 4.5 - User Accounts and Environment
def milestone_4_5():
    controls = [
        create_control("4.5.1.1", "Ensure strong password hashing algorithm is configured", "4.5.1 Configure shadow password suite parameters", "Level1", True, "FileContent",
                      file_path="/etc/login.defs", pattern="^ENCRYPT_METHOD\\s+SHA512", expected_result="found",
                      description="Use SHA-512 for password hashing instead of weaker algorithms.",
                      remediation="Edit /etc/login.defs and set: ENCRYPT_METHOD SHA512"),
        create_control("4.5.1.2", "Ensure password expiration is 365 days or less", "4.5.1 Configure shadow password suite parameters", "Level1", True, "FileContent",
                      file_path="/etc/login.defs", pattern="^PASS_MAX_DAYS\\s+([0-9]|[1-9][0-9]|[1-2][0-9][0-9]|3[0-5][0-9]|36[0-5])", expected_result="found",
                      description="Passwords should expire after a reasonable period to force regular password changes.",
                      remediation="Edit /etc/login.defs and set: PASS_MAX_DAYS 365"),
        create_control("4.5.1.3", "Ensure password expiration warning days is 7 or more", "4.5.1 Configure shadow password suite parameters", "Level1", True, "FileContent",
                      file_path="/etc/login.defs", pattern="^PASS_WARN_AGE\\s+[7-9]|[1-9][0-9]", expected_result="found",
                      description="Users should be warned before their passwords expire.",
                      remediation="Edit /etc/login.defs and set: PASS_WARN_AGE 7"),
        create_control("4.5.1.4", "Ensure inactive password lock is 30 days or less", "4.5.1 Configure shadow password suite parameters", "Level1", True, "FileContent",
                      file_path="/etc/default/useradd", pattern="^INACTIVE\\s+([0-9]|[12][0-9]|30)", expected_result="found",
                      description="Accounts that have been inactive for too long should be locked.",
                      remediation="Edit /etc/default/useradd and set: INACTIVE=30"),
        create_control("4.5.1.5", "Ensure all users last password change date is in the past", "4.5.1 Configure shadow password suite parameters", "Level1", False, "Manual",
                      description="All user accounts should have a password change date set.",
                      remediation="Review /etc/shadow and ensure all users have a valid password change date."),
        create_control("4.5.2.1", "Ensure default group for the root account is GID 0", "4.5.2 Configure root and system accounts and environment", "Level1", True, "FileContent",
                      file_path="/etc/passwd", pattern="^root:.*:0:0:", expected_result="found",
                      description="The root account should have GID 0.",
                      remediation="Ensure root account in /etc/passwd has GID 0"),
        create_control("4.5.2.2", "Ensure root user umask is configured", "4.5.2 Configure root and system accounts and environment", "Level1", True, "FileContent",
                      file_path="/etc/bashrc", pattern="umask\\s+027|umask\\s+077", expected_result="found",
                      description="The root user's umask should be restrictive.",
                      remediation="Edit /etc/bashrc and /etc/profile and add: umask 027 or umask 077"),
        create_control("4.5.2.3", "Ensure system accounts are secured", "4.5.2 Configure root and system accounts and environment", "Level1", False, "Manual",
                      description="System accounts should not have login shells or home directories unless necessary.",
                      remediation="Review /etc/passwd and ensure system accounts have /sbin/nologin or /bin/false as shell."),
        create_control("4.5.2.4", "Ensure root password is set", "4.5.2 Configure root and system accounts and environment", "Level1", True, "FileContent",
                      file_path="/etc/shadow", pattern="^root:.*:.*:.*:.*:.*:.*:.*:.*", expected_result="found",
                      description="The root account must have a password set.",
                      remediation="Set a password for the root account: # passwd root"),
        create_control("4.5.3.1", "Ensure nologin is not listed in /etc/shells", "4.5.3 Configure user default environment", "Level1", True, "FileContent",
                      file_path="/etc/shells", pattern="nologin|false", expected_result="not_found",
                      description="The /etc/shells file should only contain valid login shells.",
                      remediation="Remove nologin and false from /etc/shells if present."),
        create_control("4.5.3.2", "Ensure default user shell timeout is configured", "4.5.3 Configure user default environment", "Level1", True, "FileContent",
                      file_path="/etc/bashrc", pattern="TMOUT", expected_result="found",
                      description="Configure shell timeout to automatically log out idle users.",
                      remediation="Edit /etc/bashrc and /etc/profile and add: TMOUT=600"),
        create_control("4.5.3.3", "Ensure default user umask is configured", "4.5.3 Configure user default environment", "Level1", True, "FileContent",
                      file_path="/etc/bashrc", pattern="umask\\s+027|umask\\s+022", expected_result="found",
                      description="Configure default umask for users to restrict file permissions.",
                      remediation="Edit /etc/bashrc and /etc/profile and add: umask 027 or umask 022"),
    ]
    return create_milestone("4.5", "4 Access, Authentication and Authorization", "Section 4.5 User Accounts and Environment", controls)

# Section 5.1 - Configure Logging
def milestone_5_1():
    controls = [
        create_control("5.1.1.1", "Ensure rsyslog is installed", "5.1.1 Configure rsyslog", "Level1", True, "PackageInstalled",
                      package_name="rsyslog", expected_status="installed",
                      description="rsyslog is the default syslog daemon on Amazon Linux 2. It provides logging capabilities for the system.",
                      remediation="Run the following command to install rsyslog: # yum install rsyslog"),
        create_control("5.1.1.2", "Ensure rsyslog service is enabled", "5.1.1 Configure rsyslog", "Level1", False, "Manual",
                      description="Enable rsyslog service to collect system logs.",
                      remediation="Run the following command to enable rsyslog: # systemctl enable rsyslog"),
        create_control("5.1.1.3", "Ensure journald is configured to send logs to rsyslog", "5.1.1 Configure rsyslog", "Level1", False, "Manual",
                      description="Data from journald may be stored in volatile memory or persisted locally. It is recommended that journald be configured to send logs to rsyslog.",
                      remediation="Edit /etc/systemd/journald.conf and set ForwardToSyslog=yes"),
        create_control("5.1.1.4", "Ensure rsyslog default file permissions are configured", "5.1.1 Configure rsyslog", "Level1", True, "FileContent",
                      file_path="/etc/rsyslog.conf", pattern="\\$FileCreateMode", expected_result="found",
                      description="rsyslog will create logfiles that do not already exist on the system. It is important to ensure that logfiles have appropriate permissions.",
                      remediation="Edit /etc/rsyslog.conf and set $FileCreateMode 0640"),
        create_control("5.1.1.5", "Ensure logging is configured", "5.1.1 Configure rsyslog", "Level1", False, "Manual",
                      description="Configure rsyslog to send logs to a remote log host for centralized logging.",
                      remediation="Edit /etc/rsyslog.conf and configure remote logging: *.* @@<loghost>"),
        create_control("5.1.1.6", "Ensure rsyslog is configured to send logs to a remote log host", "5.1.1 Configure rsyslog", "Level1", False, "Manual",
                      description="Centralized logging helps with log analysis and security monitoring.",
                      remediation="Edit /etc/rsyslog.conf and configure: *.* @@<remote_log_host>"),
        create_control("5.1.1.7", "Ensure rsyslog is not configured to receive logs from a remote client", "5.1.1 Configure rsyslog", "Level1", True, "FileContent",
                      file_path="/etc/rsyslog.conf", pattern="^\\$ModLoad.*imtcp|^\\$ModLoad.*imudp|^\\$InputTCPServerRun|^\\$InputUDPServerRun", expected_result="not_found",
                      description="Receiving logs from remote clients can expose the system to security risks.",
                      remediation="Remove or comment out any lines in /etc/rsyslog.conf that load imtcp or imudp modules or start TCP/UDP servers."),
        create_control("5.1.2.1.1", "Ensure systemd-journal-remote is installed", "5.1.2.1 Configure journald", "Level1", False, "Manual",
                      description="systemd-journal-remote is required for remote journal logging.",
                      remediation="Run: yum install systemd-journal-remote"),
        create_control("5.1.2.1.2", "Ensure systemd-journal-remote is configured", "5.1.2.1 Configure journald", "Level1", False, "Manual",
                      description="Configure systemd-journal-remote to send logs to a remote host.",
                      remediation="Edit /etc/systemd/journal-upload.conf and configure URL=<remote_host>"),
        create_control("5.1.2.1.3", "Ensure systemd-journal-remote is enabled", "5.1.2.1 Configure journald", "Level1", False, "Manual",
                      description="Enable systemd-journal-remote service.",
                      remediation="Run: systemctl enable systemd-journal-upload.service"),
        create_control("5.1.2.1.4", "Ensure journald is not configured to receive logs from a remote client", "5.1.2.1 Configure journald", "Level1", True, "FileContent",
                      file_path="/etc/systemd/journald.conf", pattern="^Listen", expected_result="not_found",
                      description="Receiving logs from remote clients can expose the system to security risks.",
                      remediation="Ensure Listen= is not set in /etc/systemd/journald.conf"),
        create_control("5.1.2.2", "Ensure journald service is enabled", "5.1.2 Configure journald", "Level1", True, "ServiceStatus",
                      service_name="systemd-journald", expected_status="enabled",
                      description="The journald service should be enabled to collect system logs.",
                      remediation="Run: systemctl enable systemd-journald.service"),
        create_control("5.1.2.3", "Ensure journald is configured to compress large log files", "5.1.2 Configure journald", "Level1", True, "FileContent",
                      file_path="/etc/systemd/journald.conf", pattern="^Compress\\s*=\\s*yes", expected_result="found",
                      description="Configure journald to compress large log files to save disk space.",
                      remediation="Edit /etc/systemd/journald.conf and set Compress=yes"),
        create_control("5.1.2.4", "Ensure journald is configured to write logfiles to persistent disk", "5.1.2 Configure journald", "Level1", True, "FileContent",
                      file_path="/etc/systemd/journald.conf", pattern="^Storage\\s*=\\s*persistent", expected_result="found",
                      description="Configure journald to persist logs to disk rather than storing them only in volatile memory.",
                      remediation="Edit /etc/systemd/journald.conf and set Storage=persistent"),
        create_control("5.1.2.5", "Ensure journald is not configured to send logs to rsyslog", "5.1.2 Configure journald", "Level1", False, "Manual",
                      description="If using journald for logging, it should not forward to rsyslog to avoid duplication.",
                      remediation="Edit /etc/systemd/journald.conf and set ForwardToSyslog=no"),
        create_control("5.1.2.6", "Ensure journald log rotation is configured per site policy", "5.1.2 Configure journald", "Level1", False, "Manual",
                      description="Configure journald log rotation to prevent disk space issues.",
                      remediation="Edit /etc/systemd/journald.conf and configure SystemMaxUse, SystemKeepFree, and MaxRetentionSec as per site policy."),
        create_control("5.1.3", "Ensure logrotate is configured", "5.1.3 Ensure logrotate is configured", "Level1", False, "Manual",
                      description="logrotate helps manage log file rotation and prevents disk space issues.",
                      remediation="Configure /etc/logrotate.conf and files in /etc/logrotate.d/ according to site policy."),
        create_control("5.1.4", "Ensure all logfiles have appropriate access configured", "5.1.4 Ensure all logfiles have appropriate access configured", "Level1", True, "FilePermissions",
                      file_path="/var/log", expected_permissions="0755", expected_owner="root", expected_group="root",
                      description="Log files should have appropriate permissions to protect sensitive information.",
                      remediation="Run: chmod 755 /var/log && chown root:root /var/log"),
    ]
    return create_milestone("5.1", "5 Logging and Auditing", "Section 5.1 Configure Logging", controls)

# Section 5.2 - Configure System Accounting (auditd)
def milestone_5_2():
    controls = [
        create_control("5.2.1.1", "Ensure audit is installed", "5.2.1 Ensure auditing is enabled", "Level1", True, "PackageInstalled",
                      package_name="audit", expected_status="installed",
                      description="auditd is the userspace component to the Linux Auditing System. It's responsible for writing audit records to the disk.",
                      remediation="Run the following command to install auditd: # yum install audit audit-libs"),
        create_control("5.2.1.2", "Ensure auditing for processes that start prior to auditd is enabled", "5.2.1 Ensure auditing is enabled", "Level1", True, "FileContent",
                      file_path="/etc/default/grub", pattern="audit=1", expected_result="found",
                      description="Configure grub so that processes that are capable of being audited can be audited even if they start up prior to auditd startup.",
                      remediation="Edit /etc/default/grub and add audit=1 to GRUB_CMDLINE_LINUX. Then run: # grub2-mkconfig -o /boot/grub2/grub.cfg"),
        create_control("5.2.1.3", "Ensure audit_backlog_limit is sufficient", "5.2.1 Ensure auditing is enabled", "Level1", True, "FileContent",
                      file_path="/etc/default/grub", pattern="audit_backlog_limit=8192", expected_result="found",
                      description="The backlog limit determines how many audit records can be queued. The default is 64, which may be insufficient for high-volume systems.",
                      remediation="Edit /etc/default/grub and add audit_backlog_limit=8192 to GRUB_CMDLINE_LINUX. Then run: # grub2-mkconfig -o /boot/grub2/grub.cfg"),
        create_control("5.2.1.4", "Ensure auditd service is enabled", "5.2.1 Ensure auditing is enabled", "Level1", True, "ServiceStatus",
                      service_name="auditd", expected_status="enabled",
                      description="Turn on the auditd daemon to record system events.",
                      remediation="Run the following command to enable auditd: # systemctl enable auditd"),
        create_control("5.2.2.1", "Ensure audit log storage size is configured", "5.2.2 Configure Data Retention", "Level1", True, "FileContent",
                      file_path="/etc/audit/auditd.conf", pattern="^max_log_file", expected_result="found",
                      description="Configure the maximum size of the audit log file. Once the log reaches the maximum size, it will be rotated.",
                      remediation="Edit /etc/audit/auditd.conf and set max_log_file = <appropriate_size>"),
        create_control("5.2.2.2", "Ensure audit logs are not automatically deleted", "5.2.2 Configure Data Retention", "Level1", True, "FileContent",
                      file_path="/etc/audit/auditd.conf", pattern="^max_log_file_action\\s*=\\s*keep_logs", expected_result="found",
                      description="The max_log_file_action determines what happens when the log file reaches the maximum size. It should be set to keep_logs to prevent automatic deletion.",
                      remediation="Edit /etc/audit/auditd.conf and set max_log_file_action = keep_logs"),
        create_control("5.2.2.3", "Ensure system is disabled when audit logs are full", "5.2.2 Configure Data Retention", "Level1", True, "FileContent",
                      file_path="/etc/audit/auditd.conf", pattern="^space_left_action\\s*=\\s*(email|syslog|exec)", expected_result="found",
                      description="The space_left_action parameter determines what happens when the system is running low on disk space.",
                      remediation="Edit /etc/audit/auditd.conf and set space_left_action = email or space_left_action = syslog"),
        create_control("5.2.2.4", "Ensure system warns when audit logs are low on space", "5.2.2 Configure Data Retention", "Level1", True, "FileContent",
                      file_path="/etc/audit/auditd.conf", pattern="^admin_space_left_action", expected_result="found",
                      description="Configure system to warn when audit logs are low on space.",
                      remediation="Edit /etc/audit/auditd.conf and set admin_space_left_action = single"),
        create_control("5.2.3.1", "Ensure changes to system administration scope (sudoers) is collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-w /etc/sudoers", expected_result="found",
                      description="Monitor changes to the sudoers file to detect unauthorized privilege escalation.",
                      remediation="Add the following line to /etc/audit/rules.d/audit.rules: -w /etc/sudoers -p wa -k scope"),
        create_control("5.2.3.2", "Ensure actions as another user are always logged", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F arch=b64 -C euid!=uid", expected_result="found",
                      description="Monitor actions performed by users with elevated privileges.",
                      remediation="Add the following line to /etc/audit/rules.d/audit.rules: -a always,exit -F arch=b64 -C euid!=uid -F euid=0 -F auid>=1000 -F auid!=4294967295 -k privileged"),
        create_control("5.2.3.3", "Ensure events that modify the sudo log file are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-w /var/log/sudo.log", expected_result="found",
                      description="Monitor changes to the sudo log file.",
                      remediation="Add the following line to /etc/audit/rules.d/audit.rules: -w /var/log/sudo.log -p wa -k actions"),
        create_control("5.2.3.4", "Ensure events that modify date and time information are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F arch=b64 -S adjtimex -S settimeofday", expected_result="found",
                      description="Monitor changes to system time.",
                      remediation="Add audit rules for time modification: -a always,exit -F arch=b64 -S adjtimex -S settimeofday -k time-change"),
        create_control("5.2.3.5", "Ensure events that modify the system's network environment are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F arch=b64 -S sethostname -S setdomainname", expected_result="found",
                      description="Monitor changes to network configuration.",
                      remediation="Add audit rules for network changes: -a always,exit -F arch=b64 -S sethostname -S setdomainname -k system-locale"),
        create_control("5.2.3.6", "Ensure use of privileged commands are collected", "5.2.3 Configure auditd rules", "Level1", False, "Manual",
                      description="Monitor use of privileged commands.",
                      remediation="Add audit rules for privileged commands. For each privileged command, add: -a always,exit -F path=<command> -F perm=x -F auid>=1000 -F auid!=4294967295 -k privileged"),
        create_control("5.2.3.7", "Ensure unsuccessful file access attempts are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES", expected_result="found",
                      description="Monitor unsuccessful file access attempts.",
                      remediation="Add audit rules: -a always,exit -F arch=b64 -S creat -S open -S openat -S truncate -S ftruncate -F exit=-EACCES -F auid>=1000 -F auid!=4294967295 -k access"),
        create_control("5.2.3.8", "Ensure events that modify user/group information are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-w /etc/group -p wa -k identity", expected_result="found",
                      description="Monitor changes to user and group information.",
                      remediation="Add audit rules: -w /etc/group -p wa -k identity -w /etc/passwd -p wa -k identity -w /etc/gshadow -p wa -k identity -w /etc/shadow -p wa -k identity"),
        create_control("5.2.3.9", "Ensure discretionary access control permission modification events are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat", expected_result="found",
                      description="Monitor changes to file permissions.",
                      remediation="Add audit rules: -a always,exit -F arch=b64 -S chmod -S fchmod -S fchmodat -F auid>=1000 -F auid!=4294967295 -k perm_mod"),
        create_control("5.2.3.10", "Ensure successful file system mounts are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F arch=b64 -S mount", expected_result="found",
                      description="Monitor file system mounts.",
                      remediation="Add audit rule: -a always,exit -F arch=b64 -S mount -F auid>=1000 -F auid!=4294967295 -k mounts"),
        create_control("5.2.3.11", "Ensure session initiation information is collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-w /var/run/utmp -p wa -k session", expected_result="found",
                      description="Monitor session initiation.",
                      remediation="Add audit rules: -w /var/run/utmp -p wa -k session -w /var/log/wtmp -p wa -k logins -w /var/log/btmp -p wa -k logins"),
        create_control("5.2.3.12", "Ensure login and logout events are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-w /var/log/faillog -p wa -k logins", expected_result="found",
                      description="Monitor login and logout events.",
                      remediation="Add audit rules: -w /var/log/faillog -p wa -k logins -w /var/log/lastlog -p wa -k logins"),
        create_control("5.2.3.13", "Ensure file deletion events by users are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat", expected_result="found",
                      description="Monitor file deletion events.",
                      remediation="Add audit rules: -a always,exit -F arch=b64 -S unlink -S unlinkat -S rename -S renameat -F auid>=1000 -F auid!=4294967295 -k delete"),
        create_control("5.2.3.14", "Ensure events that modify the system's Mandatory Access Controls are collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-w /etc/selinux/ -p wa -k MAC-policy", expected_result="found",
                      description="Monitor changes to SELinux configuration.",
                      remediation="Add audit rule: -w /etc/selinux/ -p wa -k MAC-policy"),
        create_control("5.2.3.15", "Ensure successful and unsuccessful attempts to use the chcon command are recorded", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F path=/usr/bin/chcon", expected_result="found",
                      description="Monitor use of the chcon command.",
                      remediation="Add audit rule: -a always,exit -F path=/usr/bin/chcon -F perm=x -F auid>=1000 -F auid!=4294967295 -k perm_chng"),
        create_control("5.2.3.16", "Ensure successful and unsuccessful attempts to use the setfacl command are recorded", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F path=/usr/bin/setfacl", expected_result="found",
                      description="Monitor use of the setfacl command.",
                      remediation="Add audit rule: -a always,exit -F path=/usr/bin/setfacl -F perm=x -F auid>=1000 -F auid!=4294967295 -k perm_chng"),
        create_control("5.2.3.17", "Ensure successful and unsuccessful attempts to use the chacl command are recorded", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F path=/usr/bin/chacl", expected_result="found",
                      description="Monitor use of the chacl command.",
                      remediation="Add audit rule: -a always,exit -F path=/usr/bin/chacl -F perm=x -F auid>=1000 -F auid!=4294967295 -k perm_chng"),
        create_control("5.2.3.18", "Ensure successful and unsuccessful attempts to use the usermod command are recorded", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-a always,exit -F path=/usr/sbin/usermod", expected_result="found",
                      description="Monitor use of the usermod command.",
                      remediation="Add audit rule: -a always,exit -F path=/usr/sbin/usermod -F perm=x -F auid>=1000 -F auid!=4294967295 -k usermod"),
        create_control("5.2.3.19", "Ensure kernel module loading unloading and modification is collected", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-w /sbin/insmod -p x -k modules", expected_result="found",
                      description="Monitor kernel module operations.",
                      remediation="Add audit rules: -w /sbin/insmod -p x -k modules -w /sbin/rmmod -p x -k modules -w /sbin/modprobe -p x -k modules"),
        create_control("5.2.3.20", "Ensure the audit configuration is immutable", "5.2.3 Configure auditd rules", "Level1", True, "FileContent",
                      file_path="/etc/audit/rules.d/audit.rules", pattern="-e 2", expected_result="found",
                      description="Make the audit configuration immutable to prevent tampering.",
                      remediation="Add the following line to /etc/audit/rules.d/audit.rules: -e 2"),
        create_control("5.2.3.21", "Ensure the running and on disk configuration is the same", "5.2.3 Configure auditd rules", "Level1", False, "Manual",
                      description="Verify that the running audit configuration matches the on-disk configuration.",
                      remediation="Run: augenrules --load && systemctl restart auditd && auditctl -l"),
        create_control("5.2.4.1", "Ensure the audit log directory is 0750 or more restrictive", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/var/log/audit", expected_permissions="0750", expected_owner="root", expected_group="root",
                      description="The audit log directory should have restrictive permissions.",
                      remediation="Run: chmod 750 /var/log/audit && chown root:root /var/log/audit"),
        create_control("5.2.4.2", "Ensure audit log files are mode 0640 or less permissive", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/var/log/audit", expected_permissions="0640", expected_owner="root", expected_group="root",
                      description="Audit log files should have restrictive permissions.",
                      remediation="Run: find /var/log/audit -type f -exec chmod 640 {} \\;"),
        create_control("5.2.4.3", "Ensure only authorized users own audit log files", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/var/log/audit", expected_owner="root", expected_group="root",
                      description="Audit log files should be owned by root.",
                      remediation="Run: find /var/log/audit -type f -exec chown root {} \\;"),
        create_control("5.2.4.4", "Ensure only authorized groups are assigned ownership of audit log files", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/var/log/audit", expected_group="root",
                      description="Audit log files should belong to root group.",
                      remediation="Run: find /var/log/audit -type f -exec chgrp root {} \\;"),
        create_control("5.2.4.5", "Ensure audit configuration files are 640 or more restrictive", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/etc/audit", expected_permissions="0640", expected_owner="root", expected_group="root",
                      description="Audit configuration files should have restrictive permissions.",
                      remediation="Run: find /etc/audit -type f -exec chmod 640 {} \\;"),
        create_control("5.2.4.6", "Ensure audit configuration files are owned by root", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/etc/audit", expected_owner="root", expected_group="root",
                      description="Audit configuration files should be owned by root.",
                      remediation="Run: find /etc/audit -type f -exec chown root {} \\;"),
        create_control("5.2.4.7", "Ensure audit configuration files belong to group root", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/etc/audit", expected_group="root",
                      description="Audit configuration files should belong to root group.",
                      remediation="Run: find /etc/audit -type f -exec chgrp root {} \\;"),
        create_control("5.2.4.8", "Ensure audit tools are 755 or more restrictive", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/usr/sbin/auditctl", expected_permissions="0755", expected_owner="root", expected_group="root",
                      description="Audit tools should have appropriate permissions.",
                      remediation="Run: chmod 755 /usr/sbin/auditctl /usr/sbin/auditd /usr/sbin/aureport /usr/sbin/ausearch /usr/sbin/autrace /usr/sbin/audit-watch /usr/sbin/augenrules"),
        create_control("5.2.4.9", "Ensure audit tools are owned by root", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/usr/sbin/auditctl", expected_owner="root", expected_group="root",
                      description="Audit tools should be owned by root.",
                      remediation="Run: chown root:root /usr/sbin/auditctl /usr/sbin/auditd /usr/sbin/aureport /usr/sbin/ausearch /usr/sbin/autrace /usr/sbin/audit-watch /usr/sbin/augenrules"),
        create_control("5.2.4.10", "Ensure audit tools belong to group root", "5.2.4 Configure auditd file access", "Level1", True, "FilePermissions",
                      file_path="/usr/sbin/auditctl", expected_group="root",
                      description="Audit tools should belong to root group.",
                      remediation="Run: chgrp root /usr/sbin/auditctl /usr/sbin/auditd /usr/sbin/aureport /usr/sbin/ausearch /usr/sbin/autrace /usr/sbin/audit-watch /usr/sbin/augenrules"),
    ]
    return create_milestone("5.2", "5 Logging and Auditing", "Section 5.2 Configure System Accounting (auditd)", controls)

# Section 5.3 - Configure Integrity Checking
def milestone_5_3():
    controls = [
        create_control("5.3.1", "Ensure AIDE is installed", "5.3 Configure Integrity Checking", "Level1", True, "PackageInstalled",
                      package_name="aide", expected_status="installed",
                      description="AIDE (Advanced Intrusion Detection Environment) is a file and directory integrity checker.",
                      remediation="Run the following command to install AIDE: # yum install aide"),
        create_control("5.3.2", "Ensure filesystem integrity is regularly checked", "5.3 Configure Integrity Checking", "Level1", True, "ServiceStatus",
                      service_name="aidecheck", expected_status="enabled",
                      description="Regular filesystem integrity checks help detect unauthorized changes.",
                      remediation="Initialize AIDE database: # aide --init && mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz. Create a cron job: 0 5 * * * /usr/sbin/aide --check"),
    ]
    return create_milestone("5.3", "5 Logging and Auditing", "Section 5.3 Configure Integrity Checking", controls)

# Section 6.1 - System File Permissions
def milestone_6_1():
    controls = [
        create_control("6.1.1", "Ensure permissions on /etc/passwd are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/passwd", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="The /etc/passwd file contains user account information that is used by many system utilities.",
                      remediation="Run: chmod 644 /etc/passwd && chown root:root /etc/passwd"),
        create_control("6.1.2", "Ensure permissions on /etc/passwd- are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/passwd-", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="The /etc/passwd- file is a backup of /etc/passwd.",
                      remediation="Run: chmod 644 /etc/passwd- && chown root:root /etc/passwd-"),
        create_control("6.1.3", "Ensure permissions on /etc/group are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/group", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="The /etc/group file contains group information.",
                      remediation="Run: chmod 644 /etc/group && chown root:root /etc/group"),
        create_control("6.1.4", "Ensure permissions on /etc/group- are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/group-", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="The /etc/group- file is a backup of /etc/group.",
                      remediation="Run: chmod 644 /etc/group- && chown root:root /etc/group-"),
        create_control("6.1.5", "Ensure permissions on /etc/shadow are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/shadow", expected_permissions="0000", expected_owner="root", expected_group="root",
                      description="The /etc/shadow file contains encrypted password information.",
                      remediation="Run: chmod 0000 /etc/shadow && chown root:root /etc/shadow"),
        create_control("6.1.6", "Ensure permissions on /etc/shadow- are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/shadow-", expected_permissions="0000", expected_owner="root", expected_group="root",
                      description="The /etc/shadow- file is a backup of /etc/shadow.",
                      remediation="Run: chmod 0000 /etc/shadow- && chown root:root /etc/shadow-"),
        create_control("6.1.7", "Ensure permissions on /etc/gshadow are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/gshadow", expected_permissions="0000", expected_owner="root", expected_group="root",
                      description="The /etc/gshadow file contains encrypted group password information.",
                      remediation="Run: chmod 0000 /etc/gshadow && chown root:root /etc/gshadow"),
        create_control("6.1.8", "Ensure permissions on /etc/gshadow- are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/gshadow-", expected_permissions="0000", expected_owner="root", expected_group="root",
                      description="The /etc/gshadow- file is a backup of /etc/gshadow.",
                      remediation="Run: chmod 0000 /etc/gshadow- && chown root:root /etc/gshadow-"),
        create_control("6.1.9", "Ensure permissions on /etc/shells are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/shells", expected_permissions="0644", expected_owner="root", expected_group="root",
                      description="The /etc/shells file contains valid login shells. It should be protected from unauthorized modification.",
                      remediation="Run: chmod 644 /etc/shells && chown root:root /etc/shells"),
        create_control("6.1.10", "Ensure permissions on /etc/security/opasswd are configured", "6.1 System File Permissions", "Level1", True, "FilePermissions",
                      file_path="/etc/security/opasswd", expected_permissions="0600", expected_owner="root", expected_group="root",
                      description="The /etc/security/opasswd file stores old passwords. It should be protected from unauthorized access.",
                      remediation="Run: chmod 600 /etc/security/opasswd && chown root:root /etc/security/opasswd"),
        create_control("6.1.11", "Ensure world writable files and directories are secured", "6.1 System File Permissions", "Level1", True, "CommandOutputEmpty",
                      audit_command="find / -xdev -type f -perm -0002 ! -path '/proc/*' ! -path '/sys/*' ! -path '/dev/*'",
                      description="World writable files can be modified by any user on the system.",
                      remediation="Run: find / -xdev -type f -perm -0002 -exec chmod o-w {} \\;"),
        create_control("6.1.12", "Ensure no unowned or ungrouped files or directories exist", "6.1 System File Permissions", "Level1", True, "CommandOutputEmpty",
                      audit_command="find / -xdev -nouser -o -nogroup",
                      description="Files not owned by a valid user or group can be modified by anyone.",
                      remediation="Run: find / -xdev -nouser -exec chown root {} \\; && find / -xdev -nogroup -exec chgrp root {} \\;"),
        create_control("6.1.13", "Ensure SUID and SGID files are reviewed", "6.1 System File Permissions", "Level1", False, "Manual",
                      description="SUID and SGID files can be security risks if not properly managed.",
                      remediation="Review all SUID and SGID files: find / -xdev -type f -perm -4000 -o -perm -2000. Remove unnecessary setuid/setgid bits."),
        create_control("6.1.14", "Audit system file permissions", "6.1 System File Permissions", "Level1", False, "Manual",
                      description="Regularly audit system file permissions to detect unauthorized changes.",
                      remediation="Use tools like AIDE or tripwire to regularly audit system file permissions."),
    ]
    return create_milestone("6.1", "6 System Maintenance", "Section 6.1 System File Permissions", controls)

# Section 6.2 - Local User and Group Settings
def milestone_6_2():
    controls = [
        create_control("6.2.1", "Ensure accounts in /etc/passwd use shadowed passwords", "6.2 Local User and Group Settings", "Level1", True, "FileContent",
                      file_path="/etc/passwd", pattern="^[^:]*:[^:]*:[^:]*:[^:]*:[^:]*:[^:]*:[^:]*$", expected_result="found",
                      description="Shadow passwords provide an additional layer of security by storing password hashes in /etc/shadow instead of /etc/passwd.",
                      remediation="Ensure all accounts use shadowed passwords. Run: pwconv"),
        create_control("6.2.2", "Ensure /etc/shadow password fields are not empty", "6.2 Local User and Group Settings", "Level1", True, "CommandOutputEmpty",
                      audit_command="awk -F: '($2 == \"\" || $2 == \"!\") {print $1}' /etc/shadow",
                      description="Accounts with empty password fields represent a significant security risk.",
                      remediation="Lock or remove accounts with empty password fields."),
        create_control("6.2.3", "Ensure all groups in /etc/passwd exist in /etc/group", "6.2 Local User and Group Settings", "Level1", True, "CommandOutputEmpty",
                      audit_command="for i in $(cut -s -d: -f4 /etc/passwd | sort -u); do grep -q -P \"^.*?:[^:]*:$i:\" /etc/group; if [ $? -ne 0 ]; then echo \"Group $i is referenced by /etc/passwd but does not exist in /etc/group\"; fi; done",
                      description="Groups defined in /etc/passwd but not in /etc/group can cause security issues.",
                      remediation="Ensure all groups referenced in /etc/passwd exist in /etc/group."),
        create_control("6.2.4", "Ensure no duplicate UIDs exist", "6.2 Local User and Group Settings", "Level1", True, "CommandOutputEmpty",
                      audit_command="cut -f3 -d: /etc/passwd | sort -n | uniq -d",
                      description="Duplicate UIDs can cause security and operational issues.",
                      remediation="Ensure each user has a unique UID."),
        create_control("6.2.5", "Ensure no duplicate GIDs exist", "6.2 Local User and Group Settings", "Level1", True, "CommandOutputEmpty",
                      audit_command="cut -f3 -d: /etc/group | sort -n | uniq -d",
                      description="Duplicate GIDs can cause security and operational issues.",
                      remediation="Ensure each group has a unique GID."),
        create_control("6.2.6", "Ensure no duplicate user names exist", "6.2 Local User and Group Settings", "Level1", True, "CommandOutputEmpty",
                      audit_command="cut -f1 -d: /etc/passwd | sort | uniq -d",
                      description="Duplicate user names can cause security and operational issues.",
                      remediation="Ensure each user has a unique name."),
        create_control("6.2.7", "Ensure no duplicate group names exist", "6.2 Local User and Group Settings", "Level1", True, "CommandOutputEmpty",
                      audit_command="cut -f1 -d: /etc/group | sort | uniq -d",
                      description="Duplicate group names can cause security and operational issues.",
                      remediation="Ensure each group has a unique name."),
        create_control("6.2.8", "Ensure root path integrity", "6.2 Local User and Group Settings", "Level1", True, "FileContent",
                      file_path="/etc/securetty", pattern="^console|^tty[0-9]", expected_result="found",
                      description="Ensure root can only log in from secure terminals.",
                      remediation="Edit /etc/securetty and ensure only secure terminals are listed."),
        create_control("6.2.9", "Ensure root is the only UID 0 account", "6.2 Local User and Group Settings", "Level1", True, "CommandOutputEmpty",
                      audit_command="awk -F: '($3 == 0) {print $1}' /etc/passwd | grep -v '^root$'",
                      description="Any account with UID 0 has superuser privileges on the system.",
                      remediation="Ensure only root has UID 0. Remove or change UID of any other accounts with UID 0."),
        create_control("6.2.10", "Ensure local interactive user home directories are configured", "6.2 Local User and Group Settings", "Level1", True, "FilePermissions",
                      file_path="/home", expected_permissions="0755", expected_owner="root", expected_group="root",
                      description="User home directories should have appropriate permissions.",
                      remediation="Run: chmod 755 /home && chown root:root /home. For each user: chmod 700 /home/<user> && chown <user>:<user> /home/<user>"),
        create_control("6.2.11", "Ensure local interactive user dot files access is configured", "6.2 Local User and Group Settings", "Level1", True, "FilePermissions",
                      file_path="/home", expected_permissions="0700", expected_owner="user", expected_group="user",
                      description="User dot files should have restrictive permissions.",
                      remediation="For each user: find /home/<user> -name '.*' -type f -exec chmod 600 {} \\; && find /home/<user> -name '.*' -type d -exec chmod 700 {} \\;"),
    ]
    return create_milestone("6.2", "6 System Maintenance", "Section 6.2 User and Group Settings", controls)

# Main execution
if __name__ == "__main__":
    milestones_dir = "../milestones"
    os.makedirs(milestones_dir, exist_ok=True)
    
    milestones = [
        milestone_1_2_remaining(),
        milestone_1_2_3(),
        milestone_1_2_4(),
        milestone_1_2_5(),
        milestone_1_2_6(),
        milestone_1_2_7(),
        milestone_1_3(),
        milestone_1_4(),
        milestone_1_5(),
        milestone_1_6(),
        milestone_1_7(),
        milestone_2_1(),
        milestone_2_2(),
        milestone_2_3(),
        milestone_3_1(),
        milestone_3_2(),
        milestone_3_3(),
        milestone_3_4(),
        milestone_4_1(),
        milestone_4_2(),
        milestone_4_3(),
        milestone_4_4(),
        milestone_4_5(),
        milestone_5_1(),
        milestone_5_2(),
        milestone_5_3(),
        milestone_6_1(),
        milestone_6_2(),
    ]
    
    for milestone in milestones:
        milestone_id = milestone["milestone"].replace(".", "-")
        filename = f"{milestones_dir}/milestone-{milestone_id}.json"
        with open(filename, "w") as f:
            json.dump(milestone, f, indent=2)
        print(f"Created {filename}")