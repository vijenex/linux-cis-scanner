{
  "milestone": "6.2",
  "version": "1.0.0",
  "description": "Amazon Linux 2 CIS Benchmark v3.0.0 - Section 6.2 User and Group Settings",
  "section": "6 System Maintenance",
  "controls": [
    {
      "id": "6.2.1",
      "title": "Ensure accounts in /etc/passwd use shadowed passwords",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.1 | Level1",
      "description": "Shadow passwords provide an additional layer of security by storing password hashes in /etc/shadow instead of /etc/passwd.",
      "remediation": "Ensure all accounts use shadowed passwords. Run: pwconv",
      "file_path": "/etc/passwd",
      "pattern": "^[^:]*:[^:]*:[^:]*:[^:]*:[^:]*:[^:]*:[^:]*$",
      "expected_result": "found"
    },
    {
      "id": "6.2.2",
      "title": "Ensure /etc/shadow password fields are not empty",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.2 | Level1",
      "description": "Accounts with empty password fields represent a significant security risk.",
      "remediation": "Lock or remove accounts with empty password fields.",
      "audit_command": "awk -F: '($2 == \"\" || $2 == \"!\") {print $1}' /etc/shadow"
    },
    {
      "id": "6.2.3",
      "title": "Ensure all groups in /etc/passwd exist in /etc/group",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.3 | Level1",
      "description": "Groups defined in /etc/passwd but not in /etc/group can cause security issues.",
      "remediation": "Ensure all groups referenced in /etc/passwd exist in /etc/group.",
      "audit_command": "for i in $(cut -s -d: -f4 /etc/passwd | sort -u); do grep -q -P \"^.*?:[^:]*:$i:\" /etc/group; if [ $? -ne 0 ]; then echo \"Group $i is referenced by /etc/passwd but does not exist in /etc/group\"; fi; done"
    },
    {
      "id": "6.2.4",
      "title": "Ensure no duplicate UIDs exist",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.4 | Level1",
      "description": "Duplicate UIDs can cause security and operational issues.",
      "remediation": "Ensure each user has a unique UID.",
      "audit_command": "cut -f3 -d: /etc/passwd | sort -n | uniq -d"
    },
    {
      "id": "6.2.5",
      "title": "Ensure no duplicate GIDs exist",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.5 | Level1",
      "description": "Duplicate GIDs can cause security and operational issues.",
      "remediation": "Ensure each group has a unique GID.",
      "audit_command": "cut -f3 -d: /etc/group | sort -n | uniq -d"
    },
    {
      "id": "6.2.6",
      "title": "Ensure no duplicate user names exist",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.6 | Level1",
      "description": "Duplicate user names can cause security and operational issues.",
      "remediation": "Ensure each user has a unique name.",
      "audit_command": "cut -f1 -d: /etc/passwd | sort | uniq -d"
    },
    {
      "id": "6.2.7",
      "title": "Ensure no duplicate group names exist",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.7 | Level1",
      "description": "Duplicate group names can cause security and operational issues.",
      "remediation": "Ensure each group has a unique name.",
      "audit_command": "cut -f1 -d: /etc/group | sort | uniq -d"
    },
    {
      "id": "6.2.8",
      "title": "Ensure root path integrity",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.8 | Level1",
      "description": "Ensure root can only log in from secure terminals.",
      "remediation": "Edit /etc/securetty and ensure only secure terminals are listed.",
      "file_path": "/etc/securetty",
      "pattern": "^console|^tty[0-9]",
      "expected_result": "found"
    },
    {
      "id": "6.2.9",
      "title": "Ensure root is the only UID 0 account",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.9 | Level1",
      "description": "Any account with UID 0 has superuser privileges on the system.",
      "remediation": "Ensure only root has UID 0. Remove or change UID of any other accounts with UID 0.",
      "audit_command": "awk -F: '($3 == 0) {print $1}' /etc/passwd | grep -v '^root$'"
    },
    {
      "id": "6.2.10",
      "title": "Ensure local interactive user home directories are configured",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermissions",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.10 | Level1",
      "description": "User home directories should have appropriate permissions.",
      "remediation": "Run: chmod 755 /home && chown root:root /home. For each user: chmod 700 /home/<user> && chown <user>:<user> /home/<user>",
      "file_path": "/home",
      "expected_permissions": "0755",
      "expected_owner": "root",
      "expected_group": "root"
    },
    {
      "id": "6.2.11",
      "title": "Ensure local interactive user dot files access is configured",
      "section": "6.2 Local User and Group Settings",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermissions",
      "cis_reference": "CIS Amazon Linux 2 - 6.2.11 | Level1",
      "description": "User dot files should have restrictive permissions.",
      "remediation": "For each user: find /home/<user> -name '.*' -type f -exec chmod 600 {} \\; && find /home/<user> -name '.*' -type d -exec chmod 700 {} \\;",
      "file_path": "/home",
      "expected_permissions": "0700",
      "expected_owner": "user",
      "expected_group": "user"
    }
  ]
}