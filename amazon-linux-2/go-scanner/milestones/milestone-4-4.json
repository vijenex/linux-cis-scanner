{
  "milestone": "4.4",
  "version": "1.0.0",
  "description": "Amazon Linux 2 CIS Benchmark v3.0.0 - Section 4.4 Configure Pluggable Authentication Modules",
  "section": "4 Access, Authentication and Authorization",
  "controls": [
    {
      "id": "4.4.1.1",
      "title": "Ensure latest version of pam is installed",
      "section": "4.4.1 Configure PAM software packages",
      "profile": "Level1",
      "automated": true,
      "type": "PackageInstalled",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.1.1 | Level1",
      "description": "PAM provides authentication services. Ensure the latest version is installed.",
      "remediation": "Run: yum update pam",
      "package_name": "pam",
      "expected_status": "installed"
    },
    {
      "id": "4.4.1.2",
      "title": "Ensure libpwquality is installed",
      "section": "4.4.1 Configure PAM software packages",
      "profile": "Level1",
      "automated": true,
      "type": "PackageInstalled",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.1.2 | Level1",
      "description": "libpwquality provides password quality checking functionality.",
      "remediation": "Run: yum install libpwquality",
      "package_name": "libpwquality",
      "expected_status": "installed"
    },
    {
      "id": "4.4.2.1.1",
      "title": "Ensure pam_faillock module is enabled",
      "section": "4.4.2.1 Configure pam_faillock module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.1.1 | Level1",
      "description": "The pam_faillock module provides account lockout functionality.",
      "remediation": "Edit /etc/pam.d/system-auth and add: auth required pam_faillock.so preauth",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "pam_faillock",
      "expected_value": "enabled"
    },
    {
      "id": "4.4.2.1.2",
      "title": "Ensure password failed attempts lockout is configured",
      "section": "4.4.2.1 Configure pam_faillock module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.1.2 | Level1",
      "description": "Configure account lockout after failed password attempts.",
      "remediation": "Edit /etc/pam.d/system-auth and configure: auth required pam_faillock.so preauth deny=5",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "deny",
      "expected_value": "5"
    },
    {
      "id": "4.4.2.1.3",
      "title": "Ensure password unlock time is configured",
      "section": "4.4.2.1 Configure pam_faillock module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.1.3 | Level1",
      "description": "Configure the time before a locked account is automatically unlocked.",
      "remediation": "Edit /etc/pam.d/system-auth and configure: auth required pam_faillock.so preauth unlock_time=900",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "unlock_time",
      "expected_value": "900"
    },
    {
      "id": "4.4.2.1.4",
      "title": "Ensure password failed attempts lockout includes root account",
      "section": "4.4.2.1 Configure pam_faillock module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.1.4 | Level1",
      "description": "Account lockout should apply to the root account as well.",
      "remediation": "Edit /etc/pam.d/system-auth and configure: auth required pam_faillock.so preauth even_deny_root",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "even_deny_root",
      "expected_value": "enabled"
    },
    {
      "id": "4.4.2.2.1",
      "title": "Ensure pam_pwquality module is enabled",
      "section": "4.4.2.2 Configure pam_pwquality module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.2.1 | Level1",
      "description": "The pam_pwquality module checks password strength.",
      "remediation": "Edit /etc/pam.d/system-auth and add: password requisite pam_pwquality.so",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "pam_pwquality",
      "expected_value": "enabled"
    },
    {
      "id": "4.4.2.2.2",
      "title": "Ensure password number of changed characters is configured",
      "section": "4.4.2.2 Configure pam_pwquality module",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.2.2 | Level1",
      "description": "Configure minimum number of character classes required in passwords.",
      "remediation": "Edit /etc/security/pwquality.conf and set: minclass = 4",
      "file_path": "/etc/security/pwquality.conf",
      "pattern": "^minclass",
      "expected_result": "found"
    },
    {
      "id": "4.4.2.2.3",
      "title": "Ensure password length is configured",
      "section": "4.4.2.2 Configure pam_pwquality module",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.2.3 | Level1",
      "description": "Configure minimum password length.",
      "remediation": "Edit /etc/security/pwquality.conf and set: minlen = 14",
      "file_path": "/etc/security/pwquality.conf",
      "pattern": "^minlen\\s*=\\s*1[4-9]|[2-9][0-9]",
      "expected_result": "found"
    },
    {
      "id": "4.4.2.2.4",
      "title": "Ensure password complexity is configured",
      "section": "4.4.2.2 Configure pam_pwquality module",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.2.4 | Level1",
      "description": "Configure password complexity requirements.",
      "remediation": "Edit /etc/security/pwquality.conf and configure: dcredit=-1 ucredit=-1 ocredit=-1 lcredit=-1"
    },
    {
      "id": "4.4.2.2.5",
      "title": "Ensure password same consecutive characters is configured",
      "section": "4.4.2.2 Configure pam_pwquality module",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.2.5 | Level1",
      "description": "Limit the number of consecutive identical characters in passwords.",
      "remediation": "Edit /etc/security/pwquality.conf and set: maxrepeat = 3",
      "file_path": "/etc/security/pwquality.conf",
      "pattern": "^maxrepeat",
      "expected_result": "found"
    },
    {
      "id": "4.4.2.2.6",
      "title": "Ensure password maximum sequential characters is configured",
      "section": "4.4.2.2 Configure pam_pwquality module",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.2.6 | Level1",
      "description": "Limit the number of sequential characters in passwords.",
      "remediation": "Edit /etc/security/pwquality.conf and set: maxsequence = 4",
      "file_path": "/etc/security/pwquality.conf",
      "pattern": "^maxsequence",
      "expected_result": "found"
    },
    {
      "id": "4.4.2.2.7",
      "title": "Ensure password dictionary check is enabled",
      "section": "4.4.2.2 Configure pam_pwquality module",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.2.7 | Level1",
      "description": "Enable dictionary checking for passwords.",
      "remediation": "Edit /etc/security/pwquality.conf and set: dictcheck = 1",
      "file_path": "/etc/security/pwquality.conf",
      "pattern": "^dictcheck",
      "expected_result": "found"
    },
    {
      "id": "4.4.2.3.1",
      "title": "Ensure pam_pwhistory module is enabled",
      "section": "4.4.2.3 Configure pam_pwhistory module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.3.1 | Level1",
      "description": "The pam_pwhistory module prevents password reuse.",
      "remediation": "Edit /etc/pam.d/system-auth and add: password required pam_pwhistory.so",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "pam_pwhistory",
      "expected_value": "enabled"
    },
    {
      "id": "4.4.2.3.2",
      "title": "Ensure password history remember is configured",
      "section": "4.4.2.3 Configure pam_pwhistory module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.3.2 | Level1",
      "description": "Configure the number of previous passwords to remember.",
      "remediation": "Edit /etc/pam.d/system-auth and configure: password required pam_pwhistory.so remember=5",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "remember",
      "expected_value": "5"
    },
    {
      "id": "4.4.2.3.3",
      "title": "Ensure password history is enforced for the root user",
      "section": "4.4.2.3 Configure pam_pwhistory module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.3.3 | Level1",
      "description": "Password history should be enforced for the root user.",
      "remediation": "Edit /etc/pam.d/system-auth and configure: password required pam_pwhistory.so enforce_for_root",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "enforce_for_root",
      "expected_value": "enabled"
    },
    {
      "id": "4.4.2.3.4",
      "title": "Ensure pam_pwhistory includes use_authtok",
      "section": "4.4.2.3 Configure pam_pwhistory module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.3.4 | Level1",
      "description": "The use_authtok option ensures the password from the previous module is used.",
      "remediation": "Edit /etc/pam.d/system-auth and configure: password required pam_pwhistory.so use_authtok",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "use_authtok",
      "expected_value": "enabled"
    },
    {
      "id": "4.4.2.4.1",
      "title": "Ensure pam_unix does not include nullok",
      "section": "4.4.2.4 Configure pam_unix module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.4.1 | Level1",
      "description": "The nullok option allows accounts with empty passwords. This should be disabled.",
      "remediation": "Ensure nullok is not present in pam_unix entries in /etc/pam.d/system-auth",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "nullok",
      "expected_value": "not_found"
    },
    {
      "id": "4.4.2.4.2",
      "title": "Ensure pam_unix does not include remember",
      "section": "4.4.2.4 Configure pam_unix module",
      "profile": "Level1",
      "automated": true,
      "type": "PAMConfig",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.4.2 | Level1",
      "description": "The remember option should be in pam_pwhistory, not pam_unix.",
      "remediation": "Ensure remember is not present in pam_unix entries in /etc/pam.d/system-auth",
      "file_path": "/etc/pam.d/system-auth",
      "parameter": "remember",
      "expected_value": "not_found"
    },
    {
      "id": "4.4.2.4.3",
      "title": "Ensure pam_unix includes a strong password hashing algorithm",
      "section": "4.4.2.4 Configure pam_unix module",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.4.3 | Level1",
      "description": "Use SHA-512 for password hashing instead of weaker algorithms.",
      "remediation": "Edit /etc/pam.d/system-auth and ensure: password sufficient pam_unix.so sha512",
      "file_path": "/etc/pam.d/password-auth /etc/pam.d/system-auth",
      "pattern": "^\\s*password\\s+sufficient\\s+pam_unix.so.*(sha512|yescrypt)",
      "expected_result": "found"
    },
    {
      "id": "4.4.2.4.4",
      "title": "Ensure pam_unix includes use_authtok",
      "section": "4.4.2.4 Configure pam_unix module",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.4.2.4.4 | Level1",
      "description": "The use_authtok option ensures the password from the previous module is used.",
      "remediation": "Edit /etc/pam.d/system-auth and configure: password sufficient pam_unix.so use_authtok",
      "file_path": "/etc/pam.d/password-auth /etc/pam.d/system-auth",
      "pattern": "^\\s*password\\s+sufficient\\s+pam_unix.so.*use_authtok",
      "expected_result": "found"
    }
  ]
}