{
  "milestone": "3.4",
  "version": "1.0.0",
  "description": "Amazon Linux 2 CIS Benchmark v3.0.0 - Section 3.4 Configure Host Based Firewall",
  "section": "3 Network",
  "controls": [
    {
      "id": "3.4.1.1",
      "title": "Ensure iptables is installed",
      "section": "3.4.1 Configure firewall utility",
      "profile": "Level1",
      "automated": true,
      "type": "PackageInstalled",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.1.1 | Level1",
      "description": "iptables is a utility program that allows a system administrator to configure the tables provided by the Linux kernel firewall.",
      "remediation": "Run the following command to install iptables: # yum install iptables",
      "package_name": "iptables",
      "expected_status": "installed"
    },
    {
      "id": "3.4.1.2",
      "title": "Ensure a single firewall configuration utility is in use",
      "section": "3.4.1 Configure firewall utility",
      "profile": "Level1",
      "automated": true,
      "type": "ServiceStatus",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.1.2 | Level1",
      "description": "Only one firewall configuration utility should be in use to avoid conflicts. firewalld, nftables, or iptables should be chosen based on site policy.",
      "remediation": "Choose one firewall utility (firewalld, nftables, or iptables) and ensure only that one is installed and enabled.",
      "service_name": "firewalld",
      "expected_status": "enabled"
    },
    {
      "id": "3.4.2.1",
      "title": "Ensure firewalld is installed",
      "section": "3.4.2 Configure firewalld",
      "profile": "Level1",
      "automated": true,
      "type": "PackageInstalled",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.2.1 | Level1",
      "description": "firewalld is a firewall management daemon for Linux systems. It provides a way to configure the system to accept, reject, or forward network connections.",
      "remediation": "Run the following command to install firewalld: # yum install firewalld",
      "package_name": "firewalld",
      "expected_status": "installed"
    },
    {
      "id": "3.4.2.2",
      "title": "Ensure firewalld service enabled and running",
      "section": "3.4.2 Configure firewalld",
      "profile": "Level1",
      "automated": true,
      "type": "ServiceStatus",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.2.2 | Level1",
      "description": "The firewalld service must be enabled and running to provide firewall protection for the system.",
      "remediation": "Run the following commands to enable and start firewalld: # systemctl enable firewalld && systemctl start firewalld",
      "service_name": "firewalld",
      "expected_status": "enabled"
    },
    {
      "id": "3.4.2.3",
      "title": "Ensure firewalld drops unnecessary services and ports",
      "section": "3.4.2 Configure firewalld",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.2.3 | Level1",
      "description": "Only necessary services and ports should be allowed through the firewall.",
      "remediation": "Review firewall rules: # firewall-cmd --list-all. Remove unnecessary services and ports."
    },
    {
      "id": "3.4.2.4",
      "title": "Ensure network interfaces are assigned to appropriate zone",
      "section": "3.4.2 Configure firewalld",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.2.4 | Level1",
      "description": "Network interfaces should be assigned to appropriate firewalld zones based on their trust level.",
      "remediation": "Run: # firewall-cmd --get-active-zones. Assign interfaces to zones: # firewall-cmd --zone=<zone> --change-interface=<interface>"
    },
    {
      "id": "3.4.3.1",
      "title": "Ensure nftables is installed",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": true,
      "type": "PackageInstalled",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.1 | Level1",
      "description": "nftables is a subsystem of the Linux kernel providing filtering and classification of network packets.",
      "remediation": "Run the following command to install nftables: # yum install nftables",
      "package_name": "nftables",
      "expected_status": "installed"
    },
    {
      "id": "3.4.3.2",
      "title": "Ensure iptables are flushed with nftables",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.2 | Level1",
      "description": "When using nftables, iptables rules should be flushed to avoid conflicts.",
      "remediation": "Run: # iptables -F && # ip6tables -F && # iptables -X && # ip6tables -X"
    },
    {
      "id": "3.4.3.3",
      "title": "Ensure an nftables table exists",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.3 | Level1",
      "description": "nftables requires at least one table to be defined.",
      "remediation": "Create a table: # nft create table inet filter",
      "audit_command": "nft list tables"
    },
    {
      "id": "3.4.3.4",
      "title": "Ensure nftables base chains exist",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": true,
      "type": "CommandOutputEmpty",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.4 | Level1",
      "description": "nftables requires base chains for input, forward, and output.",
      "remediation": "Create base chains: # nft create chain inet filter input { type filter hook input priority 0 \\; }",
      "audit_command": "nft list chains"
    },
    {
      "id": "3.4.3.5",
      "title": "Ensure nftables loopback traffic is configured",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.5 | Level1",
      "description": "Loopback traffic should be allowed.",
      "remediation": "Add rule to nftables configuration: iif lo accept",
      "file_path": "/etc/nftables.conf",
      "pattern": "iif.*lo.*accept|iif.*loopback.*accept",
      "expected_result": "found"
    },
    {
      "id": "3.4.3.6",
      "title": "Ensure nftables outbound and established connections are configured",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.6 | Level1",
      "description": "Outbound and established connections should be allowed.",
      "remediation": "Configure nftables rules to allow outbound and established connections."
    },
    {
      "id": "3.4.3.7",
      "title": "Ensure nftables default deny firewall policy",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.7 | Level1",
      "description": "The default firewall policy should be deny/drop.",
      "remediation": "Set default policy: # nft chain inet filter input { policy drop \\; }",
      "file_path": "/etc/nftables.conf",
      "pattern": "policy.*drop|policy.*deny",
      "expected_result": "found"
    },
    {
      "id": "3.4.3.8",
      "title": "Ensure nftables service is enabled and active",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": true,
      "type": "ServiceStatus",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.8 | Level1",
      "description": "The nftables service must be enabled and running.",
      "remediation": "Run: # systemctl enable nftables && systemctl start nftables",
      "service_name": "nftables",
      "expected_status": "enabled"
    },
    {
      "id": "3.4.3.9",
      "title": "Ensure nftables rules are permanent",
      "section": "3.4.3 Configure nftables",
      "profile": "Level1",
      "automated": true,
      "type": "FileExists",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.3.9 | Level1",
      "description": "nftables rules should be saved to a configuration file to persist across reboots.",
      "remediation": "Save rules: # nft list ruleset > /etc/nftables.conf",
      "file_path": "/etc/nftables.conf",
      "expected_status": "exists"
    },
    {
      "id": "3.4.4.1.1",
      "title": "Ensure iptables packages are installed",
      "section": "3.4.4.1 Configure iptables software",
      "profile": "Level1",
      "automated": true,
      "type": "PackageInstalled",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.1.1 | Level1",
      "description": "iptables is a utility program that allows a system administrator to configure the tables provided by the Linux kernel firewall.",
      "remediation": "Run the following command to install iptables: # yum install iptables iptables-services",
      "package_name": "iptables",
      "expected_status": "installed"
    },
    {
      "id": "3.4.4.2.1",
      "title": "Ensure iptables loopback traffic is configured",
      "section": "3.4.4.2 Configure iptables",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.2.1 | Level1",
      "description": "Loopback traffic should be allowed.",
      "remediation": "Add rule: -A INPUT -i lo -j ACCEPT",
      "file_path": "/etc/sysconfig/iptables",
      "pattern": "-A INPUT -i lo -j ACCEPT",
      "expected_result": "found"
    },
    {
      "id": "3.4.4.2.2",
      "title": "Ensure iptables outbound and established connections are configured",
      "section": "3.4.4.2 Configure iptables",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.2.2 | Level1",
      "description": "Outbound and established connections should be allowed.",
      "remediation": "Configure iptables rules to allow outbound and established connections."
    },
    {
      "id": "3.4.4.2.3",
      "title": "Ensure iptables rules exist for all open ports",
      "section": "3.4.4.2 Configure iptables",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.2.3 | Level1",
      "description": "Firewall rules should exist for all open ports.",
      "remediation": "Add iptables rules for all open ports.",
      "file_path": "/etc/sysconfig/iptables",
      "pattern": "-A INPUT.*-p.*--dport",
      "expected_result": "found"
    },
    {
      "id": "3.4.4.2.4",
      "title": "Ensure iptables default deny firewall policy",
      "section": "3.4.4.2 Configure iptables",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.2.4 | Level1",
      "description": "The default firewall policy should be deny/drop.",
      "remediation": "Set default policies: -P INPUT DROP -P FORWARD DROP -P OUTPUT ACCEPT",
      "file_path": "/etc/sysconfig/iptables",
      "pattern": "-P INPUT DROP|-P FORWARD DROP",
      "expected_result": "found"
    },
    {
      "id": "3.4.4.2.5",
      "title": "Ensure iptables rules are saved",
      "section": "3.4.4.2 Configure iptables",
      "profile": "Level1",
      "automated": true,
      "type": "FileExists",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.2.5 | Level1",
      "description": "iptables rules should be saved to persist across reboots.",
      "remediation": "Save rules: # service iptables save or # iptables-save > /etc/sysconfig/iptables",
      "file_path": "/etc/sysconfig/iptables",
      "expected_status": "exists"
    },
    {
      "id": "3.4.4.2.6",
      "title": "Ensure iptables service is enabled and active",
      "section": "3.4.4.2 Configure iptables",
      "profile": "Level1",
      "automated": true,
      "type": "ServiceStatus",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.2.6 | Level1",
      "description": "The iptables service must be enabled and running.",
      "remediation": "Run: # systemctl enable iptables && systemctl start iptables",
      "service_name": "iptables",
      "expected_status": "enabled"
    },
    {
      "id": "3.4.4.3.1",
      "title": "Ensure ip6tables loopback traffic is configured",
      "section": "3.4.4.3 Configure ip6tables",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.3.1 | Level1",
      "description": "Loopback traffic should be allowed for IPv6.",
      "remediation": "Add rule: -A INPUT -i lo -j ACCEPT",
      "file_path": "/etc/sysconfig/ip6tables",
      "pattern": "-A INPUT -i lo -j ACCEPT",
      "expected_result": "found"
    },
    {
      "id": "3.4.4.3.2",
      "title": "Ensure ip6tables outbound and established connections are configured",
      "section": "3.4.4.3 Configure ip6tables",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.3.2 | Level1",
      "description": "Outbound and established connections should be allowed for IPv6.",
      "remediation": "Configure ip6tables rules to allow outbound and established connections."
    },
    {
      "id": "3.4.4.3.3",
      "title": "Ensure ip6tables firewall rules exist for all open ports",
      "section": "3.4.4.3 Configure ip6tables",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.3.3 | Level1",
      "description": "Firewall rules should exist for all open IPv6 ports.",
      "remediation": "Add ip6tables rules for all open ports.",
      "file_path": "/etc/sysconfig/ip6tables",
      "pattern": "-A INPUT.*-p.*--dport",
      "expected_result": "found"
    },
    {
      "id": "3.4.4.3.4",
      "title": "Ensure ip6tables default deny firewall policy",
      "section": "3.4.4.3 Configure ip6tables",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.3.4 | Level1",
      "description": "The default IPv6 firewall policy should be deny/drop.",
      "remediation": "Set default policies: -P INPUT DROP -P FORWARD DROP -P OUTPUT ACCEPT",
      "file_path": "/etc/sysconfig/ip6tables",
      "pattern": "-P INPUT DROP|-P FORWARD DROP",
      "expected_result": "found"
    },
    {
      "id": "3.4.4.3.5",
      "title": "Ensure ip6tables rules are saved",
      "section": "3.4.4.3 Configure ip6tables",
      "profile": "Level1",
      "automated": true,
      "type": "FileExists",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.3.5 | Level1",
      "description": "ip6tables rules should be saved to persist across reboots.",
      "remediation": "Save rules: # service ip6tables save or # ip6tables-save > /etc/sysconfig/ip6tables",
      "file_path": "/etc/sysconfig/ip6tables",
      "expected_status": "exists"
    },
    {
      "id": "3.4.4.3.6",
      "title": "Ensure ip6tables is enabled and active",
      "section": "3.4.4.3 Configure ip6tables",
      "profile": "Level1",
      "automated": true,
      "type": "ServiceStatus",
      "cis_reference": "CIS Amazon Linux 2 - 3.4.4.3.6 | Level1",
      "description": "The ip6tables service must be enabled and running.",
      "remediation": "Run: # systemctl enable ip6tables && systemctl start ip6tables",
      "service_name": "ip6tables",
      "expected_status": "enabled"
    }
  ]
}