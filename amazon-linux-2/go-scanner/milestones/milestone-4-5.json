{
  "milestone": "4.5",
  "version": "1.0.0",
  "description": "Amazon Linux 2 CIS Benchmark v3.0.0 - Section 4.5 User Accounts and Environment",
  "section": "4 Access, Authentication and Authorization",
  "controls": [
    {
      "id": "4.5.1.1",
      "title": "Ensure strong password hashing algorithm is configured",
      "section": "4.5.1 Configure shadow password suite parameters",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.1.1 | Level1",
      "description": "Use SHA-512 for password hashing instead of weaker algorithms.",
      "remediation": "Edit /etc/login.defs and set: ENCRYPT_METHOD SHA512",
      "file_path": "/etc/login.defs",
      "pattern": "^ENCRYPT_METHOD\\s+SHA512",
      "expected_result": "found"
    },
    {
      "id": "4.5.1.2",
      "title": "Ensure password expiration is 365 days or less",
      "section": "4.5.1 Configure shadow password suite parameters",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.1.2 | Level1",
      "description": "Passwords should expire after a reasonable period to force regular password changes.",
      "remediation": "Edit /etc/login.defs and set: PASS_MAX_DAYS 365",
      "file_path": "/etc/login.defs",
      "pattern": "^PASS_MAX_DAYS\\s+([0-9]|[1-9][0-9]|[1-2][0-9][0-9]|3[0-5][0-9]|36[0-5])",
      "expected_result": "found"
    },
    {
      "id": "4.5.1.3",
      "title": "Ensure password expiration warning days is 7 or more",
      "section": "4.5.1 Configure shadow password suite parameters",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.1.3 | Level1",
      "description": "Users should be warned before their passwords expire.",
      "remediation": "Edit /etc/login.defs and set: PASS_WARN_AGE 7",
      "file_path": "/etc/login.defs",
      "pattern": "^PASS_WARN_AGE\\s+[7-9]|[1-9][0-9]",
      "expected_result": "found"
    },
    {
      "id": "4.5.1.4",
      "title": "Ensure inactive password lock is 30 days or less",
      "section": "4.5.1 Configure shadow password suite parameters",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.1.4 | Level1",
      "description": "Accounts that have been inactive for too long should be locked.",
      "remediation": "Edit /etc/default/useradd and set: INACTIVE=30",
      "file_path": "/etc/default/useradd",
      "pattern": "^INACTIVE\\s+([0-9]|[12][0-9]|30)",
      "expected_result": "found"
    },
    {
      "id": "4.5.1.5",
      "title": "Ensure all users last password change date is in the past",
      "section": "4.5.1 Configure shadow password suite parameters",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.1.5 | Level1",
      "description": "All user accounts should have a password change date set.",
      "remediation": "Review /etc/shadow and ensure all users have a valid password change date."
    },
    {
      "id": "4.5.2.1",
      "title": "Ensure default group for the root account is GID 0",
      "section": "4.5.2 Configure root and system accounts and environment",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.2.1 | Level1",
      "description": "The root account should have GID 0.",
      "remediation": "Ensure root account in /etc/passwd has GID 0",
      "file_path": "/etc/passwd",
      "pattern": "^root:.*:0:0:",
      "expected_result": "found"
    },
    {
      "id": "4.5.2.2",
      "title": "Ensure root user umask is configured",
      "section": "4.5.2 Configure root and system accounts and environment",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.2.2 | Level1",
      "description": "The root user's umask should be restrictive.",
      "remediation": "Edit /etc/bashrc and /etc/profile and add: umask 027 or umask 077",
      "file_path": "/etc/bashrc",
      "pattern": "umask\\s+027|umask\\s+077",
      "expected_result": "found"
    },
    {
      "id": "4.5.2.3",
      "title": "Ensure system accounts are secured",
      "section": "4.5.2 Configure root and system accounts and environment",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.2.3 | Level1",
      "description": "System accounts should not have login shells or home directories unless necessary.",
      "remediation": "Review /etc/passwd and ensure system accounts have /sbin/nologin or /bin/false as shell."
    },
    {
      "id": "4.5.2.4",
      "title": "Ensure root password is set",
      "section": "4.5.2 Configure root and system accounts and environment",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.2.4 | Level1",
      "description": "The root account must have a password set.",
      "remediation": "Set a password for the root account: # passwd root",
      "file_path": "/etc/shadow",
      "pattern": "^root:.*:.*:.*:.*:.*:.*:.*:.*",
      "expected_result": "found"
    },
    {
      "id": "4.5.3.1",
      "title": "Ensure nologin is not listed in /etc/shells",
      "section": "4.5.3 Configure user default environment",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.3.1 | Level1",
      "description": "The /etc/shells file should only contain valid login shells.",
      "remediation": "Remove nologin and false from /etc/shells if present.",
      "file_path": "/etc/shells",
      "pattern": "nologin|false",
      "expected_result": "not_found"
    },
    {
      "id": "4.5.3.2",
      "title": "Ensure default user shell timeout is configured",
      "section": "4.5.3 Configure user default environment",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.3.2 | Level1",
      "description": "Configure shell timeout to automatically log out idle users.",
      "remediation": "Edit /etc/bashrc and /etc/profile and add: TMOUT=600",
      "file_path": "/etc/bashrc",
      "pattern": "TMOUT",
      "expected_result": "found"
    },
    {
      "id": "4.5.3.3",
      "title": "Ensure default user umask is configured",
      "section": "4.5.3 Configure user default environment",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 4.5.3.3 | Level1",
      "description": "Configure default umask for users to restrict file permissions.",
      "remediation": "Edit /etc/bashrc and /etc/profile and add: umask 027 or umask 022",
      "file_path": "/etc/bashrc",
      "pattern": "umask\\s+027|umask\\s+022",
      "expected_result": "found"
    }
  ]
}