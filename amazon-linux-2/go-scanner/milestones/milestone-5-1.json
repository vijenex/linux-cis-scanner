{
  "milestone": "5.1",
  "version": "1.0.0",
  "description": "Amazon Linux 2 CIS Benchmark v3.0.0 - Section 5.1 Configure Logging",
  "section": "5 Logging and Auditing",
  "controls": [
    {
      "id": "5.1.1.1",
      "title": "Ensure rsyslog is installed",
      "section": "5.1.1 Configure rsyslog",
      "profile": "Level1",
      "automated": true,
      "type": "PackageInstalled",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.1.1 | Level1",
      "description": "rsyslog is the default syslog daemon on Amazon Linux 2. It provides logging capabilities for the system.",
      "remediation": "Run the following command to install rsyslog: # yum install rsyslog",
      "package_name": "rsyslog",
      "expected_status": "installed"
    },
    {
      "id": "5.1.1.2",
      "title": "Ensure rsyslog service is enabled",
      "section": "5.1.1 Configure rsyslog",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.1.2 | Level1",
      "description": "Enable rsyslog service to collect system logs.",
      "remediation": "Run the following command to enable rsyslog: # systemctl enable rsyslog"
    },
    {
      "id": "5.1.1.3",
      "title": "Ensure journald is configured to send logs to rsyslog",
      "section": "5.1.1 Configure rsyslog",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.1.3 | Level1",
      "description": "Data from journald may be stored in volatile memory or persisted locally. It is recommended that journald be configured to send logs to rsyslog.",
      "remediation": "Edit /etc/systemd/journald.conf and set ForwardToSyslog=yes"
    },
    {
      "id": "5.1.1.4",
      "title": "Ensure rsyslog default file permissions are configured",
      "section": "5.1.1 Configure rsyslog",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.1.4 | Level1",
      "description": "rsyslog will create logfiles that do not already exist on the system. It is important to ensure that logfiles have appropriate permissions.",
      "remediation": "Edit /etc/rsyslog.conf and set $FileCreateMode 0640",
      "file_path": "/etc/rsyslog.conf",
      "pattern": "\\$FileCreateMode",
      "expected_result": "found"
    },
    {
      "id": "5.1.1.5",
      "title": "Ensure logging is configured",
      "section": "5.1.1 Configure rsyslog",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.1.5 | Level1",
      "description": "Configure rsyslog to send logs to a remote log host for centralized logging.",
      "remediation": "Edit /etc/rsyslog.conf and configure remote logging: *.* @@<loghost>"
    },
    {
      "id": "5.1.1.6",
      "title": "Ensure rsyslog is configured to send logs to a remote log host",
      "section": "5.1.1 Configure rsyslog",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.1.6 | Level1",
      "description": "Centralized logging helps with log analysis and security monitoring.",
      "remediation": "Edit /etc/rsyslog.conf and configure: *.* @@<remote_log_host>"
    },
    {
      "id": "5.1.1.7",
      "title": "Ensure rsyslog is not configured to receive logs from a remote client",
      "section": "5.1.1 Configure rsyslog",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.1.7 | Level1",
      "description": "Receiving logs from remote clients can expose the system to security risks.",
      "remediation": "Remove or comment out any lines in /etc/rsyslog.conf that load imtcp or imudp modules or start TCP/UDP servers.",
      "file_path": "/etc/rsyslog.conf",
      "pattern": "^\\$ModLoad.*imtcp|^\\$ModLoad.*imudp|^\\$InputTCPServerRun|^\\$InputUDPServerRun",
      "expected_result": "not_found"
    },
    {
      "id": "5.1.2.1.1",
      "title": "Ensure systemd-journal-remote is installed",
      "section": "5.1.2.1 Configure journald",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.1.1 | Level1",
      "description": "systemd-journal-remote is required for remote journal logging.",
      "remediation": "Run: yum install systemd-journal-remote"
    },
    {
      "id": "5.1.2.1.2",
      "title": "Ensure systemd-journal-remote is configured",
      "section": "5.1.2.1 Configure journald",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.1.2 | Level1",
      "description": "Configure systemd-journal-remote to send logs to a remote host.",
      "remediation": "Edit /etc/systemd/journal-upload.conf and configure URL=<remote_host>"
    },
    {
      "id": "5.1.2.1.3",
      "title": "Ensure systemd-journal-remote is enabled",
      "section": "5.1.2.1 Configure journald",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.1.3 | Level1",
      "description": "Enable systemd-journal-remote service.",
      "remediation": "Run: systemctl enable systemd-journal-upload.service"
    },
    {
      "id": "5.1.2.1.4",
      "title": "Ensure journald is not configured to receive logs from a remote client",
      "section": "5.1.2.1 Configure journald",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.1.4 | Level1",
      "description": "Receiving logs from remote clients can expose the system to security risks.",
      "remediation": "Ensure Listen= is not set in /etc/systemd/journald.conf",
      "file_path": "/etc/systemd/journald.conf",
      "pattern": "^Listen",
      "expected_result": "not_found"
    },
    {
      "id": "5.1.2.2",
      "title": "Ensure journald service is enabled",
      "section": "5.1.2 Configure journald",
      "profile": "Level1",
      "automated": true,
      "type": "ServiceStatus",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.2 | Level1",
      "description": "The journald service should be enabled to collect system logs.",
      "remediation": "Run: systemctl enable systemd-journald.service",
      "service_name": "systemd-journald",
      "expected_status": "enabled"
    },
    {
      "id": "5.1.2.3",
      "title": "Ensure journald is configured to compress large log files",
      "section": "5.1.2 Configure journald",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.3 | Level1",
      "description": "Configure journald to compress large log files to save disk space.",
      "remediation": "Edit /etc/systemd/journald.conf and set Compress=yes",
      "file_path": "/etc/systemd/journald.conf",
      "pattern": "^Compress\\s*=\\s*yes",
      "expected_result": "found"
    },
    {
      "id": "5.1.2.4",
      "title": "Ensure journald is configured to write logfiles to persistent disk",
      "section": "5.1.2 Configure journald",
      "profile": "Level1",
      "automated": true,
      "type": "FileContent",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.4 | Level1",
      "description": "Configure journald to persist logs to disk rather than storing them only in volatile memory.",
      "remediation": "Edit /etc/systemd/journald.conf and set Storage=persistent",
      "file_path": "/etc/systemd/journald.conf",
      "pattern": "^Storage\\s*=\\s*persistent",
      "expected_result": "found"
    },
    {
      "id": "5.1.2.5",
      "title": "Ensure journald is not configured to send logs to rsyslog",
      "section": "5.1.2 Configure journald",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.5 | Level1",
      "description": "If using journald for logging, it should not forward to rsyslog to avoid duplication.",
      "remediation": "Edit /etc/systemd/journald.conf and set ForwardToSyslog=no"
    },
    {
      "id": "5.1.2.6",
      "title": "Ensure journald log rotation is configured per site policy",
      "section": "5.1.2 Configure journald",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.2.6 | Level1",
      "description": "Configure journald log rotation to prevent disk space issues.",
      "remediation": "Edit /etc/systemd/journald.conf and configure SystemMaxUse, SystemKeepFree, and MaxRetentionSec as per site policy."
    },
    {
      "id": "5.1.3",
      "title": "Ensure logrotate is configured",
      "section": "5.1.3 Ensure logrotate is configured",
      "profile": "Level1",
      "automated": false,
      "type": "Manual",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.3 | Level1",
      "description": "logrotate helps manage log file rotation and prevents disk space issues.",
      "remediation": "Configure /etc/logrotate.conf and files in /etc/logrotate.d/ according to site policy."
    },
    {
      "id": "5.1.4",
      "title": "Ensure all logfiles have appropriate access configured",
      "section": "5.1.4 Ensure all logfiles have appropriate access configured",
      "profile": "Level1",
      "automated": true,
      "type": "FilePermissions",
      "cis_reference": "CIS Amazon Linux 2 - 5.1.4 | Level1",
      "description": "Log files should have appropriate permissions to protect sensitive information.",
      "remediation": "Run: chmod 755 /var/log && chown root:root /var/log",
      "file_path": "/var/log",
      "expected_permissions": "0755",
      "expected_owner": "root",
      "expected_group": "root"
    }
  ]
}